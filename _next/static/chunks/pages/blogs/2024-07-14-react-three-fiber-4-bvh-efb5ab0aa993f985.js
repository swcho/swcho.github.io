(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6694],{25450:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/blogs/2024-07-14-react-three-fiber-4-bvh",function(){return r(54722)}])},49034:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var n=r(18153),l=r(77328),i=r.n(l),o=r(14232);let a=o.memo(()=>(0,n.Y)(n.FK,{}));var c=r(71745),s=r(48230),d=r.n(s);let h=[{link:"/",text:"Home"}],u=o.memo(()=>{let e=(0,c.useRouter)(),[t,r]=o.useState(!1);return(0,n.FD)("nav",{className:"w-full",children:[(0,n.Y)("div",{id:"progress",className:"top-0 z-20 h-1",style:{background:"linear-gradient(to right, #4dc0b5 var(--scroll), transparent 0)"}}),(0,n.FD)("div",{className:"flex flex-wrap items-center justify-between w-full py-3 mx-auto mt-0 md:max-w-4xl",children:[(0,n.Y)("div",{className:"pl-4",children:(0,n.Y)(d(),{className:"text-xl font-extrabold text-gray-900 no-underline hover:no-underline",href:"/",children:"lifetime trails"})}),(0,n.Y)("div",{className:"block pr-4 lg:hidden",children:(0,n.Y)("button",{id:"nav-toggle",type:"button",className:"flex items-center px-3 py-2 text-gray-500 appearance-none hover:text-gray-900 hover:border-teal-500 focus:outline-none",onMouseDown:e=>e.preventDefault(),onClick:()=>r(!t),onBlur:()=>r(!1),children:(0,n.FD)("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.Y)("title",{children:"Menu"}),(0,n.Y)("path",{d:"M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"})]})})}),(0,n.Y)("div",{id:"nav-content",className:"bg-gray-100 border-b flex-grow lg:border-none lg:flex lg:items-center lg:mt-0 lg:shadow-none lg:w-auto md:bg-transparent mt-2 shadow w-full z-20 ".concat(t?"block":"hidden"),children:(0,n.Y)("ul",{className:"items-center justify-end flex-1 list-reset lg:flex",children:h.map(t=>{let{link:r,text:l}=t;return(0,n.Y)("li",{className:"mr-3",children:(0,n.Y)(d(),{className:e.pathname===r?"inline-block py-2 px-4 text-gray-900 font-bold no-underline":"inline-block text-gray-600 no-underline hover:text-gray-900 hover:text-underline py-2 px-4",href:r,children:l})},r)})})})]})]})}),m=o.memo(e=>{let{children:t,title:r="This is the default title"}=e;return(0,n.FD)("div",{className:"leading-normal tracking-normal bg-gray-100 min-h-screen",children:[(0,n.FD)(i(),{children:[(0,n.Y)("title",{children:r}),(0,n.Y)("meta",{charSet:"utf-8"}),(0,n.Y)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,n.Y)(u,{}),(0,n.Y)("div",{className:"container w-full px-4 pb-10 mx-auto md:max-w-3xl",children:t}),(0,n.Y)(a,{})]})})},54722:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>er,meta:()=>$});var n=r(37876),l=r(91668);let i={src:"/_next/static/media/image.c56913a3.png",height:312,width:182,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAICAMAAAAGL8UJAAAAIVBMVEUfHyQXHihtEkuHGCBXGyJJHSRDHiFuGSAPFWEdHD9UFFHi7r3tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAKklEQVR4nC3KyQ2AMAwAMDdH07L/wEiInx9mnYWOZmfkNvNM6c8qiv+4vAypAH5sgRtKAAAAAElFTkSuQmCC",blurWidth:5,blurHeight:8};var o=r(91013),a=r(18153),c=r(66691),s=r(79271),d=r(49082),h=r(45302),u=r(88360),m=r(14232);let f=new c.tBo,g=new c.Pq0,x=new c.Pq0,p=new c.Ho_(.02,.02),y=new c.Gu$(.25,20,20),w=new c.V9B({color:"yellow",wireframe:!0}),Y=new c.V9B({color:"red",wireframe:!0}),A=new c.V9B({color:"blue",wireframe:!0});function v(e){let{}=e,t=m.useRef(null),r=m.useRef(null),n=m.useRef(null),l=m.useRef(null);return m.useEffect(()=>{r.current.position.set(5,0,0)},[]),(0,u.D)((e,r)=>{let n=t.current;n.rotation.y+=4*r,f.set(g,x),f.firstHitOnly=!0}),(0,a.FD)("group",{ref:t,children:[(0,a.Y)("mesh",{ref:r,geometry:y,material:w}),(0,a.Y)("mesh",{ref:n,geometry:y,material:Y}),(0,a.Y)("mesh",{ref:l,geometry:p,material:A})]})}function b(e){let t=m.useRef(null);return(0,a.Y)(a.FK,{children:(0,a.Y)("group",{ref:t,...e,children:Array.from({length:1},(e,r)=>(0,a.Y)(v,{target:t},r))})})}let j=m.memo(function(e){let{}=e;return(0,a.Y)(a.FK,{children:(0,a.FD)(h.Hl,{"camera-position-z":20,"camera-far":100,style:{height:"30vh",marginBottom:"2rem"},children:[(0,a.Y)("ambientLight",{intensity:Math.PI}),(0,a.Y)("pointLight",{decay:0,position:[10,10,5]}),(0,a.Y)("spotLight",{position:[10,10,10],angle:.15,penumbra:1,decay:0,intensity:Math.PI}),(0,a.Y)("color",{attach:"background",args:["#202025"]}),(0,a.Y)(s.Z,{children:(0,a.Y)(b,{})}),(0,a.Y)(d.N,{})]})})});var F=r(92015),B=r(33191);let H=new c.tBo,M=new c.Pq0,N=new c.Pq0,D=new c.Ho_(.02,.02),R=new c.Gu$(.25,10,10),V=new c.V9B({color:"yellow",wireframe:!0}),P=new c.V9B({color:"red",wireframe:!0}),k=new c.V9B({color:"blue",wireframe:!0});function _(e){let{target:t}=e,r=m.useRef(null),n=m.useRef(null),l=m.useRef(null),i=m.useRef(null),o=m.useRef(null);m.useEffect(()=>{n.current.position.set(5,0,0)},[]);let[c,s]=m.useState("");return(0,u.D)((e,l)=>{let a=r.current;a.rotation.y+=l,M.setFromMatrixPosition(n.current.matrixWorld),N.copy(M).multiplyScalar(-1).normalize(),H.set(M,N),H.firstHitOnly=!0;let c=H.intersectObject(t.current,!0)[0],d=c?c.distance:5;s("(".concat(M.x.toFixed(),", ").concat(M.y.toFixed(),", ").concat(M.z.toFixed(),") (").concat(N.x.toFixed(),", ").concat(N.y.toFixed(),", ").concat(N.z.toFixed(),") ").concat(d.toFixed(2))),i.current.position.setX(5-d),o.current.position.setX(5-d+d/2),o.current.rotation.set(0,0,Math.PI/2),o.current.scale.set(1,d,1)}),(0,a.FD)("group",{ref:r,children:[(0,a.Y)("mesh",{ref:n,geometry:R,material:V,children:(0,a.Y)(F.Q,{children:(0,a.Y)(B.E,{position:[0,-1,0],ref:l,fontSize:.5,children:c})})}),(0,a.Y)("mesh",{ref:i,geometry:R,material:P}),(0,a.Y)("mesh",{ref:o,geometry:D,material:k})]})}function E(e){let t=m.useRef(null);return(0,a.FD)(a.FK,{children:[(0,a.Y)("group",{ref:t,...e}),Array.from({length:1},(e,r)=>(0,a.Y)(_,{target:t},r))]})}let z=m.memo(function(e){let{}=e;return(0,a.Y)(a.FK,{children:(0,a.FD)(h.Hl,{"camera-far":100,camera:{position:[0,0,7]},style:{height:"30vh",marginBottom:"2rem"},children:[(0,a.Y)("color",{attach:"background",args:["#202025"]}),(0,a.Y)(s.Z,{children:(0,a.Y)(E,{children:(0,a.FD)("mesh",{children:[(0,a.Y)("sphereGeometry",{args:[1,10,10]}),(0,a.Y)("meshBasicMaterial",{color:65280,wireframe:!0})]})})})]})})});var K=r(31861),C=r(47653),G=r(28724);let O=new c.tBo,S=new c.Pq0,I=new c.Pq0,q=new c.Ho_(.02,.02),U=new c.Gu$(.25,20,20),W=new c.V9B({color:"yellow"}),X=new c.V9B({color:"red"}),L=new c.V9B({transparent:!0,opacity:.25});function T(e){let{target:t}=e,r=m.useRef(null),n=m.useRef(null),l=m.useRef(null),i=m.useRef(null);m.useEffect(()=>{l.current.scale.multiplyScalar(.5),n.current.position.set(25,0,0),r.current.rotation.x=10*Math.random(),r.current.rotation.y=10*Math.random()},[]);let o=Math.random()-.5,c=Math.random()-.5;return(0,u.D)((e,a)=>{let s=r.current;s.rotation.x+=o*a,s.rotation.y+=c*a,n.current.updateMatrixWorld(),S.setFromMatrixPosition(n.current.matrixWorld),I.copy(S).multiplyScalar(-1).normalize(),O.set(S,I),O.firstHitOnly=!0;let d=O.intersectObject(t.current,!0),h=d.length?d[0].distance:25;l.current.position.set(25-h,0,0),i.current.position.set(25-h/2,0,0),i.current.scale.set(1,h,1),i.current.rotation.z=Math.PI/2}),(0,a.FD)("group",{ref:r,children:[(0,a.Y)("mesh",{ref:n,geometry:U,material:W}),(0,a.Y)("mesh",{ref:l,geometry:U,material:X}),(0,a.Y)("mesh",{ref:i,geometry:q,material:L})]})}function J(e){let t=m.useRef(null),{count:r}=(0,K._5)({count:{value:100,min:0,max:500}});return(0,a.FD)(a.FK,{children:[(0,a.Y)("group",{ref:t,...e}),Array.from({length:r},(e,r)=>(0,a.Y)(T,{target:t},r))]})}function Q(e){let t=m.useRef(null),r=m.useRef(null);return(0,G._)(t,C.e),(0,u.D)((e,r)=>t.current.rotation.x=t.current.rotation.y+=r),(0,a.FD)("mesh",{ref:t,...e,onPointerMove:e=>r.current.position.copy(t.current.worldToLocal(e.point)),onPointerOver:()=>r.current.visible=!0,onPointerOut:()=>r.current.visible=!1,children:[(0,a.Y)("torusKnotGeometry",{args:[1,.4,200,50]}),(0,a.Y)("meshNormalMaterial",{}),(0,a.FD)("mesh",{raycast:()=>null,ref:r,visible:!1,children:[(0,a.Y)("sphereGeometry",{args:[.2]}),(0,a.Y)("meshBasicMaterial",{color:"orange",toneMapped:!1})]})]})}let Z=m.memo(function(e){let{}=e,{enabled:t}=(0,K._5)({enabled:!0});return(0,a.Y)(a.FK,{children:(0,a.FD)(h.Hl,{"camera-position-z":40,"camera-far":100,style:{height:"30vh",marginBottom:"1rem"},children:[(0,a.Y)("color",{attach:"background",args:["#202025"]}),(0,a.Y)(s.Z,{firstHitOnly:!0,enabled:t,children:(0,a.Y)(J,{children:(0,a.Y)(Q,{})})}),(0,a.Y)(d.N,{})]})})}),$={title:"react-three-fiber: Bounding Volume Hierarchy",description:"BVH(Bounding Volume Hierarchy) 예제를 살펴 봅니다.",date:"2024-07-14",readTime:5},ee=e=>{let{children:t}=e;return(0,n.jsx)(o.A,{meta:$,children:t})};function et(e){let t={a:"a",code:"code",h1:"h1",img:"img",p:"p",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{children:"BVH(Bounding Volume Hierarchy)"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"<Ray />"})," 컴포넌트는 실린더(",(0,n.jsx)(t.code,{children:"CylinderGeometry"}),") 하나와 구체(SphereGeometry) 2개를 가집니다."]}),"\n",(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,n.jsx)("div",{style:{width:"50px"},children:(0,n.jsx)(t.img,{alt:"alt text",src:i})})}),"\n",(0,n.jsx)(t.p,{children:"그림과 같이 실린더는 파란색, 구체는 파란색으로 표시 했습니다."}),"\n",(0,n.jsx)(j,{}),"\n",(0,n.jsxs)(t.p,{children:["조금더 알아보기 쉽게 ",(0,n.jsx)(t.code,{children:"origMesh"})," 객체는 노란색, ",(0,n.jsx)(t.code,{children:"hitMesh"})," 객체는 빨간색, ",(0,n.jsx)(t.code,{children:"cylinderMesh"}),"는 파란색으로 표시했습니다."]}),"\n",(0,n.jsx)(z,{}),"\n",(0,n.jsx)(t.p,{children:"이제 가운데에 반지름을 1로하는 초록색의 구체를 놓아 봅니다."}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"Raycaster"}),"는 기준 점과 방향을 가리키는 단위 벡터를 지정해 주면 기준점으로 부터 시작하여 특정 방향으로 가상의 선을 그엇을 때 충돌하는 객체를 찾을 수 있습니다."]}),"\n",(0,n.jsxs)(t.p,{children:["노란색의 ",(0,n.jsx)(t.code,{children:"origMesh"}),"로 부터 중심이 되는 방향으로 raycast를 합니다. 이 때 ",(0,n.jsx)(t.code,{children:"intersectObject"})," 함수를 사용하여 특정 mesh와의 교차 지점을 알아 낼 수 있습니다."]}),"\n",(0,n.jsxs)(t.p,{children:["이를 통해 ",(0,n.jsx)(t.code,{children:"origMesh"}),"로 부터 중심의 구체와 충돌하는 지점을 빨간색의 ",(0,n.jsx)(t.code,{children:"hitMesh"})," 구체와 파란색의 ",(0,n.jsx)(t.code,{children:"cylinderMesh"})," 선으로 표시를 할 수 있습니다."]}),"\n",(0,n.jsx)(Z,{}),"\n",(0,n.jsx)(t.p,{children:"이제 초록색 구체 대신 복잡한 모양의 torus를 배치하고 노란색 구체를 렌덤하게 회전해 주면 원본 프로젝트와 같은 동작을 하게 됩니다."}),"\n",(0,n.jsx)(t.p,{children:"사실 이 예제는 raycast 보다는 BVH(Bounding Volume Hierarchy)를 사용한 raycast의 성능향상을 보여주기 위한 것 입니다."}),"\n",(0,n.jsx)(t.p,{children:"자세한 내용은 아래에서 찾아 볼 수 있습니다."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://wjdgh283.tistory.com/entry/BVHBounding-Volume-Hierarchy",children:"BVH(Bounding Volume Hierarchy)"})}),"\n",(0,n.jsx)(t.h1,{children:"원본 코드"}),"\n",(0,n.jsx)("iframe",{style:{width:"100%",height:900,outline:"1px solid #252525",border:0,borderRadius:8,marginBottom:16,zIndex:100},src:"https://codesandbox.io/s/txzeq8"})]})}function er(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.jsx)(ee,{...e,children:(0,n.jsx)(et,{...e})})}},60158:(e,t,r)=>{"use strict";r.d(t,{J:()=>a,j:()=>o});var n=r(18153),l=r(14232);let i=l.createContext({});function o(e){let{staticProps:t,children:r}=e;return(0,n.Y)(i.Provider,{value:t,children:r})}function a(){return l.useContext(i)}},85419:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(18153);r(14232);let l=e=>{let{meta:t,isBlogPost:r}=e;return(0,n.FD)(n.FK,{children:[(0,n.Y)("h1",{className:"font-bold text-gray-800 mb-4 ".concat(r?"text-5xl mt-8 mb-8":"text-lg"),children:t.title}),(0,n.FD)("div",{className:"details",children:[(0,n.Y)("p",{className:"text-gray-500",children:t.description}),(0,n.Y)("p",{className:"text-gray-400 text-right -mt-1",children:(0,n.Y)("span",{className:"mr-4",children:t.date})})]})]})}},91013:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(18153),l=r(73146),i=r.n(l),o=r(14232),a=r(86089),c=r(60158),s=r(85419),d=r(49034);function h(e){let{children:t,meta:r,staticProps:l}=e;return o.useEffect(()=>{i().highlightAll()},[]),(0,n.Y)(n.FK,{children:(0,n.FD)(d.A,{title:r.title,children:[(0,n.Y)(s.A,{meta:r,isBlogPost:!0}),(0,n.Y)(c.j,{staticProps:l,children:(0,n.Y)("article",{className:"markdown",children:t})}),(0,n.Y)(a.Ay,{repo:"swcho/blog-comments",type:"pathname",label:"utterances",theme:"github-light"})]})})}}},e=>{e.O(0,[5334,7391,683,5037,5695,5302,2077,41,5003,1861,7367,636,6593,8792],()=>e(e.s=25450)),_N_E=e.O()}]);
//# sourceMappingURL=2024-07-14-react-three-fiber-4-bvh-efb5ab0aa993f985.js.map