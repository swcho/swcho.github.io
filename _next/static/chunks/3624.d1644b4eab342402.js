(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3624],{622:(t,e,r)=>{"use strict";r.d(e,{M:()=>u});var i=r(13799),s=r(43428),n=r(68526),a=r(90848),o=r(84597),l=r(10558),h=r(55103);class u extends i.A{constructor(t){super(),this.uid=(0,s.L)("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:r,groups:i,resources:n,compatibleRenderers:o,groupMap:u}=t;this.gpuProgram=e,this.glProgram=r,void 0===o&&(o=0,e&&(o|=l.W.WEBGPU),r&&(o|=l.W.WEBGL)),this.compatibleRenderers=o;let d={};if(n||i||(n={}),n&&i)throw Error("[Shader] Cannot have both resources and groups");if(e||!i||u){if(!e&&i&&u)for(let t in u)for(let e in u[t]){let r=u[t][e];d[r]={group:t,binding:e,name:r}}else if(e&&i&&!u){let t=e.structsAndGroups.groups;u={},t.forEach(t=>{u[t.group]=u[t.group]||{},u[t.group][t.binding]=t.name,d[t.name]=t})}else if(n){i={},u={},e&&e.structsAndGroups.groups.forEach(t=>{u[t.group]=u[t.group]||{},u[t.group][t.binding]=t.name,d[t.name]=t});let t=0;for(let e in n)!d[e]&&(i[99]||(i[99]=new a.T,this._ownedBindGroups.push(i[99])),d[e]={group:99,binding:t,name:e},u[99]=u[99]||{},u[99][t]=e,t++);for(let t in n){let e=n[t];e.source||e._resourceType||(e=new h.k(e));let r=d[t];r&&(i[r.group]||(i[r.group]=new a.T,this._ownedBindGroups.push(i[r.group])),i[r.group].setResource(e,r.binding))}}}else throw Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");this.groups=i,this._uniformBindMap=u,this.resources=this._buildResourceAccessor(i,d)}addResource(t,e,r){var i,s;(i=this._uniformBindMap)[e]||(i[e]={}),(s=this._uniformBindMap[e])[r]||(s[r]=t),this.groups[e]||(this.groups[e]=new a.T,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){let r={};for(let i in e){let s=e[i];Object.defineProperty(r,s.name,{get:()=>t[s.group].getResource(s.binding),set(e){t[s.group].setResource(e,s.binding)}})}return r}destroy(t=!1){this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(t=>{t.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){let e,r,{gpu:i,gl:s,...a}=t;return i&&(e=o.B.from(i)),s&&(r=n.M.from(s)),new u({gpuProgram:e,glProgram:r,...a})}}},2456:(t,e,r)=>{"use strict";r.d(e,{GH:()=>tA});var i=r(3230),s=r(90848),n=r(52295);let a={};var o=r(43428),l=r(43977),h=r(51631),u=r(44518);function d(t,e){let r=t.byteLength/8|0,i=new Float64Array(t,0,r);new Float64Array(e,0,r).set(i);let s=t.byteLength-8*r;if(s>0){let i=new Uint8Array(t,8*r,s);new Uint8Array(e,8*r,s).set(i)}}var c=r(93087),f=r(86833);let p=null;class x{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){let e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class g{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new x,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}let m=[],_=0;function y(){return _>0?m[--_]:new g}u.L.register({clear:()=>{if(m.length>0)for(let t of m)t&&t.destroy();m.length=0,_=0}});let b=0,v=class t{constructor(e){this.uid=(0,o.L)("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],(e={...t.defaultOptions,...e}).maxTextures||((0,h.t6)("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),e.maxTextures=function(){if(p)return p;let t=(0,f.W)();return p=function(t,e){if(0===t)throw Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){let i="precision mediump float;\nvoid main(void){\nfloat test = 0.1;\n%forloop%\ngl_FragColor = vec4(0.0);\n}".replace(/%forloop%/gi,function(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}}finally{e.deleteShader(r)}return t}(p=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t),t.getExtension("WEBGL_lose_context")?.loseContext(),p}());let{maxTextures:r,attributesInitialSize:i,indicesInitialSize:s}=e;this.attributeBuffer=new l.u(4*i),this.indexBuffer=new Uint16Array(s),this.maxTextures=r}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++){var t;t=this.batches[e],m[_++]=t}this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){let r=t._batch.textures.ids[e._source.uid];return(!!r||0===r)&&(t._textureId=r,t.texture=e,!0)}updateElement(t){this.dirty=!0;let e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){let e=this._elements;if(!e[this.elementStart])return;let r=y(),i=r.textures;i.clear();let s=e[this.elementStart],n=(0,c.i)(s.blendMode,s.texture._source),a=s.topology;4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);let o=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,h=this.indexBuffer,u=this._batchIndexSize,d=this._batchIndexStart,f="startBatch",p=this.maxTextures;for(let s=this.elementStart;s<this.elementSize;++s){let x=e[s];e[s]=null;let g=x.texture._source,m=(0,c.i)(x.blendMode,g),_=n!==m||a!==x.topology;if(g._batchTick===b&&!_){x._textureId=g._textureBindLocation,u+=x.indexSize,x.packAsQuad?(this.packQuadAttributes(x,o,l,x._attributeStart,x._textureId),this.packQuadIndex(h,x._indexStart,x._attributeStart/this.vertexSize)):(this.packAttributes(x,o,l,x._attributeStart,x._textureId),this.packIndex(x,h,x._indexStart,x._attributeStart/this.vertexSize)),x._batch=r;continue}g._batchTick=b,(i.count>=p||_)&&(this._finishBatch(r,d,u-d,i,n,a,t,f),f="renderBatch",d=u,n=m,a=x.topology,(i=(r=y()).textures).clear(),++b),x._textureId=g._textureBindLocation=i.count,i.ids[g.uid]=i.count,i.textures[i.count++]=g,x._batch=r,u+=x.indexSize,x.packAsQuad?(this.packQuadAttributes(x,o,l,x._attributeStart,x._textureId),this.packQuadIndex(h,x._indexStart,x._attributeStart/this.vertexSize)):(this.packAttributes(x,o,l,x._attributeStart,x._textureId),this.packIndex(x,h,x._indexStart,x._attributeStart/this.vertexSize))}i.count>0&&(this._finishBatch(r,d,u-d,i,n,a,t,f),d=u,++b),this.elementStart=this.elementSize,this._batchIndexStart=d,this._batchIndexSize=u}_finishBatch(t,e,r,i,s,n,a,o){t.gpuBindGroup=null,t.bindGroup=null,t.action=o,t.batcher=this,t.textures=i,t.blendMode=s,t.topology=n,t.start=e,t.size=r,++b,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){let e=Math.max(t,2*this.attributeBuffer.size),r=new l.u(e);d(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){let e=this.indexBuffer,r=Math.max(t,1.5*e.length);r+=r%2;let i=r>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let t=0;t<e.length;t++)i[t]=e[t];else d(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}packIndex(t,e,r,i){let s=t.indices,n=t.indexSize,a=t.indexOffset,o=t.attributeOffset;for(let t=0;t<n;t++)e[r++]=i+s[t+a]-o}destroy(){if(null!==this.batches){for(let e=0;e<this.batches.length;e++){var t;t=this.batches[e],m[_++]=t}this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]&&(this._elements[t]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};v.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let S=v;var w=r(13636),T=r(88497),C=r(25891);let P=new Float32Array(1),M=new Uint32Array(1);class k extends C.V{constructor(){let t=new w.h({data:P,label:"attribute-batch-buffer",usage:T.S.VERTEX|T.S.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0},aUV:{buffer:t,format:"float32x2",stride:24,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20}},indexBuffer:new w.h({data:M,label:"index-batch-buffer",usage:T.S.INDEX|T.S.COPY_DST,shrinkToFit:!1})})}}var A=r(31368),R=r(86942),B=r(16141),F=r(20144),z=r(18709),U=r(622);class I extends U.M{constructor(t){super({glProgram:(0,A.I)({name:"batch",bits:[R.a,(0,B.P)(t),F.m]}),gpuProgram:(0,A.v)({name:"batch",bits:[R.F,(0,B._)(t),F.b]}),resources:{batchSamplers:(0,z.n)(t)}})}}let E=null,D=class t extends S{constructor(e){super(e),this.geometry=new k,this.name=t.extension.name,this.vertexSize=6,E??(E=new I(e.maxTextures)),this.shader=E}packAttributes(t,e,r,i,s){let n=s<<16|65535&t.roundPixels,a=t.transform,o=a.a,l=a.b,h=a.c,u=a.d,d=a.tx,c=a.ty,{positions:f,uvs:p}=t,x=t.color,g=t.attributeOffset,m=g+t.attributeSize;for(let t=g;t<m;t++){let s=2*t,a=f[s],g=f[s+1];e[i++]=o*a+h*g+d,e[i++]=u*g+l*a+c,e[i++]=p[s],e[i++]=p[s+1],r[i++]=x,r[i++]=n}}packQuadAttributes(t,e,r,i,s){let n=t.texture,a=t.transform,o=a.a,l=a.b,h=a.c,u=a.d,d=a.tx,c=a.ty,f=t.bounds,p=f.maxX,x=f.minX,g=f.maxY,m=f.minY,_=n.uvs,y=t.color,b=s<<16|65535&t.roundPixels;e[i+0]=o*x+h*m+d,e[i+1]=u*m+l*x+c,e[i+2]=_.x0,e[i+3]=_.y0,r[i+4]=y,r[i+5]=b,e[i+6]=o*p+h*m+d,e[i+7]=u*m+l*p+c,e[i+8]=_.x1,e[i+9]=_.y1,r[i+10]=y,r[i+11]=b,e[i+12]=o*p+h*g+d,e[i+13]=u*g+l*p+c,e[i+14]=_.x2,e[i+15]=_.y2,r[i+16]=y,r[i+17]=b,e[i+18]=o*x+h*g+d,e[i+19]=u*g+l*x+c,e[i+20]=_.x3,e[i+21]=_.y3,r[i+22]=y,r[i+23]=b}};D.extension={type:[i.Ag.Batcher],name:"default"};var G=r(95341),O=r(87577),V=r(62104),W=r(92809);function L(t,e,r,i,s){let n=e.a,a=e.b,o=e.c,l=e.d,h=e.tx,u=e.ty;r||(r=0),i||(i=2),s||(s=t.length/i-r);let d=r*i;for(let e=0;e<s;e++){let e=t[d],r=t[d+1];t[d]=n*e+o*r+h,t[d+1]=a*e+l*r+u,d+=i}}var $=r(39795);let H={extension:{type:i.Ag.ShapeBuilder,name:"circle"},build(t,e){let r,i,s,n,a,o;if("circle"===t.type){if((a=o=t.radius)<=0)return!1;r=t.x,i=t.y,s=n=0}else if("ellipse"===t.type){if(a=t.halfWidth,o=t.halfHeight,a<=0||o<=0)return!1;r=t.x,i=t.y,s=n=0}else{let e=t.width/2,l=t.height/2;r=t.x+e,i=t.y+l,a=o=Math.max(0,Math.min(t.radius,Math.min(e,l))),s=e-a,n=l-o}if(s<0||n<0)return!1;let l=Math.ceil(2.3*Math.sqrt(a+o)),h=8*l+4*!!s+4*!!n;if(0===h)return!1;if(0===l)return e[0]=e[6]=r+s,e[1]=e[3]=i+n,e[2]=e[4]=r-s,e[5]=e[7]=i-n,!0;let u=0,d=4*l+2*!!s+2,c=d,f=h,p=s+a,x=n,g=r+p,m=r-p,_=i+x;if(e[u++]=g,e[u++]=_,e[--d]=_,e[--d]=m,n){let t=i-x;e[c++]=m,e[c++]=t,e[--f]=t,e[--f]=g}for(let t=1;t<l;t++){let h=Math.PI/2*(t/l),p=s+Math.cos(h)*a,x=n+Math.sin(h)*o,g=r+p,m=r-p,_=i+x,y=i-x;e[u++]=g,e[u++]=_,e[--d]=_,e[--d]=m,e[c++]=m,e[c++]=y,e[--f]=y,e[--f]=g}p=s,x=n+o,g=r+p,m=r-p,_=i+x;let y=i-x;return e[u++]=g,e[u++]=_,e[--f]=y,e[--f]=g,s&&(e[u++]=m,e[u++]=_,e[--f]=y,e[--f]=m),!0},triangulate(t,e,r,i,s,n){if(0===t.length)return;let a=0,o=0;for(let e=0;e<t.length;e+=2)a+=t[e],o+=t[e+1];a/=t.length/2,o/=t.length/2;let l=i;e[l*r]=a,e[l*r+1]=o;let h=l++;for(let i=0;i<t.length;i+=2)e[l*r]=t[i],e[l*r+1]=t[i+1],i>0&&(s[n++]=l,s[n++]=h,s[n++]=l-1),l++;s[n++]=h+1,s[n++]=h,s[n++]=l-1}},N={...H,extension:{...H.extension,name:"ellipse"}},X={...H,extension:{...H.extension,name:"roundedRectangle"}};var j=r(88188);function Y(t,e,r,i,s,n,a,o){let l,h;a?(l=i,h=-r):(l=-i,h=r);let u=t-r*s+l,d=e-i*s+h,c=t+r*n+l,f=e+i*n+h;return o.push(u,d),o.push(c,f),2}function q(t,e,r,i,s,n,a,o){let l=r-t,h=i-e,u=Math.atan2(l,h),d=Math.atan2(s-t,n-e);o&&u<d?u+=2*Math.PI:!o&&u>d&&(d+=2*Math.PI);let c=u,f=d-u,p=Math.sqrt(l*l+h*h),x=(15*Math.abs(f)*Math.sqrt(p)/Math.PI|0)+1,g=f/x;if(c+=g,o){a.push(t,e),a.push(r,i);for(let r=1,i=c;r<x;r++,i+=g)a.push(t,e),a.push(t+Math.sin(i)*p,e+Math.cos(i)*p);a.push(t,e),a.push(s,n)}else{a.push(r,i),a.push(t,e);for(let r=1,i=c;r<x;r++,i+=g)a.push(t+Math.sin(i)*p,e+Math.cos(i)*p),a.push(t,e);a.push(s,n),a.push(t,e)}return 2*x}function K(t,e,r=2){let i,s,n,a=e&&e.length,o=a?e[0]*r:t.length,l=Z(t,0,o,r,!0),h=[];if(!l||l.next===l.prev)return h;if(a&&(l=function(t,e,r,i){let s=[];for(let r=0,n=e.length;r<n;r++){let a=e[r]*i,o=r<n-1?e[r+1]*i:t.length,l=Z(t,a,o,i,!1);l===l.next&&(l.steiner=!0),s.push(function(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}(l))}s.sort(J);for(let t=0;t<s.length;t++)r=function(t,e){let r=function(t,e){let r,i=e,s=t.x,n=t.y,a=-1/0;if(ts(t,i))return i;do{if(ts(t,i.next))return i.next;if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let t=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>a&&(a=t,r=i.x<i.next.x?i:i.next,t===s))return r}i=i.next}while(i!==e);if(!r)return null;let o=r,l=r.x,h=r.y,u=1/0;i=r;do{if(s>=i.x&&i.x>=l&&s!==i.x&&te(n<h?s:a,n,l,h,n<h?a:s,n,i.x,i.y)){var d,c;let e=Math.abs(n-i.y)/(s-i.x);tl(i,t)&&(e<u||e===u&&(i.x>r.x||i.x===r.x&&(d=r,c=i,0>ti(d.prev,d,c.prev)&&0>ti(c.next,d,d.next))))&&(r=i,u=e)}i=i.next}while(i!==o);return r}(t,e);if(!r)return e;let i=th(r,t);return Q(i,i.next),Q(r,r.next)}(s[t],r);return r}(t,e,l,r)),t.length>80*r){i=t[0],s=t[1];let e=i,a=s;for(let n=r;n<o;n+=r){let r=t[n],o=t[n+1];r<i&&(i=r),o<s&&(s=o),r>e&&(e=r),o>a&&(a=o)}n=0!==(n=Math.max(e-i,a-s))?32767/n:0}return function t(e,r,i,s,n,a,o){if(!e)return;!o&&a&&function(t,e,r,i){let s=t;do 0===s.z&&(s.z=tt(s.x,s.y,e,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let e,r=1;do{let i,s=t;t=null;let n=null;for(e=0;s;){e++;let a=s,o=0;for(let t=0;t<r&&(o++,a=a.nextZ);t++);let l=r;for(;o>0||l>0&&a;)0!==o&&(0===l||!a||s.z<=a.z)?(i=s,s=s.nextZ,o--):(i=a,a=a.nextZ,l--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;s=a}n.nextZ=null,r*=2}while(e>1)}(s)}(e,s,n,a);let l=e;for(;e.prev!==e.next;){let h=e.prev,u=e.next;if(a?function(t,e,r,i){let s=t.prev,n=t.next;if(ti(s,t,n)>=0)return!1;let a=s.x,o=t.x,l=n.x,h=s.y,u=t.y,d=n.y,c=Math.min(a,o,l),f=Math.min(h,u,d),p=Math.max(a,o,l),x=Math.max(h,u,d),g=tt(c,f,e,r,i),m=tt(p,x,e,r,i),_=t.prevZ,y=t.nextZ;for(;_&&_.z>=g&&y&&y.z<=m;){if(_.x>=c&&_.x<=p&&_.y>=f&&_.y<=x&&_!==s&&_!==n&&tr(a,h,o,u,l,d,_.x,_.y)&&ti(_.prev,_,_.next)>=0||(_=_.prevZ,y.x>=c&&y.x<=p&&y.y>=f&&y.y<=x&&y!==s&&y!==n&&tr(a,h,o,u,l,d,y.x,y.y)&&ti(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;_&&_.z>=g;){if(_.x>=c&&_.x<=p&&_.y>=f&&_.y<=x&&_!==s&&_!==n&&tr(a,h,o,u,l,d,_.x,_.y)&&ti(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;y&&y.z<=m;){if(y.x>=c&&y.x<=p&&y.y>=f&&y.y<=x&&y!==s&&y!==n&&tr(a,h,o,u,l,d,y.x,y.y)&&ti(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}(e,s,n,a):function(t){let e=t.prev,r=t.next;if(ti(e,t,r)>=0)return!1;let i=e.x,s=t.x,n=r.x,a=e.y,o=t.y,l=r.y,h=Math.min(i,s,n),u=Math.min(a,o,l),d=Math.max(i,s,n),c=Math.max(a,o,l),f=r.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=c&&tr(i,a,s,o,n,l,f.x,f.y)&&ti(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}(e)){r.push(h.i,e.i,u.i),td(e),e=u.next,l=u.next;continue}if((e=u)===l){o?1===o?t(e=function(t,e){let r=t;do{let i=r.prev,s=r.next.next;!ts(i,s)&&tn(i,r,r.next,s)&&tl(i,s)&&tl(s,i)&&(e.push(i.i,r.i,s.i),td(r),td(r.next),r=t=s),r=r.next}while(r!==t);return Q(r)}(Q(e),r),r,i,s,n,a,2):2===o&&function(e,r,i,s,n,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){var l,h;if(o.i!==e.i&&(l=o,h=e,l.next.i!==h.i&&l.prev.i!==h.i&&!function(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&tn(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(l,h)&&(tl(l,h)&&tl(h,l)&&function(t,e){let r=t,i=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}(l,h)&&(ti(l.prev,l,h.prev)||ti(l,h.prev,h))||ts(l,h)&&ti(l.prev,l,l.next)>0&&ti(h.prev,h,h.next)>0))){let l=th(o,e);o=Q(o,o.next),l=Q(l,l.next),t(o,r,i,s,n,a,0),t(l,r,i,s,n,a,0);return}e=e.next}o=o.next}while(o!==e)}(e,r,i,s,n,a):t(Q(e),r,i,s,n,a,1);break}}}(l,h,r,i,s,n,0),h}function Z(t,e,r,i,s){let n;if(s===function(t,e,r,i){let s=0;for(let n=e,a=r-i;n<r;n+=i)s+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return s}(t,e,r,i)>0)for(let s=e;s<r;s+=i)n=tu(s/i|0,t[s],t[s+1],n);else for(let s=r-i;s>=e;s-=i)n=tu(s/i|0,t[s],t[s+1],n);return n&&ts(n,n.next)&&(td(n),n=n.next),n}function Q(t,e){if(!t)return t;e||(e=t);let r=t,i;do if(i=!1,!r.steiner&&(ts(r,r.next)||0===ti(r.prev,r,r.next))){if(td(r),(r=e=r.prev)===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function J(t,e){let r=t.x-e.x;return 0===r&&0==(r=t.y-e.y)&&(r=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function tt(t,e,r,i,s){return(t=((t=((t=((t=((t=(t-r)*s|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)|(e=((e=((e=((e=((e=(e-i)*s|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)<<1}function te(t,e,r,i,s,n,a,o){return(s-a)*(e-o)>=(t-a)*(n-o)&&(t-a)*(i-o)>=(r-a)*(e-o)&&(r-a)*(n-o)>=(s-a)*(i-o)}function tr(t,e,r,i,s,n,a,o){return(t!==a||e!==o)&&te(t,e,r,i,s,n,a,o)}function ti(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function ts(t,e){return t.x===e.x&&t.y===e.y}function tn(t,e,r,i){let s=to(ti(t,e,r)),n=to(ti(t,e,i)),a=to(ti(r,i,t)),o=to(ti(r,i,e));return!!(s!==n&&a!==o||0===s&&ta(t,r,e)||0===n&&ta(t,i,e)||0===a&&ta(r,t,i)||0===o&&ta(r,e,i))}function ta(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function to(t){return t>0?1:t<0?-1:0}function tl(t,e){return 0>ti(t.prev,t,t.next)?ti(t,e,t.next)>=0&&ti(t,t.prev,e)>=0:0>ti(t,e,t.prev)||0>ti(t,t.next,e)}function th(t,e){let r=tc(t.i,t.x,t.y),i=tc(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function tu(t,e,r,i){let s=tc(t,e,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function td(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tc(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}r(13799);let tf=K.default||K;function tp(t,e,r,i,s,n,a){let o=tf(t,e,2);if(!o)return;for(let t=0;t<o.length;t+=3)n[a++]=o[t]+s,n[a++]=o[t+1]+s,n[a++]=o[t+2]+s;let l=s*i;for(let e=0;e<t.length;e+=2)r[l]=t[e],r[l+1]=t[e+1],l+=i}let tx=[],tg={extension:{type:i.Ag.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return!0},triangulate(t,e,r,i,s,n){tp(t,tx,e,r,i,s,n)}},tm={extension:{type:i.Ag.ShapeBuilder,name:"rectangle"},build(t,e){let r=t.x,i=t.y,s=t.width,n=t.height;return!!(s>0&&n>0)&&(e[0]=r,e[1]=i,e[2]=r+s,e[3]=i,e[4]=r+s,e[5]=i+n,e[6]=r,e[7]=i+n,!0)},triangulate(t,e,r,i,s,n){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[6],e[i+a+1]=t[7],a+=r,e[i+a]=t[4],e[i+a+1]=t[5],a+=r;let o=i/r;s[n++]=o,s[n++]=o+1,s[n++]=o+2,s[n++]=o+1,s[n++]=o+3,s[n++]=o+2}},t_={extension:{type:i.Ag.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,!0),triangulate(t,e,r,i,s,n){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[4],e[i+a+1]=t[5];let o=i/r;s[n++]=o,s[n++]=o+1,s[n++]=o+2}};var ty=r(49521);let tb=new V.u,tv=new W.M,tS={};i.XO.handleByMap(i.Ag.ShapeBuilder,tS),i.XO.add(tm,tg,t_,H,N,X);let tw=new W.M,tT=new V.u;function tC(t,e,r,i,s){let{vertices:a,uvs:o,indices:l}=s;t.shapePrimitives.forEach(({shape:t,transform:h,holes:u})=>{let d=[],c=tS[t.type];if(!c.build(t,d))return;let f=l.length,p=a.length/2,x="triangle-list";if(h&&L(d,h),r){let r=t.closePath??!0;e.pixelLine?(!function(t,e,r,i){if(0===t.length)return;let s=t[0],n=t[1],a=t[t.length-2],o=t[t.length-1],l=e||1e-4>Math.abs(s-a)&&1e-4>Math.abs(n-o),h=t.length/2,u=r.length/2;for(let e=0;e<h;e++)r.push(t[2*e]),r.push(t[2*e+1]);for(let t=0;t<h-1;t++)i.push(u+t,u+t+1);l&&i.push(u+h-1,u)}(d,r,a,l),x="line-list"):function(t,e,r,i,s,n){if(0===t.length)return;let a=e.alignment;if(.5!==e.alignment){let e=function(t){let e=t.length;if(e<6)return 1;let r=0;for(let i=0,s=t[e-2],n=t[e-1];i<e;i+=2){let e=t[i],a=t[i+1];r+=(e-s)*(a+n),s=e,n=a}return r<0?-1:1}(t);r&&(e*=-1),a=(a-.5)*e+.5}let o=new j.b(t[0],t[1]),l=new j.b(t[t.length-2],t[t.length-1]),h=1e-4>Math.abs(o.x-l.x)&&1e-4>Math.abs(o.y-l.y);if(i){t=t.slice(),h&&(t.pop(),t.pop(),l.set(t[t.length-2],t[t.length-1]));let e=(o.x+l.x)*.5,r=(l.y+o.y)*.5;t.unshift(e,r),t.push(e,r)}let u=t.length/2,d=t.length,c=s.length/2,f=e.width/2,p=f*f,x=e.miterLimit*e.miterLimit,g=t[0],m=t[1],_=t[2],y=t[3],b=0,v=0,S=-(m-y),w=g-_,T=0,C=0,P=Math.sqrt(S*S+w*w);S/=P,w/=P,S*=f,w*=f;let M=a,k=(1-M)*2,A=2*M;i||("round"===e.cap?d+=q(g-S*(k-A)*.5,m-w*(k-A)*.5,g-S*k,m-w*k,g+S*A,m+w*A,s,!0)+2:"square"===e.cap&&(d+=Y(g,m,S,w,k,A,!0,s))),s.push(g-S*k,m-w*k),s.push(g+S*A,m+w*A);for(let r=1;r<u-1;++r){g=t[(r-1)*2],m=t[(r-1)*2+1],_=t[2*r],y=t[2*r+1],b=t[(r+1)*2],v=t[(r+1)*2+1],P=Math.sqrt((S=-(m-y))*S+(w=g-_)*w),S/=P,w/=P,S*=f,w*=f,P=Math.sqrt((T=-(y-v))*T+(C=_-b)*C),T/=P,C/=P,T*=f,C*=f;let i=_-g,n=m-y,a=_-b,o=v-y,l=i*a+n*o,h=n*a-o*i,u=h<0;if(Math.abs(h)<.001*Math.abs(l)){s.push(_-S*k,y-w*k),s.push(_+S*A,y+w*A),l>=0&&("round"===e.join?d+=q(_,y,_-S*k,y-w*k,_-T*k,y-C*k,s,!1)+4:d+=2,s.push(_-T*A,y-C*A),s.push(_+T*k,y+C*k));continue}let c=(-S+g)*(-w+y)-(-S+_)*(-w+m),M=(-T+b)*(-C+y)-(-T+_)*(-C+v),R=(i*M-a*c)/h,B=(o*c-n*M)/h,F=(R-_)*(R-_)+(B-y)*(B-y),z=_+(R-_)*k,U=y+(B-y)*k,I=_-(R-_)*A,E=y-(B-y)*A,D=u?k:A;F<=Math.min(i*i+n*n,a*a+o*o)+D*D*p?"bevel"===e.join||F/p>x?(u?(s.push(z,U),s.push(_+S*A,y+w*A),s.push(z,U),s.push(_+T*A,y+C*A)):(s.push(_-S*k,y-w*k),s.push(I,E),s.push(_-T*k,y-C*k),s.push(I,E)),d+=2):"round"===e.join?u?(s.push(z,U),s.push(_+S*A,y+w*A),d+=q(_,y,_+S*A,y+w*A,_+T*A,y+C*A,s,!0)+4,s.push(z,U),s.push(_+T*A,y+C*A)):(s.push(_-S*k,y-w*k),s.push(I,E),d+=q(_,y,_-S*k,y-w*k,_-T*k,y-C*k,s,!1)+4,s.push(_-T*k,y-C*k),s.push(I,E)):(s.push(z,U),s.push(I,E)):(s.push(_-S*k,y-w*k),s.push(_+S*A,y+w*A),"round"===e.join?u?d+=q(_,y,_+S*A,y+w*A,_+T*A,y+C*A,s,!0)+2:d+=q(_,y,_-S*k,y-w*k,_-T*k,y-C*k,s,!1)+2:"miter"===e.join&&F/p<=x&&(u?(s.push(I,E),s.push(I,E)):(s.push(z,U),s.push(z,U)),d+=2),s.push(_-T*k,y-C*k),s.push(_+T*A,y+C*A),d+=2)}g=t[(u-2)*2],m=t[(u-2)*2+1],_=t[(u-1)*2],P=Math.sqrt((S=-(m-(y=t[(u-1)*2+1])))*S+(w=g-_)*w),S/=P,w/=P,S*=f,w*=f,s.push(_-S*k,y-w*k),s.push(_+S*A,y+w*A),i||("round"===e.cap?d+=q(_-S*(k-A)*.5,y-w*(k-A)*.5,_-S*k,y-w*k,_+S*A,y+w*A,s,!1)+2:"square"===e.cap&&(d+=Y(_,y,S,w,k,A,!1,s)));let R=1e-4*1e-4;for(let t=c;t<d+c-2;++t)g=s[2*t],m=s[2*t+1],_=s[(t+1)*2],y=s[(t+1)*2+1],b=s[(t+2)*2],Math.abs(g*(y-(v=s[(t+2)*2+1]))+_*(v-m)+b*(m-y))<R||n.push(t,t+1,t+2)}(d,e,!1,r,a,l)}else if(u){let t=[],e=d.slice();(function(t){let e=[];for(let r=0;r<t.length;r++){let i=t[r].shape,s=[];tS[i.type].build(i,s)&&e.push(s)}return e})(u).forEach(r=>{t.push(e.length/2),e.push(...r)}),tp(e,t,a,2,p,l,f)}else c.triangulate(d,a,2,p,l,f);let g=o.length/2,m=e.texture;if(m!==n.g.WHITE){let r=function(t,e,r,i){let s=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if("local"===e.textureSpace){let t=r.getBounds(tv);e.width&&t.pad(e.width);let{x:i,y:n}=t,a=1/t.width,o=1/t.height,l=-i*a,h=-n*o,u=s.a,d=s.b,c=s.c,f=s.d;s.a*=a,s.b*=a,s.c*=o,s.d*=o,s.tx=l*u+h*c+s.tx,s.ty=l*d+h*f+s.ty}else s.translate(e.texture.frame.x,e.texture.frame.y),s.scale(1/e.texture.source.width,1/e.texture.source.height);let n=e.texture.source.style;return e.fill instanceof ty._||"clamp-to-edge"!==n.addressMode||(n.addressMode="repeat",n.update()),i&&s.append(tb.copyFrom(i).invert()),s}(tT,e,t,h);!function(t,e,r,i,s,n,a,o=null){let l=0;r*=2,s*=2;let h=o.a,u=o.b,d=o.c,c=o.d,f=o.tx,p=o.ty;for(;l<a;){let e=t[r],n=t[r+1];i[s]=h*e+d*n+f,i[s+1]=u*e+c*n+p,s+=2,r+=2,l++}}(a,2,p,o,g,2,a.length/2-p,r)}else{var _=g,y=a.length/2-p;let t=0;for(_*=2;t<y;)o[_]=0,o[_+1]=0,_+=2,t++}let b=O.Z.get($.G);b.indexOffset=f,b.indexSize=l.length-f,b.attributeOffset=p,b.attributeSize=a.length/2-p,b.baseColor=e.color,b.alpha=e.alpha,b.texture=m,b.geometryData=s,b.topology=x,i.push(b)})}class tP{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class tM{constructor(){this.instructions=new G.L}init(t){this.batcher=new D({maxTextures:t}),this.instructions.reset()}get geometry(){return(0,h.t6)(h.Ek,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}let tk=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){t.defaultOptions.bezierSmoothness=e?.bezierSmoothness??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){let{geometryData:r,batches:i}=e;i.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let e=0;e<t.instructions.length;e++){let s=t.instructions[e];if("texture"===s.action)!function(t,e,r){let i=[],s=tS.rectangle;tw.x=t.dx,tw.y=t.dy,tw.width=t.dw,tw.height=t.dh;let n=t.transform;if(!s.build(tw,i))return;let{vertices:a,uvs:o,indices:l}=r,h=l.length,u=a.length/2;n&&L(i,n),s.triangulate(i,a,2,u,l,h);let d=t.image,c=d.uvs;o.push(c.x0,c.y0,c.x1,c.y1,c.x3,c.y3,c.x2,c.y2);let f=O.Z.get($.G);f.indexOffset=h,f.indexSize=l.length-h,f.attributeOffset=u,f.attributeSize=a.length/2-u,f.baseColor=t.style,f.alpha=t.alpha,f.texture=d,f.geometryData=r,e.push(f)}(s.data,i,r);else if("fill"===s.action||"stroke"===s.action){let t="stroke"===s.action,e=s.data.path.shapePath,n=s.data.style,a=s.data.hole;t&&a&&tC(a.shapePath,n,!0,i,r),a&&(e.shapePrimitives[e.shapePrimitives.length-1].holes=a.shapePath.shapePrimitives),tC(e,n,t,i,r)}}}(t,e);let r=t.batchMode;t.customShader||"no-batch"===r?e.isBatchable=!1:"auto"===r?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){let e=O.Z.get(tM,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:r,geometryData:i}=this._gpuContextHash[t.uid],o=i.vertices.length,l=i.indices.length;for(let t=0;t<r.length;t++)r[t].applyTransform=!1;let h=e.batcher;h.ensureAttributeBuffer(o),h.ensureIndexBuffer(l),h.begin();for(let t=0;t<r.length;t++){let e=r[t];h.add(e)}h.finish(e.instructions);let u=h.geometry;u.indexBuffer.setDataWithSize(h.indexBuffer,h.indexSize,!0),u.buffers[0].setDataWithSize(h.attributeBuffer.float32View,h.attributeSize,!0);let d=h.batches;for(let t=0;t<d.length;t++){let e=d[t];e.bindGroup=function(t,e,r){let i=0x811c9dc5;for(let r=0;r<e;r++)i^=t[r].uid,i=Math.imul(i,0x1000193)>>>0;return a[i]||function(t,e,r,i){let o={},l=0;for(let r=0;r<i;r++){let i=r<e?t[r]:n.g.EMPTY.source;o[l++]=i.source,o[l++]=i.style}let h=new s.T(o);return a[r]=h,h}(t,e,i,r)}(e.textures.textures,e.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){let e=new tP;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){let e=this._gpuContextHash[t.uid];!e.isBatchable&&this._graphicsDataContextHash[t.uid]&&(O.Z.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(t=>{O.Z.return(t)})}destroy(){for(let t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};tk.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"graphicsContext"},tk.defaultOptions={bezierSmoothness:.5};let tA=tk},4516:(t,e,r)=>{"use strict";r.d(e,{g:()=>s});class i{constructor(t=0,e=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=r,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){let e=this.items[t];delete this.items[t],this.size--,null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(t=>[t,this.get(t)])}evict(t=!1){if(t||this.size>0){let t=this.first;delete this.items[t.key],0==--this.size?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){let e=this.items[t];if(void 0!==e)return this.ttl>0&&e.expiry<=Date.now()?void this.delete(t):(this.moveToEnd(e),e.value)}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,null!==this.last&&(this.last.next=t),this.last=t,null===this.first&&(this.first=t))}keys(){let t=[],e=this.first;for(;null!==e;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,r=this.resetTtl){let i=null;if(this.has(t))this.set(t,e,!0,r);else{this.max>0&&this.size===this.max&&(i={...this.first},this.evict(!0));let r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};1==++this.size?this.first=r:this.last.next=r,this.last=r}return i}set(t,e,r=!1,i=this.resetTtl){let s=this.items[t];return r||void 0!==s?(s.value=e,!1===r&&i&&(s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(s)):(this.max>0&&this.size===this.max&&this.evict(!0),s=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},1==++this.size?this.first=s:this.last.next=s,this.last=s),this}values(t=this.keys()){return t.map(t=>this.get(t))}}function s(t=1e3,e=0,r=!1){if(isNaN(t)||t<0)throw TypeError("Invalid max value");if(isNaN(e)||e<0)throw TypeError("Invalid ttl value");if("boolean"!=typeof r)throw TypeError("Invalid resetTtl value");return new i(t,e,r)}},6929:(t,e,r)=>{"use strict";let i;var s=r(3230),n=r(52295),a=r(85167),o=r(69655);class l extends o.K{constructor(t){super(),this.generatingTexture=!1,this.currentKey="--",this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){let t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){let{htmlText:t}=this._renderer;null===t.getReferenceCount(this.currentKey)?t.returnTexturePromise(this.texturePromise):t.decreaseReferenceCount(this.currentKey),this._renderer.runners.resolutionChange.remove(this),this.texturePromise=null,this._renderer=null}}class h{constructor(t){this._renderer=t}validateRenderable(t){let e=this._getGpuText(t),r=t.styleKey;return e.currentKey!==r}addRenderable(t,e){let r=this._getGpuText(t);if(t._didTextUpdate){let e=t._autoResolution?this._renderer.resolution:t.resolution;(r.currentKey!==t.styleKey||t.resolution!==e)&&this._updateGpuText(t).catch(t=>{console.error(t)}),t._didTextUpdate=!1,(0,a.s)(r,t)}this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){let e=this._getGpuText(t);e._batcher.updateElement(e)}async _updateGpuText(t){t._didTextUpdate=!1;let e=this._getGpuText(t);if(e.generatingTexture)return;let r=e.texturePromise;e.texturePromise=null,e.generatingTexture=!0,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;let i=this._renderer.htmlText.getTexturePromise(t);r&&(i=i.finally(()=>{this._renderer.htmlText.decreaseReferenceCount(e.currentKey),this._renderer.htmlText.returnTexturePromise(r)})),e.texturePromise=i,e.currentKey=t.styleKey,e.texture=await i;let s=t.renderGroup||t.parentRenderGroup;s&&(s.structureDidChange=!0),e.generatingTexture=!1,(0,a.s)(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){let e=new l(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.texture=n.g.EMPTY,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}h.extension={type:[s.Ag.WebGLPipes,s.Ag.WebGPUPipes,s.Ag.CanvasPipes],name:"htmlText"};var u=r(33749),d=r(56823),c=r(10558),f=r(45737),p=r(42577),x=r(87577),g=r(96671);let m="http://www.w3.org/2000/svg",_="http://www.w3.org/1999/xhtml";class y{constructor(){this.svgRoot=document.createElementNS(m,"svg"),this.foreignObject=document.createElementNS(m,"foreignObject"),this.domElement=document.createElementNS(_,"div"),this.styleElement=document.createElementNS(_,"style");let{foreignObject:t,svgRoot:e,styleElement:r,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i),this.image=f.e.get().createImage()}destroy(){this.svgRoot.remove(),this.foreignObject.remove(),this.styleElement.remove(),this.domElement.remove(),this.image.src="",this.image.remove(),this.svgRoot=null,this.foreignObject=null,this.styleElement=null,this.domElement=null,this.image=null,this.canvasAndContext=null}}var b=r(50878);async function v(t){let e=await f.e.get().fetch(t),r=await e.blob(),i=new FileReader;return await new Promise((t,e)=>{i.onloadend=()=>t(i.result),i.onerror=e,i.readAsDataURL(r)})}async function S(t,e){let r=await v(e);return`@font-face {
        font-family: "${t.fontFamily}";
        font-weight: ${t.fontWeight};
        font-style: ${t.fontStyle};
        src: url('${r}');
    }`}let w=new Map;async function T(t){let e=t.filter(t=>b.l.has(`${t}-and-url`)).map(t=>{if(!w.has(t)){let{entries:e}=b.l.get(`${t}-and-url`),r=[];e.forEach(e=>{let i=e.url,s=e.faces.map(t=>({weight:t.weight,style:t.style}));r.push(...s.map(e=>S({fontWeight:e.weight,fontStyle:e.style,fontFamily:t},i)))}),w.set(t,Promise.all(r).then(t=>t.join("\n")))}return w.get(t)});return(await Promise.all(e)).join("\n")}class C{constructor(t){this._activeTextures={},this._renderer=t,this._createCanvas=t.type===c.W.WEBGPU}getTexture(t){return this.getTexturePromise(t)}getManagedTexture(t){let e=t.styleKey;if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].promise;let r=this._buildTexturePromise(t).then(t=>(this._activeTextures[e].texture=t,t));return this._activeTextures[e]={texture:null,promise:r,usageCount:1},r}getReferenceCount(t){return this._activeTextures[t]?.usageCount??null}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){let e=this._activeTextures[t];e&&(e.usageCount--,0===e.usageCount&&(e.texture?this._cleanUp(e.texture):e.promise.then(t=>{e.texture=t,this._cleanUp(e.texture)}).catch(()=>{(0,p.R)("HTMLTextSystem: Failed to clean texture")}),this._activeTextures[t]=null))}getTexturePromise(t){return this._buildTexturePromise(t)}async _buildTexturePromise(t){var e;let r,{text:s,style:n,resolution:a,textureStyle:o}=t,l=x.Z.get(y),h=function(t,e){let r=e.fontFamily,i=[],s={},n=t.match(/font-family:([^;"\s]+)/g);function a(t){s[t]||(i.push(t),s[t]=!0)}if(Array.isArray(r))for(let t=0;t<r.length;t++)a(r[t]);else a(r);for(let t in n&&n.forEach(t=>{a(t.split(":")[1].trim())}),e.tagStyles)a(e.tagStyles[t].fontFamily);return i}(s,n),d=await T(h),c=function(t,e,r,s){s||(s=i||(i=new y));let{domElement:n,styleElement:a,svgRoot:o}=s;n.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${t}</div>`,n.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(a.textContent=r),document.body.appendChild(o);let l=n.getBoundingClientRect();o.remove();let h=2*e.padding;return{width:l.width-h,height:l.height-h}}(s,n,d,l),p=Math.ceil(Math.ceil(Math.max(1,c.width)+2*n.padding)*a),m=Math.ceil(Math.ceil(Math.max(1,c.height)+2*n.padding)*a),_=l.image;_.width=(0|p)+2,_.height=(0|m)+2;let b=function(t,e,r,i,s){let{domElement:n,styleElement:a,svgRoot:o}=s;n.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${t}</div>`,n.setAttribute("style",`transform: scale(${r});transform-origin: top left; display: inline-block`),a.textContent=i;let{width:l,height:h}=s.image;return o.setAttribute("width",l.toString()),o.setAttribute("height",h.toString()),new XMLSerializer().serializeToString(o)}(s,n,a,d,l);await (e=function(){let{userAgent:t}=f.e.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}()&&h.length>0,new Promise(async t=>{e&&await new Promise(t=>setTimeout(t,100)),_.onload=()=>{t()},_.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(b)}`,_.crossOrigin="anonymous"})),this._createCanvas&&(r=function(t,e){let r=u.N.getOptimalCanvasAndContext(t.width,t.height,e),{context:i}=r;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),r}(_,a));let v=(0,g.M)(r?r.canvas:_,_.width-2,_.height-2,a);return o&&(v.source.style=o),this._createCanvas&&(this._renderer.texture.initSource(v.source),u.N.returnCanvasAndContext(r)),x.Z.return(l),v}returnTexturePromise(t){t.then(t=>{this._cleanUp(t)}).catch(()=>{(0,p.R)("HTMLTextSystem: Failed to clean texture")})}_cleanUp(t){d.W.returnTexture(t,!0),t.source.resource=null,t.source.uploadMethodId="unknown"}destroy(){for(let t in this._renderer=null,this._activeTextures)this._activeTextures[t]&&this.returnTexturePromise(this._activeTextures[t].promise);this._activeTextures=null}}C.extension={type:[s.Ag.WebGLSystem,s.Ag.WebGPUSystem,s.Ag.CanvasSystem],name:"htmlText"},s.XO.add(C),s.XO.add(h)},10558:(t,e,r)=>{"use strict";r.d(e,{W:()=>i});var i=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(i||{})},10627:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});let i=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function s(t){let e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize,r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let t=r.length-1;t>=0;t--){let e=r[t].trim();/([\"\'])[^\'\"]+\1/.test(e)||i.includes(e)||(e=`"${e}"`),r[t]=e}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}},13636:(t,e,r)=>{"use strict";r.d(e,{h:()=>a});var i=r(13799),s=r(43428),n=r(88497);class a extends i.A{constructor(t){let{data:e,size:r}=t,{usage:i,label:n,shrinkToFit:a}=t;super(),this.uid=(0,s.L)("buffer"),this._resourceType="buffer",this._resourceId=(0,s.L)("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,r??(r=e?.byteLength);let o=!!e;this.descriptor={size:r,usage:i,mappedAtCreation:o,label:n},this.shrinkToFit=a??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&n.S.STATIC)}set static(t){t?this.descriptor.usage|=n.S.STATIC:this.descriptor.usage&=~n.S.STATIC}setDataWithSize(t,e,r){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){r&&this.emit("update",this);return}let i=this._data;if(this._data=t,this._dataInt32=null,!i||i.length!==t.length)return void(!this.shrinkToFit&&i&&t.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=(0,s.L)("resource"),this.emit("change",this)));r&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}},14198:(t,e,r)=>{"use strict";let i,s;var n=r(3230),a=r(50878),o=r(51631),l=r(27440),h=r(32139);class u extends l.l{constructor(t){t instanceof h.T&&(t={context:t});let{context:e,roundPixels:r,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new h.T,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=r??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(!0===t||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new u(this._context.clone()):(this._ownedContext=null,new u(this._context))}lineStyle(t,e,r){(0,o.t6)(o.lj,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");let i={};return t&&(i.width=t),e&&(i.color=e),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(t,e){(0,o.t6)(o.lj,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");let r={};return void 0!==t&&(r.color=t),void 0!==e&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){(0,o.t6)(o.lj,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();let t=this.context.strokeStyle;return(t.width!==h.T.defaultStrokeStyle.width||t.color!==h.T.defaultStrokeStyle.color||t.alpha!==h.T.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return(0,o.t6)(o.lj,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return(0,o.t6)(o.lj,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return(0,o.t6)(o.lj,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return(0,o.t6)(o.lj,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return(0,o.t6)(o.lj,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return(0,o.t6)(o.lj,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}var d=r(88589),c=r(62104),f=r(31368),p=r(86942),x=r(16141),g=r(20144),m=r(18709),_=r(622),y=r(55103);let b={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:`
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},v={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:`
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}},S={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {

                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;

            }
        `}},w={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {

                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);

                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);

                return coverage;
            }
        `}};class T extends _.M{constructor(t){let e=new y.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new c.u,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});i??(i=(0,f.v)({name:"sdf-shader",bits:[p.F,(0,x._)(t),b,S,g.b]})),s??(s=(0,f.I)({name:"sdf-shader",bits:[p.a,(0,x.P)(t),v,w,g.m]})),super({glProgram:s,gpuProgram:i,resources:{localUniforms:e,batchSamplers:(0,m.n)(t)}})}}var C=r(4516),P=r(42577),M=r(80406),k=r(20177),A=r(92809),R=r(33749),B=r(25460),F=r(52295),z=r(9715),U=r(10627),I=r(73009),E=r(13799);class D extends E.A{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,o.t6)(o.lj,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,o.t6)(o.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,o.t6)(o.lj,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,o.t6)(o.lj,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,o.t6)(o.lj,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){for(let t in this.emit("destroy",this),this.removeAllListeners(),this.chars)this.chars[t].texture?.destroy();this.chars=null,t&&(this.pages.forEach(t=>t.texture.destroy(!0)),this.pages=null)}}let G=class t extends D{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;let r={...t.defaultOptions,...e};this._textureSize=r.textureSize,this._mipmap=r.mipmap;let i=r.style.clone();r.overrideFill&&(i._fill.color=0xffffff,i._fill.alpha=1,i._fill.texture=F.g.WHITE,i._fill.fill=null),this.applyFillAsTint=r.overrideFill;let s=i.fontSize;i.fontSize=this.baseMeasurementFontSize;let n=(0,U.Z)(i);r.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/s):i.fontSize=this.baseRenderedFontSize=s,this._style=i,this._skipKerning=r.skipKerning??!1,this.resolution=r.resolution??1,this._padding=r.padding??4,r.textureStyle&&(this._textureStyle=r.textureStyle instanceof z.n?r.textureStyle:new z.n(r.textureStyle)),this.fontMetrics=d.P.measureFont(n),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){let e,r=d.P.graphemeSegmenter(t).filter(t=>!this._currentChars.includes(t)).filter((t,e,r)=>r.indexOf(t)===e);if(!r.length)return;this._currentChars=[...this._currentChars,...r];let{canvas:i,context:s}=(e=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex]).canvasAndContext,n=e.texture.source,a=this._style,o=this._currentX,l=this._currentY,h=this._currentMaxCharHeight,u=this.baseRenderedFontSize/this.baseMeasurementFontSize,c=this._padding*u,f=!1,p=i.width/this.resolution,x=i.height/this.resolution;for(let t=0;t<r.length;t++){let e=r[t],g=d.P.measureText(e,a,i,!1);g.lineHeight=g.height;let m=g.width*u,_=Math.ceil(("italic"===a.fontStyle?2:1)*m),y=g.height*u,b=_+2*c,v=y+2*c;if(f=!1,"\n"!==e&&"\r"!==e&&"	"!==e&&" "!==e&&(f=!0,h=Math.ceil(Math.max(v,h))),o+b>p&&(o=0,(l+=h)+(h=v)>x)){n.update();let t=this._nextPage();i=t.canvasAndContext.canvas,s=t.canvasAndContext.context,n=t.texture.source,o=0,l=0,h=0}let S=m/u-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[e]={id:e.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:S,kerning:{}},f){this._drawGlyph(s,g,o+c,l+c,u,a);let t=n.width*u,r=n.height*u,i=new A.M(o/t*n.width,l/r*n.height,b/t*n.width,v/r*n.height);this.chars[e].texture=new F.g({source:n,frame:i}),o+=Math.ceil(b)}}n.update(),this._currentX=o,this._currentY=l,this._currentMaxCharHeight=h,this._skipKerning&&this._applyKerning(r,s)}get pageTextures(){return(0,o.t6)(o.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){let r=this._measureCache;for(let i=0;i<t.length;i++){let s=t[i];for(let t=0;t<this._currentChars.length;t++){let i=this._currentChars[t],n=r[s];n||(n=r[s]=e.measureText(s).width);let a=r[i];a||(a=r[i]=e.measureText(i).width);let o=e.measureText(s+i).width,l=o-(n+a);l&&(this.chars[s].kerning[i]=l),(l=(o=e.measureText(s+i).width)-(n+a))&&(this.chars[i].kerning[s]=l)}}}_nextPage(){this._currentPageIndex++;let t=this.resolution,e=R.N.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);let r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new F.g({source:new B.b({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(i.source.style=this._textureStyle);let s={canvasAndContext:e,texture:i};return this.pages[this._currentPageIndex]=s,s}_setupContext(t,e,r){e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=(0,U.Z)(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;let i=e._stroke,s=i?.width??0;if(i&&(t.lineWidth=s,t.lineJoin=i.join,t.miterLimit=i.miterLimit,t.strokeStyle=(0,I.r)(i,t)),e._fill&&(t.fillStyle=(0,I.r)(e._fill,t)),e.dropShadow){let i=e.dropShadow,s=k.Q.shared.setValue(i.color).toArray(),n=i.blur*r,a=i.distance*r;t.shadowColor=`rgba(${255*s[0]},${255*s[1]},${255*s[2]},${i.alpha})`,t.shadowBlur=n,t.shadowOffsetX=Math.cos(i.angle)*a,t.shadowOffsetY=Math.sin(i.angle)*a}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,i,s,n){let a=e.text,o=e.fontProperties,l=n._stroke,h=(l?.width??0)*s,u=r+h/2,d=i-h/2,c=o.descent*s,f=e.lineHeight*s,p=!1;n.stroke&&h&&(p=!0,t.strokeText(a,u,d+f-c));let{shadowBlur:x,shadowOffsetX:g,shadowOffsetY:m}=t;n._fill&&(p&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,u,d+f-c)),p&&(t.shadowBlur=x,t.shadowOffsetX=g,t.shadowOffsetY=m)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){let{canvasAndContext:e,texture:r}=this.pages[t];R.N.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};function O(t,e,r,i){let s={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};s.offsetY=r.baseLineOffset;let n=s.lines[0],a=null,o=!0,l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=r.baseMeasurementFontSize/e.fontSize,u=e.letterSpacing*h,d=e.wordWrapWidth*h,c=e.lineHeight?e.lineHeight*h:r.lineHeight,f=e.wordWrap&&e.breakWords,p=t=>{let e=n.width;for(let r=0;r<l.index;r++){let i=t.positions[r];n.chars.push(t.chars[r]),n.charPositions.push(i+e)}n.width+=t.width,o=!1,l.width=0,l.index=0,l.chars.length=0},x=()=>{let t=n.chars.length-1;if(i){let e=n.chars[t];for(;" "===e;)n.width-=r.chars[e].xAdvance,e=n.chars[--t]}s.width=Math.max(s.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,s.lines.push(n),s.height+=c},g=t=>t-u>d;for(let i=0;i<t.length+1;i++){let s,h=i===t.length;h||(s=t[i]);let d=r.chars[s]||r.chars[" "];if(/(?:\s)/.test(s)||"\r"===s||"\n"===s||h){if(!o&&e.wordWrap&&g(n.width+l.width)?x():l.start=n.width,p(l),h||n.charPositions.push(0),"\r"===s||"\n"===s)x();else if(!h){let t=d.xAdvance+(d.kerning[a]||0)+u;n.width+=t,n.spaceWidth=t,n.spacesIndex.push(n.charPositions.length),n.chars.push(s)}}else{let t=d.kerning[a]||0,e=d.xAdvance+t+u;f&&g(n.width+l.width+e)&&(p(l),x()),l.positions[l.index++]=l.width+t,l.chars.push(s),l.width+=e}a=s}return x(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){let r=t.lines[e],i=t.width/2-r.width/2;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(s):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){let r=t.lines[e],i=t.width-r.width;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(s):"justify"===e.align&&function(t){let e=t.width;for(let r=0;r<t.lines.length;r++){let i=t.lines[r],s=0,n=i.spacesIndex[s++],a=0,o=i.spacesIndex.length,l=(e-i.width)/o;for(let t=0;t<i.charPositions.length;t++)t===n&&(n=i.spacesIndex[s++],a+=l),i.charPositions[t]+=a}}(s),s}G.defaultOptions={textureSize:512,style:new M.x,mipmap:!0};let V=0;class W{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=(0,C.g)(1e3)}getFont(t,e){let r=`${e.fontFamily}-bitmap`,i=!0;if(e._fill.fill&&!e._stroke?(r+=e._fill.fill.styleKey,i=!1):(e._stroke||e.dropShadow)&&(r=`${e.styleKey}-bitmap`,i=!1),!a.l.has(r)){let t=Object.create(e);t.lineHeight=0;let s=new G({style:t,overrideFill:i,overrideSize:!0,...this.defaultOptions});++V>50&&(0,P.R)("BitmapText",`You have dynamically created ${V} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),s.once("destroy",()=>{V--,a.l.remove(r)}),a.l.set(r,s)}let s=a.l.get(r);return s.ensureCharacters?.(t),s}getLayout(t,e,r=!0){let i=this.getFont(t,e),s=`${t}-${e.styleKey}-${r}`;if(this.measureCache.has(s))return this.measureCache.get(s);let n=O(d.P.graphemeSegmenter(t),e,i,r);return this.measureCache.set(s,n),n}measureText(t,e,r=!0){return this.getLayout(t,e,r)}install(...t){let e=t[0];"string"==typeof e&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},(0,o.t6)(o.lj,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));let r=e?.name;if(!r)throw Error("[BitmapFontManager] Property `name` is required.");let i=(e={...this.defaultOptions,...e}).style,s=i instanceof M.x?i:new M.x(i),n=e.dynamicFill??this._canUseTintForStyle(s),l=new G({style:s,overrideFill:n,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),h=function(t){if(""===t)return[];"string"==typeof t&&(t=[t]);let e=[];for(let r=0,i=t.length;r<i;r++){let i=t[r];if(Array.isArray(i)){if(2!==i.length)throw Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(0===i[0].length||0===i[1].length)throw Error("[BitmapFont]: Invalid character delimiter.");let t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw Error("[BitmapFont]: Invalid character range.");for(let i=t;i<=r;i++)e.push(String.fromCharCode(i))}else e.push(...Array.from(i))}if(0===e.length)throw Error("[BitmapFont]: Empty set when resolving characters.");return e}(e.chars);return l.ensureCharacters(h.join("")),a.l.set(`${r}-bitmap`,l),l.once("destroy",()=>a.l.remove(`${r}-bitmap`)),l}uninstall(t){let e=`${t}-bitmap`,r=a.l.get(e);r&&r.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||0===t.dropShadow.color)&&!t._fill.fill&&0xffffff===t._fill.color}}let L=new W;class $ extends u{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class H{constructor(t){this._renderer=t}validateRenderable(t){let e=this._getGpuBitmapText(t);return this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){let r=this._getGpuBitmapText(t);N(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}updateRenderable(t){let e=this._getGpuBitmapText(t);N(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){let{context:r}=e,i=L.getFont(t.text,t._style);r.clear(),"none"===i.distanceField.type||r.customShader||(r.customShader=new T(this._renderer.limits.maxBatchableTextures));let s=d.P.graphemeSegmenter(t.text),n=t._style,a=i.baseLineOffset,o=O(s,n,i,!0),l=n.padding,h=o.scale,u=o.width,c=o.height+o.offsetY;n._stroke&&(u+=n._stroke.width/h,c+=n._stroke.width/h),r.translate(-t._anchor._x*u-l,-t._anchor._y*c-l).scale(h,h);let f=i.applyFillAsTint?n._fill.color:0xffffff,p=i.fontMetrics.fontSize,x=i.lineHeight;n.lineHeight&&(p=n.fontSize/h,x=n.lineHeight/h);let g=(x-p)/2;g-i.baseLineOffset<0&&(g=0);for(let t=0;t<o.lines.length;t++){let e=o.lines[t];for(let t=0;t<e.charPositions.length;t++){let s=e.chars[t],n=i.chars[s];if(n?.texture){let i=n.texture;r.texture(i,f||"black",Math.round(e.charPositions[t]+n.xOffset),Math.round(a+n.yOffset+g),i.orig.width,i.orig.height)}}a+=x}}_getGpuBitmapText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){let e=new $;return t._gpuData[this._renderer.uid]=e,this._updateContext(t,e),e}_updateDistanceField(t){let e=this._getGpuBitmapText(t).context,r=t._style.fontFamily,i=a.l.get(`${r}-bitmap`),{a:s,b:n,c:o,d:l}=t.groupTransform,h=(Math.abs(Math.sqrt(s*s+n*n))+Math.abs(Math.sqrt(o*o+l*l)))/2,u=i.baseRenderedFontSize/t._style.fontSize,d=h*i.distanceField.range*(1/u);e.customShader.resources.localUniforms.uniforms.uDistance=d}destroy(){this._renderer=null}}function N(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}H.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"bitmapText"},n.XO.add(H)},16003:t=>{t.exports=function(t){var s=[];return t.replace(r,function(t,r,n){var a,o=r.toLowerCase();for(n=(a=n.match(i))?a.map(Number):[],"m"==o&&n.length>2&&(s.push([r].concat(n.splice(0,2))),o="l",r="m"==r?"l":"L");;){if(n.length==e[o])return n.unshift(r),s.push(n);if(n.length<e[o])throw Error("malformed path data");s.push([r].concat(n.splice(0,e[o])))}}),s};var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/ig,i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig},16141:(t,e,r)=>{"use strict";r.d(e,{P:()=>a,_:()=>s});let i={};function s(t){return i[t]||(i[t]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${function(t){let e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let i=0;i<t;i++)e.push(`@group(1) @binding(${r++}) var textureSource${i+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${i+1}: sampler;`)}return e.join("\n")}(t)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${function(t){let e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join("\n")}(t)}
            `}}),i[t]}let n={};function a(t){return n[t]||(n[t]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${t}];

            `,main:`

                ${function(t){let e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join("\n")}(t)}
            `}}),n[t]}},18016:(t,e,r)=>{"use strict";var i=r(3230);class s{execute(t,e){let r=t.state,i=t.renderer,s=e.shader||t.defaultShader;s.resources.uTexture=e.texture._source,s.resources.uniforms=t.localUniforms;let n=i.gl,a=t.getBuffers(e);i.shader.bind(s),i.state.set(r),i.geometry.bind(a.geometry,s.glProgram);let o=2===a.geometry.indexBuffer.data.BYTES_PER_ELEMENT?n.UNSIGNED_SHORT:n.UNSIGNED_INT;n.drawElements(n.TRIANGLES,6*e.particleChildren.length,o,0)}}var n=r(62104),a=r(55103),o=r(93087),l=r(71854),h=r(82069),u=r(13636),d=r(88497),c=r(25891),f=r(29755),p=r(43977);function x(t,e=null){let r=6*t;if(r>65535?e||(e=new Uint32Array(r)):e||(e=new Uint16Array(r)),e.length!==r)throw Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,i=0;t<r;t+=6,i+=4)e[t+0]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3;return e}function g(t,e){let r=[];r.push(`

        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let i=0;for(let s in t){let n=t[s];e===n.dynamic&&(r.push(`offset = index + ${i}`),r.push(n.code),i+=(0,f.m)(n.format).stride/4)}return r.push(`
            index += stride * 4;
        }
    `),r.unshift(`
        var stride = ${i};
    `),Function("ps","f32v","u32v",r.join("\n"))}class m{constructor(t){this._size=0,this._generateParticleUpdateCache={};let e=this._size=t.size??1e3,r=t.properties,i=0,s=0;for(let t in r){let e=r[t],n=(0,f.m)(e.format);e.dynamic?s+=n.stride:i+=n.stride}this._dynamicStride=s/4,this._staticStride=i/4,this.staticAttributeBuffer=new p.u(4*e*i),this.dynamicAttributeBuffer=new p.u(4*e*s),this.indexBuffer=x(e);let n=new c.V,a=0,o=0;for(let t in this._staticBuffer=new u.h({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:d.S.VERTEX|d.S.COPY_DST}),this._dynamicBuffer=new u.h({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:d.S.VERTEX|d.S.COPY_DST}),r){let e=r[t],i=(0,f.m)(e.format);e.dynamic?(n.addAttribute(e.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*a,format:e.format}),a+=i.size):(n.addAttribute(e.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*o,format:e.format}),o+=i.size)}n.addIndex(this.indexBuffer);let l=this.getParticleUpdate(r);this._dynamicUpload=l.dynamicUpdate,this._staticUpload=l.staticUpdate,this.geometry=n}getParticleUpdate(t){let e=function(t){let e=[];for(let r in t){let i=t[r];e.push(r,i.code,i.dynamic?"d":"s")}return e.join("_")}(t);return this._generateParticleUpdateCache[e]||(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t)),this._generateParticleUpdateCache[e]}generateParticleUpdate(t){return{dynamicUpdate:g(t,!0),staticUpdate:g(t,!1)}}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,1.5*this._size|0),this.staticAttributeBuffer=new p.u(this._size*this._staticStride*16),this.dynamicAttributeBuffer=new p.u(this._size*this._dynamicStride*16),this.indexBuffer=x(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));let r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){let e=this.staticAttributeBuffer;this._staticUpload(t,e.float32View,e.uint32View),this._staticBuffer.setDataWithSize(e.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var _=r(20177),y=r(68526),b=r(84597),v=r(622),S=r(52295),w=r(9715),T="\nstruct ParticleUniforms {\n  uTranslationMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uRound:f32,\n  uResolution:vec2<f32>,\n};\n\nfn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>\n{\n  return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   var position = vec4((uniforms.uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n   if(uniforms.uRound == 1.0) {\n       position = vec4(roundPixels(position.xy, uniforms.uResolution), position.zw);\n   }\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class C extends v.M{constructor(){super({glProgram:y.M.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:b.B.from({fragment:{source:T,entryPoint:"mainFragment"},vertex:{source:T,entryPoint:"mainVertex"}}),resources:{uTexture:S.g.WHITE.source,uSampler:new w.n({}),uniforms:{uTranslationMatrix:{value:new n.u,type:"mat3x3<f32>"},uColor:{value:new _.Q(0xffffff),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class P{constructor(t,e){this.state=l.U.for2d(),this.localUniforms=new a.k({uTranslationMatrix:{value:new n.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new C,this.state=l.U.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return t._gpuData[this.renderer.uid]||this._initBuffer(t)}_initBuffer(t){return t._gpuData[this.renderer.uid]=new m({size:t.particleChildren.length,properties:t._properties}),t._gpuData[this.renderer.uid]}updateRenderable(t){}execute(t){let e=t.particleChildren;if(0===e.length)return;let r=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);let s=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,s.blendMode=(0,o.i)(t.blendMode,t.texture._source);let n=this.localUniforms.uniforms,a=n.uTranslationMatrix;t.worldTransform.copyTo(a),a.prepend(r.globalUniforms.globalUniformData.projectionMatrix),n.uResolution=r.globalUniforms.globalUniformData.resolution,n.uRound=r._roundPixels|t._roundPixels,(0,h.V)(t.groupColorAlpha,n.uColor,0),this.adaptor.execute(this,t)}destroy(){this.renderer=null,this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class M extends P{constructor(t){super(t,new s)}}M.extension={type:[i.Ag.WebGLPipes],name:"particle"};class k{execute(t,e){let r=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(e.texture);let s=t.state,n=t.getBuffers(e);r.encoder.draw({geometry:n.geometry,shader:e.shader||t.defaultShader,state:s,size:6*e.particleChildren.length})}}class A extends P{constructor(t){super(t,new k)}}A.extension={type:[i.Ag.WebGPUPipes],name:"particle"},i.XO.add(M),i.XO.add(A)},18709:(t,e,r)=>{"use strict";r.d(e,{n:()=>n});var i=r(55103);let s={};function n(t){let e=s[t];if(e)return e;let r=new Int32Array(t);for(let e=0;e<t;e++)r[e]=e;return s[t]=new i.k({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0})}},19168:(t,e,r)=>{"use strict";let i,s;var n=r(3230),a=r(93087),o=r(71854),l=r(10558),h=r(82069),u=r(61583),d=r(41849),c=r(62104),f=r(31368);let p={name:"local-uniform-bit",vertex:{header:`

            struct LocalUniforms {
                uTransformMatrix:mat3x3<f32>,
                uColor:vec4<f32>,
                uRound:f32,
            }

            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `}};({...p,vertex:{...p.vertex,header:p.vertex.header.replace("group(1)","group(2)")}});let x={name:"local-uniform-bit",vertex:{header:`

            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix = uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `}};var g=r(20144),m=r(622),_=r(55103),y=r(52295);let b={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            }

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},v={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;

        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0

        `}};class S extends m.M{constructor(){i??(i=(0,f.v)({name:"tiling-sprite-shader",bits:[p,b,g.b]})),s??(s=(0,f.I)({name:"tiling-sprite-shader",bits:[x,v,g.m]})),super({glProgram:s,gpuProgram:i,resources:{localUniforms:new _.k({uTransformMatrix:{value:new c.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:new _.k({uMapCoord:{value:new c.u,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new c.u,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}}),uTexture:y.g.EMPTY.source,uSampler:y.g.EMPTY.source.style}})}updateUniforms(t,e,r,i,s,n){let a=this.resources.tilingUniforms,o=n.width,l=n.height,h=n.textureMatrix,u=a.uniforms.uTextureTransform;u.set(r.a*o/t,r.b*o/e,r.c*l/t,r.d*l/e,r.tx/t,r.ty/e),u.invert(),a.uniforms.uMapCoord=h.mapCoord,a.uniforms.uClampFrame=h.uClampFrame,a.uniforms.uClampOffset=h.uClampOffset,a.uniforms.uTextureTransform=u,a.uniforms.uSizeAnchor[0]=t,a.uniforms.uSizeAnchor[1]=e,a.uniforms.uSizeAnchor[2]=i,a.uniforms.uSizeAnchor[3]=s,n&&(this.resources.uTexture=n.source,this.resources.uSampler=n.source.style)}}class w extends d.u{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}let T=new w;class C{constructor(){this.canBatch=!0,this.geometry=new d.u({indices:T.indices.slice(),positions:T.positions.slice(),uvs:T.uvs.slice()})}destroy(){this.geometry.destroy(),this.shader?.destroy()}}class P{constructor(t){this._state=o.U.default2d,this._renderer=t}validateRenderable(t){let e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);let i=e.canBatch;if(i&&i===r){let{batchableMesh:r}=e;return!r._batcher.checkAndUpdateTexture(r,t.texture)}return r!==i}addRenderable(t,e){let r=this._renderer.renderPipes.batch;this._updateCanBatch(t);let i=this._getTilingSpriteData(t),{geometry:s,canBatch:n}=i;if(n){i.batchableMesh||(i.batchableMesh=new u.U);let n=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),n.geometry=s,n.renderable=t,n.transform=t.groupTransform,n.setTexture(t._texture)),n.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(n,e)}else r.break(e),i.shader||(i.shader=new S),this.updateRenderable(t),e.add(t)}execute(t){let{shader:e}=this._getTilingSpriteData(t);e.groups[0]=this._renderer.globalUniforms.bindGroup;let r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,(0,h.V)(t.groupColorAlpha,r.uColor,0),this._state.blendMode=(0,a.i)(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:T,shader:e,state:this._state})}updateRenderable(t){let e=this._getTilingSpriteData(t),{canBatch:r}=e;if(r){let{batchableMesh:r}=e;t.didViewUpdate&&this._updateBatchableMesh(t),r._batcher.updateElement(r)}else if(t.didViewUpdate){let{shader:r}=e;r.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}_getTilingSpriteData(t){return t._gpuData[this._renderer.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){let e=new C;return e.renderable=t,t._gpuData[this._renderer.uid]=e,e}_updateBatchableMesh(t){let{geometry:e}=this._getTilingSpriteData(t),r=t.texture.source.style;"repeat"!==r.addressMode&&(r.addressMode="repeat",r.update()),function(t,e){let r=t.texture,i=r.frame.width,s=r.frame.height,n=0,a=0;t.applyAnchorToTexture&&(n=t.anchor.x,a=t.anchor.y),e[0]=e[6]=-n,e[2]=e[4]=1-n,e[1]=e[3]=-a,e[5]=e[7]=1-a;let o=c.u.shared;o.copyFrom(t._tileTransform.matrix),o.tx/=t.width,o.ty/=t.height,o.invert(),o.scale(t.width/i,t.height/s),function(t,e,r,i){let s=0,n=t.length/2,a=i.a,o=i.b,l=i.c,h=i.d,u=i.tx,d=i.ty;for(r*=2;s<n;){let i=t[r],n=t[r+1];t[r]=a*i+l*n+u,t[r+1]=o*i+h*n+d,r+=e,s++}}(e,2,0,o)}(t,e.uvs);var i=e.positions;let s=t.anchor.x,n=t.anchor.y;i[0]=-s*t.width,i[1]=-n*t.height,i[2]=(1-s)*t.width,i[3]=-n*t.height,i[4]=(1-s)*t.width,i[5]=(1-n)*t.height,i[6]=-s*t.width,i[7]=(1-n)*t.height}destroy(){this._renderer=null}_updateCanBatch(t){let e=this._getTilingSpriteData(t),r=t.texture,i=!0;return this._renderer.type===l.W.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}P.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"tilingSprite"},n.XO.add(P)},20144:(t,e,r)=>{"use strict";r.d(e,{b:()=>i,m:()=>s});let i={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},s={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}}},23411:(t,e,r)=>{"use strict";var i=r(3230);class s{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{let t,e;if(this._resizeTo){if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{let{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}s.extension=i.Ag.Application;var n=r(34595),a=r(66099);class o{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,n.d.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?a.R.shared:new a.R,t.autoStart&&this.start()}static destroy(){if(this._ticker){let t=this._ticker;this.ticker=null,t.destroy()}}}o.extension=i.Ag.Application,i.XO.add(s),i.XO.add(o)},24077:(t,e,r)=>{"use strict";r.d(e,{X:()=>n});let i=Object.create(null),s=Object.create(null);function n(t,e){let r=s[t];return void 0===r&&(void 0===i[e]&&(i[e]=1),s[t]=r=i[e]++),r}},25815:(t,e,r)=>{"use strict";r.d(e,{m:()=>a});var i=r(62104),s=r(43428);let n={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class a{constructor(t,e){this.uid=(0,s.L)("fillPattern"),this._tick=0,this.transform=new i.u,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=n[e].addressModeU,t.source.style.addressModeV=n[e].addressModeV)}setTransform(t){let e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}},25891:(t,e,r)=>{"use strict";r.d(e,{V:()=>h});var i=r(13799),s=r(45033),n=r(43428),a=r(13636),o=r(88497);function l(t,e){if(!(t instanceof a.h)){let r=e?o.S.INDEX:o.S.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=o.S.INDEX|o.S.COPY_DST):(t=new Float32Array(t),r=o.S.VERTEX|o.S.COPY_DST)),t=new a.h({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}class h extends i.A{constructor(t={}){super(),this.uid=(0,n.L)("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new s.c,this._boundsDirty=!0;let{attributes:e,indexBuffer:r,topology:i}=t;if(this.buffers=[],this.attributes={},e)for(let t in e)this.addAttribute(t,e[t]);this.instanceCount=t.instanceCount??1,r&&this.addIndex(r),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(let t in this.attributes){let e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){var r;let i=(((r=e)instanceof a.h||Array.isArray(r)||r.BYTES_PER_ELEMENT)&&(r={buffer:r}),r.buffer=l(r.buffer,!1),r);-1===this.buffers.indexOf(i.buffer)&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=i}addIndex(t){this.indexBuffer=l(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,function(t,e,r){let i=t.getAttribute(e);if(!i)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;let s=i.buffer.data,n=1/0,a=1/0,o=-1/0,l=-1/0,h=s.BYTES_PER_ELEMENT,u=(i.offset||0)/h,d=(i.stride||8)/h;for(let t=u;t<s.length;t+=d){let e=s[t],r=s[t+1];e>o&&(o=e),r>l&&(l=r),e<n&&(n=e),r<a&&(a=r)}return r.minX=n,r.minY=a,r.maxX=o,r.maxY=l,r}(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(t=>t.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}},29755:(t,e,r)=>{"use strict";r.d(e,{m:()=>s});let i={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function s(t){return i[t]??i.float32}},31368:(t,e,r)=>{"use strict";r.d(e,{I:()=>C,v:()=>T});var i=r(68526),s=r(84597),n=r(42577);function a(t,e,r){if(t)for(let i in t){let s=e[i.toLocaleLowerCase()];if(s){let e=t[i];"header"===i&&(e=e.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&s.push(`//----${r}----//`),s.push(e)}else(0,n.R)(`${i} placement hook does not exist in shader`)}}let o=/\{\{(.*?)\}\}/g;function l(t){let e={};return(t.match(o)?.map(t=>t.replace(/[{()}]/g,""))??[]).forEach(t=>{e[t]=[]}),e}function h(t,e){let r,i=/@in\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function u(t,e,r=!1){let i=[];h(e,i),t.forEach(t=>{t.header&&h(t.header,i)}),r&&i.sort();let s=i.map((t,e)=>`       @location(${e}) ${t},`).join("\n"),n=e.replace(/@in\s+[^;]+;\s*/g,"");return n.replace("{{in}}",`
${s}
`)}function d(t,e){let r,i=/@out\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function c(t,e){let r=t;for(let t in e){let i=e[t];r=i.join("\n").length?r.replace(`{{${t}}}`,`//-----${t} START-----//
${i.join("\n")}
//----${t} FINISH----//`):r.replace(`{{${t}}}`,"")}return r}let f=Object.create(null),p=new Map,x=0;function g(t,e){return e.map(t=>(p.has(t)||p.set(t,x++),p.get(t))).sort((t,e)=>t-e).join("-")+t.vertex+t.fragment}function m(t,e,r){let i=l(t),s=l(e);return r.forEach(t=>{a(t.vertex,i,t.name),a(t.fragment,s,t.name)}),{vertex:c(t,i),fragment:c(e,s)}}let _=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,y=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,b=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,v=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,S={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},w={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function T({bits:t,name:e}){let r=function({template:t,bits:e}){let r=g(t,e);if(f[r])return f[r];let{vertex:i,fragment:s}=function(t,e){let r=e.map(t=>t.vertex).filter(t=>!!t),i=e.map(t=>t.fragment).filter(t=>!!t),s=u(r,t.vertex,!0);return{vertex:s=function(t,e){let r=[];d(e,r),t.forEach(t=>{t.header&&d(t.header,r)});let i=0,s=r.sort().map(t=>t.indexOf("builtin")>-1?t:`@location(${i++}) ${t}`).join(",\n"),n=r.sort().map(t=>`       var ${t.replace(/@.*?\s+/g,"")};`).join("\n"),a=`return VSOutput(
            ${r.sort().map(t=>` ${function(t){let e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}(t)}`).join(",\n")});`,o=e.replace(/@out\s+[^;]+;\s*/g,"");return(o=(o=o.replace("{{struct}}",`
${s}
`)).replace("{{start}}",`
${n}
`)).replace("{{return}}",`
${a}
`)}(r,s),fragment:u(i,t.fragment,!0)}}(t,e);return f[r]=m(i,s,e),f[r]}({template:{fragment:y,vertex:_},bits:[S,...t]});return s.B.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function C({bits:t,name:e}){return new i.M({name:e,...function({template:t,bits:e}){let r=g(t,e);return f[r]||(f[r]=m(t.vertex,t.fragment,e)),f[r]}({template:{vertex:b,fragment:v},bits:[w,...t]})})}},32139:(t,e,r)=>{"use strict";let i,s;r.d(e,{T:()=>$});var n=r(13799),a=r(20177),o=r(62104),l=r(88188),h=r(52295),u=r(43428),d=r(51631),c=r(45033),f=r(42577),p=r(16003),x=r(92809);class g{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new g(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;let r=this.radius*this.radius,i=this.x-t,s=this.y-e;return i*=i,s*=s,i+s<=r}strokeContains(t,e,r,i=.5){if(0===this.radius)return!1;let s=this.x-t,n=this.y-e,a=this.radius,o=(1-i)*r,l=Math.sqrt(s*s+n*n);return l<=a+o&&l>a-(r-o)}getBounds(t){return t||(t=new x.M),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class m{constructor(t=0,e=0,r=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new m(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(t,e,r,i=.5){let{halfWidth:s,halfHeight:n}=this;if(s<=0||n<=0)return!1;let a=r*(1-i),o=r-a,l=s-o,h=n-o,u=s+a,d=n+a,c=t-this.x,f=e-this.y;return c*c/(l*l)+f*f/(h*h)>1&&c*c/(u*u)+f*f/(d*d)<=1}getBounds(t){return t||(t=new x.M),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}class _{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){let t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.closePath=!0}isClockwise(){let t=0,e=this.points,r=e.length;for(let i=0;i<r;i+=2){let s=e[i],n=e[i+1];t+=(e[(i+2)%r]-s)*(e[(i+3)%r]+n)}return t<0}containsPolygon(t){let e=this.getBounds(i),r=t.getBounds(s);if(!e.containsRect(r))return!1;let n=t.points;for(let t=0;t<n.length;t+=2){let e=n[t],r=n[t+1];if(!this.contains(e,r))return!1}return!0}clone(){let t=new _(this.points.slice());return t.closePath=this.closePath,t}contains(t,e){let r=!1,i=this.points.length/2;for(let s=0,n=i-1;s<i;n=s++){let i=this.points[2*s],a=this.points[2*s+1],o=this.points[2*n],l=this.points[2*n+1];a>e!=l>e&&t<(e-a)/(l-a)*(o-i)+i&&(r=!r)}return r}strokeContains(t,e,r,i=.5){let s=r*r,n=s*(1-i),a=s-n,{points:o}=this,l=o.length-2*!this.closePath;for(let r=0;r<l;r+=2){let i=o[r],s=o[r+1],l=o[(r+2)%o.length],h=o[(r+3)%o.length];if(function(t,e,r,i,s,n){let a,o,l=s-r,h=n-i,u=l*l+h*h,d=-1;0!==u&&(d=((t-r)*l+(e-i)*h)/u),d<0?(a=r,o=i):d>1?(a=s,o=n):(a=r+d*l,o=i+d*h);let c=t-a,f=e-o;return c*c+f*f}(t,e,i,s,l,h)<=(0>Math.sign((l-i)*(e-s)-(h-s)*(t-i))?a:n))return!0}return!1}getBounds(t){t||(t=new x.M);let e=this.points,r=1/0,i=-1/0,s=1/0,n=-1/0;for(let t=0,a=e.length;t<a;t+=2){let a=e[t],o=e[t+1];r=a<r?a:r,i=a>i?a:i,s=o<s?o:s,n=o>n?o:n}return t.x=r,t.width=i-r,t.y=s,t.height=n-s,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return(0,d.t6)("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return(0,d.t6)("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}let y=(t,e,r,i,s,n,a)=>{let o=t-r,l=e-i,h=Math.sqrt(o*o+l*l);return h>=s-n&&h<=s+a};class b{constructor(t=0,e=0,r=0,i=0,s=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=s}getBounds(t){return t||(t=new x.M),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new b(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),s=e-(this.y+r),n=r*r;if(i*i+s*s<=n||(i=t-(this.x+this.width-r))*i+s*s<=n||i*i+(s=e-(this.y+this.height-r))*s<=n||(i=t-(this.x+r))*i+s*s<=n)return!0}return!1}strokeContains(t,e,r,i=.5){let{x:s,y:n,width:a,height:o,radius:l}=this,h=r*(1-i),u=r-h,d=s+l,c=n+l,f=a-2*l,p=o-2*l,x=s+a,g=n+o;return(t>=s-h&&t<=s+u||t>=x-u&&t<=x+h)&&e>=c&&e<=c+p||(e>=n-h&&e<=n+u||e>=g-u&&e<=g+h)&&t>=d&&t<=d+f||t<d&&e<c&&y(t,e,d,c,l,u,h)||t>x-l&&e<c&&y(t,e,x-l,c,l,u,h)||t>x-l&&e>g-l&&y(t,e,x-l,g-l,l,u,h)||t<d&&e>g-l&&y(t,e,d,g-l,l,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}var v=r(2456);function S(t,e,r,i,s,n,a,o,l,h){var u,d,c;let f=(1-Math.min(.99,Math.max(0,h??v.GH.defaultOptions.bezierSmoothness)))/1;return f*=f,function t(e,r,i,s,n,a,o,l,h,u,d){if(d>8)return;let c=(e+i)/2,f=(r+s)/2,p=(i+n)/2,x=(s+a)/2,g=(n+o)/2,m=(a+l)/2,_=(c+p)/2,y=(f+x)/2,b=(p+g)/2,v=(x+m)/2,S=(_+b)/2,w=(y+v)/2;if(d>0){let t=o-e,d=l-r,c=Math.abs((i-o)*d-(s-l)*t),f=Math.abs((n-o)*d-(a-l)*t);if(c>11920929e-14&&f>11920929e-14){if((c+f)*(c+f)<=u*(t*t+d*d))return void h.push(S,w)}else if(c>11920929e-14){if(c*c<=u*(t*t+d*d))return void h.push(S,w)}else if(f>11920929e-14){if(f*f<=u*(t*t+d*d))return void h.push(S,w)}else if((t=S-(e+o)/2)*t+(d=w-(r+l)/2)*d<=u)return void h.push(S,w)}t(e,r,c,f,_,y,S,w,h,u,d+1),t(S,w,b,v,g,m,o,l,h,u,d+1)}(e,r,i,s,n,a,u=o,d=l,c=t,f,0),c.push(u,d),t}function w(t,e,r,i,s,n,a,o){let l=Math.abs(s-n);!a&&s>n?l=2*Math.PI-l:a&&n>s&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(l/Math.PI))));let h=l/(o=Math.max(o,3)),u=s;h*=a?-1:1;for(let s=0;s<o+1;s++){let s=e+Math.cos(u)*i,n=r+Math.sin(u)*i;t.push(s,n),u+=h}}let T=2*Math.PI,C={centerX:0,centerY:0,ang1:0,ang2:0},P=({x:t,y:e},r,i,s,n,a,o,l)=>{let h=s*(t*=r)-n*(e*=i),u=n*t+s*e;return l.x=h+a,l.y=u+o,l},M=(t,e,r,i)=>{let s=t*r+e*i;return s>1&&(s=1),s<-1&&(s=-1),(t*i-e*r<0?-1:1)*Math.acos(s)},k=new x.M;class A{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new c.c,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();let r=this._currentPoly.points,i=r[r.length-2],s=r[r.length-1];return(i!==t||s!==e)&&r.push(t,e),this}arc(t,e,r,i,s,n){return this._ensurePoly(!1),w(this._currentPoly.points,t,e,r,i,s,n),this}arcTo(t,e,r,i,s){return this._ensurePoly(),!function(t,e,r,i,s,n){let a=t[t.length-2],o=t[t.length-1]-r,l=a-e,h=s-r,u=i-e,d=Math.abs(o*u-l*h);if(d<1e-8||0===n){(t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r);return}let c=o*o+l*l,f=h*h+u*u,p=o*h+l*u,x=n*Math.sqrt(c)/d,g=n*Math.sqrt(f)/d,m=x*p/c,_=g*p/f,y=x*u+g*l,b=x*h+g*o,v=Math.atan2(o*(g+m)-b,l*(g+m)-y),S=Math.atan2(h*(x+_)-b,u*(x+_)-y);w(t,y+e,b+r,n,v,S,l*h>u*o)}(this._currentPoly.points,t,e,r,i,s),this}arcToSvg(t,e,r,i,s,n,a){return!function(t,e,r,i,s,n,a,o=0,l=0,h=0){if(0===n||0===a)return;let u=Math.sin(o*T/360),d=Math.cos(o*T/360),c=d*(e-i)/2+u*(r-s)/2,f=-u*(e-i)/2+d*(r-s)/2;if(0===c&&0===f)return;let p=Math.pow(c,2)/Math.pow(n=Math.abs(n),2)+Math.pow(f,2)/Math.pow(a=Math.abs(a),2);p>1&&(n*=Math.sqrt(p),a*=Math.sqrt(p)),((t,e,r,i,s,n,a,o,l,h,u,d,c)=>{let f=Math.pow(s,2),p=Math.pow(n,2),x=Math.pow(u,2),g=Math.pow(d,2),m=f*p-f*g-p*x;m<0&&(m=0),m/=f*g+p*x;let _=(m=Math.sqrt(m)*(a===o?-1:1))*s/n*d,y=-(m*n)/s*u,b=(u-_)/s,v=(d-y)/n,S=M(1,0,b,v),w=M(b,v,(-u-_)/s,(-d-y)/n);0===o&&w>0&&(w-=T),1===o&&w<0&&(w+=T),c.centerX=h*_-l*y+(t+r)/2,c.centerY=l*_+h*y+(e+i)/2,c.ang1=S,c.ang2=w})(e,r,i,s,n,a,l,h,u,d,c,f,C);let{ang1:x,ang2:g}=C,{centerX:m,centerY:_}=C,y=Math.abs(g)/(T/4);1e-7>Math.abs(1-y)&&(y=1);let b=Math.max(Math.ceil(y),1);g/=b;let v=t[t.length-2],w=t[t.length-1],k={x:0,y:0};for(let e=0;e<b;e++){let e=function(t,e){let r=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:r,s=Math.cos(t),n=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:s-n*i,y:n+s*i},{x:a+o*i,y:o-a*i},{x:a,y:o}]}(x,g),{x:r,y:i}=P(e[0],n,a,d,u,m,_,k),{x:s,y:o}=P(e[1],n,a,d,u,m,_,k),{x:l,y:h}=P(e[2],n,a,d,u,m,_,k);S(t,v,w,r,i,s,o,l,h),v=l,w=h,x+=g}}(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,n,a,t,e,r,i,s),this}bezierCurveTo(t,e,r,i,s,n,a){this._ensurePoly();let o=this._currentPoly;return S(this._currentPoly.points,o.lastX,o.lastY,t,e,r,i,s,n,a),this}quadraticCurveTo(t,e,r,i,s){var n,a,o,l,h,u,d,c,f,p,x;let g;this._ensurePoly();let m=this._currentPoly;return n=this._currentPoly.points,a=m.lastX,o=m.lastY,g=(1-Math.min(.99,Math.max(0,s??v.GH.defaultOptions.bezierSmoothness)))/1,l=a,h=o,u=t,d=e,c=r,f=i,p=n,x=g*=g,function t(e,r,i,s,n,a,o,l,h){if(h>8)return;let u=(r+s)/2,d=(i+n)/2,c=(s+a)/2,f=(n+o)/2,p=(u+c)/2,x=(d+f)/2,g=a-r,m=o-i,_=Math.abs((s-a)*m-(n-o)*g);if(_>11920929e-14){if(_*_<=l*(g*g+m*m))return void e.push(p,x)}else if((g=p-(r+a)/2)*g+(m=x-(i+o)/2)*m<=l)return void e.push(p,x);t(e,r,i,u,d,p,x,l,h+1),t(e,p,x,c,f,a,o,l,h+1)}(p,l,h,u,d,c,f,x,0),p.push(c,f),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);let r=this.shapePrimitives,i=r.length;for(let e=0;e<t.instructions.length;e++){let r=t.instructions[e];this[r.action](...r.data)}if(t.checkForHoles&&r.length-i>1){let t=null;for(let e=i;e<r.length;e++){let i=r[e];if("polygon"===i.shape.type){let s=i.shape,n=t?.shape;n&&n.containsPolygon(s)?(t.holes||(t.holes=[]),t.holes.push(i),r.copyWithin(e,e+1),r.length--,e--):t=i}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,i,s){return this.drawShape(new x.M(t,e,r,i),s),this}circle(t,e,r,i){return this.drawShape(new g(t,e,r),i),this}poly(t,e,r){let i=new _(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,s=0,n){let a=-1*Math.PI/2+s,o=2*Math.PI/(i=Math.max(0|i,3)),l=[];for(let s=0;s<i;s++){let i=a-s*o;l.push(t+r*Math.cos(i),e+r*Math.sin(i))}return this.poly(l,!0,n),this}roundPoly(t,e,r,i,s,n=0,a){if(i=Math.max(0|i,3),s<=0)return this.regularPoly(t,e,r,i,n);s=Math.min(s,r*Math.sin(Math.PI/i)-.001);let o=-1*Math.PI/2+n,l=2*Math.PI/i,h=(i-2)*Math.PI/i/2;for(let n=0;n<i;n++){let i=n*l+o,u=t+r*Math.cos(i),d=e+r*Math.sin(i),c=i+Math.PI+h,f=i-Math.PI-h,p=u+s*Math.cos(c),x=d+s*Math.sin(c),g=u+s*Math.cos(f),m=d+s*Math.sin(f);0===n?this.moveTo(p,x):this.lineTo(p,x),this.quadraticCurveTo(u,d,g,m,a)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?!function(t,e,r,i){let s=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),n=(t,e,r)=>({x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}),a=e.length;for(let o=0;o<a;o++){let l,h,u=e[(o+1)%a],d=u.radius??r;if(d<=0){0===o?t.moveTo(u.x,u.y):t.lineTo(u.x,u.y);continue}let c=e[o],f=e[(o+2)%a],p=s(c,u);l=p<1e-4?u:n(u,c,Math.min(p/2,d)/p);let x=s(f,u);h=x<1e-4?u:n(u,f,Math.min(x/2,d)/x),0===o?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y),t.quadraticCurveTo(u.x,u.y,h.x,h.y,i)}}(this,t,e,i):!function(t,e,r){let i=(t,e)=>{let r=e.x-t.x,i=e.y-t.y,s=Math.sqrt(r*r+i*i);return{len:s,nx:r/s,ny:i/s}},s=(e,r)=>{0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)},n=e[e.length-1];for(let a=0;a<e.length;a++){let o,l=e[a%e.length],h=l.radius??r;if(h<=0){s(a,l),n=l;continue}let u=e[(a+1)%e.length],d=i(l,n),c=i(l,u);if(d.len<1e-4||c.len<1e-4){s(a,l),n=l;continue}let f=Math.asin(d.nx*c.ny-d.ny*c.nx),p=1,x=!1;d.nx*c.nx- -(d.ny*c.ny)<0?f<0?f=Math.PI+f:(f=Math.PI-f,p=-1,x=!0):f>0&&(p=-1,x=!0);let g=f/2,m=Math.abs(Math.cos(g)*h/Math.sin(g));o=m>Math.min(d.len/2,c.len/2)?Math.abs((m=Math.min(d.len/2,c.len/2))*Math.sin(g)/Math.cos(g)):h;let _=l.x+c.nx*m+-c.ny*o*p,y=l.y+c.ny*m+c.nx*o*p,b=Math.atan2(d.ny,d.nx)+Math.PI/2*p,v=Math.atan2(c.ny,c.nx)-Math.PI/2*p;0===a&&t.moveTo(_+Math.cos(b)*o,y+Math.sin(b)*o),t.arc(_,y,o,b,v,x),n=l}}(this,t,e),this.closePath())}filletRect(t,e,r,i,s){if(0===s)return this.rect(t,e,r,i);let n=Math.min(r,i)/2,a=Math.min(n,Math.max(-n,s)),o=t+r,l=e+i,h=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(o-u,e).arcTo(o-h,e+h,o,e+u,u).lineTo(o,l-u).arcTo(o-h,l-h,t+r-u,l,u).lineTo(t+u,l).arcTo(t+h,l-h,t,l-u,u).closePath()}chamferRect(t,e,r,i,s,n){if(s<=0)return this.rect(t,e,r,i);let a=Math.min(s,Math.min(r,i)/2),o=t+r,l=e+i,h=[t+a,e,o-a,e,o,e+a,o,l-a,o-a,l,t+a,l,t,l-a,t,e+a];for(let t=h.length-1;t>=2;t-=2)h[t]===h[t-2]&&h[t-1]===h[t-3]&&h.splice(t-1,2);return this.poly(h,!0,n)}ellipse(t,e,r,i,s){return this.drawShape(new m(t,e,r,i),s),this}roundRect(t,e,r,i,s,n){return this.drawShape(new b(t,e,r,i,s),n),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),(r=new _).points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){let e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new _,t)){let t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,r=t.shape.y;if(t.transform&&!t.transform.isIdentity()){let i=t.transform,s=e;e=i.a*e+i.c*r+i.tx,r=i.b*s+i.d*r+i.ty}this._currentPoly.points.push(e,r)}else this._currentPoly.points.push(0,0)}}buildPath(){let t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){let r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){let t=this._bounds;t.clear();let e=this.shapePrimitives;for(let r=0;r<e.length;r++){let i=e[r],s=i.shape.getBounds(k);i.transform?t.addRect(s,i.transform):t.addRect(s)}return t}}class R{constructor(t,e=!1){this.instructions=[],this.uid=(0,u.L)("graphicsPath"),this._dirty=!0,this.checkForHoles=e,"string"==typeof t?function(t,e){let r=p(t),i=[],s=null,n=0,a=0;for(let t=0;t<r.length;t++){let o=r[t],l=o[0];switch(l){case"M":n=o[1],a=o[2],e.moveTo(n,a);break;case"m":n+=o[1],a+=o[2],e.moveTo(n,a);break;case"H":n=o[1],e.lineTo(n,a);break;case"h":n+=o[1],e.lineTo(n,a);break;case"V":a=o[1],e.lineTo(n,a);break;case"v":a+=o[1],e.lineTo(n,a);break;case"L":n=o[1],a=o[2],e.lineTo(n,a);break;case"l":n+=o[1],a+=o[2],e.lineTo(n,a);break;case"C":n=o[5],a=o[6],e.bezierCurveTo(o[1],o[2],o[3],o[4],n,a);break;case"c":e.bezierCurveTo(n+o[1],a+o[2],n+o[3],a+o[4],n+o[5],a+o[6]),n+=o[5],a+=o[6];break;case"S":n=o[3],a=o[4],e.bezierCurveToShort(o[1],o[2],n,a);break;case"s":e.bezierCurveToShort(n+o[1],a+o[2],n+o[3],a+o[4]),n+=o[3],a+=o[4];break;case"Q":n=o[3],a=o[4],e.quadraticCurveTo(o[1],o[2],n,a);break;case"q":e.quadraticCurveTo(n+o[1],a+o[2],n+o[3],a+o[4]),n+=o[3],a+=o[4];break;case"T":n=o[1],a=o[2],e.quadraticCurveToShort(n,a);break;case"t":n+=o[1],a+=o[2],e.quadraticCurveToShort(n,a);break;case"A":n=o[6],a=o[7],e.arcToSvg(o[1],o[2],o[3],o[4],o[5],n,a);break;case"a":n+=o[6],a+=o[7],e.arcToSvg(o[1],o[2],o[3],o[4],o[5],n,a);break;case"Z":case"z":e.closePath(),i.length>0&&((s=i.pop())?(n=s.startX,a=s.startY):(n=0,a=0)),s=null;break;default:(0,f.R)(`Unknown SVG path command: ${l}`)}"Z"!==l&&"z"!==l&&null===s&&(s={startX:n,startY:a},i.push(s))}}(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new A(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,s){let n=this.instructions[this.instructions.length-1],a=this.getLastPoint(l.b.shared),o=0,h=0;if(n&&"bezierCurveTo"===n.action){o=n.data[2],h=n.data[3];let t=a.x,e=a.y;o=t+(t-o),h=e+(e-h)}else o=a.x,h=a.y;return this.instructions.push({action:"bezierCurveTo",data:[o,h,t,e,r,i,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){let i=this.instructions[this.instructions.length-1],s=this.getLastPoint(l.b.shared),n=0,a=0;if(i&&"quadraticCurveTo"===i.action){n=i.data[0],a=i.data[1];let t=s.x,e=s.y;n=t+(t-n),a=e+(e-a)}else n=s.x,a=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[n,a,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,s){return this.instructions.push({action:"rect",data:[t,e,r,i,s]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,s,n,a){s||(s=i/2);let o=-1*Math.PI/2+n,l=2*r,h=2*Math.PI/l,u=[];for(let r=0;r<l;r++){let n=r%2?s:i,a=r*h+o;u.push(t+n*Math.cos(a),e+n*Math.sin(a))}return this.poly(u,!0,a),this}clone(t=!1){let e=new R;if(e.checkForHoles=this.checkForHoles,t)for(let t=0;t<this.instructions.length;t++){let r=this.instructions[t];e.instructions.push({action:r.action,data:r.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;let e=t.a,r=t.b,i=t.c,s=t.d,n=t.tx,a=t.ty,o=0,l=0,h=0,u=0,d=0,c=0,p=0,x=0;for(let g=0;g<this.instructions.length;g++){let m=this.instructions[g],_=m.data;switch(m.action){case"moveTo":case"lineTo":o=_[0],l=_[1],_[0]=e*o+i*l+n,_[1]=r*o+s*l+a;break;case"bezierCurveTo":h=_[0],u=_[1],d=_[2],c=_[3],o=_[4],l=_[5],_[0]=e*h+i*u+n,_[1]=r*h+s*u+a,_[2]=e*d+i*c+n,_[3]=r*d+s*c+a,_[4]=e*o+i*l+n,_[5]=r*o+s*l+a;break;case"quadraticCurveTo":h=_[0],u=_[1],o=_[2],l=_[3],_[0]=e*h+i*u+n,_[1]=r*h+s*u+a,_[2]=e*o+i*l+n,_[3]=r*o+s*l+a;break;case"arcToSvg":o=_[5],l=_[6],p=_[0],x=_[1],_[0]=e*p+i*x,_[1]=r*p+s*x,_[5]=e*o+i*l+n,_[6]=r*o+s*l+a;break;case"circle":_[4]=B(_[3],t);break;case"rect":_[4]=B(_[4],t);break;case"ellipse":_[8]=B(_[8],t);break;case"roundRect":_[5]=B(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=B(_[2],t);break;default:(0,f.R)("unknown transform action",m.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;"closePath"===r.action;){if(--e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t)}return t}}function B(t,e){return t?t.prepend(e):e.clone()}var F=r(49521);function z(t,e,r){let i=t.getAttribute(e);return i?Number(i):r}function U(t){let e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}let I={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function E(t,e){let r=t.getAttribute("style"),i={},s={},n={strokeStyle:i,fillStyle:s,useFill:!1,useStroke:!1};for(let r in I){let i=t.getAttribute(r);i&&D(e,n,r,i.trim())}if(r){let t=r.split(";");for(let r=0;r<t.length;r++){let[i,s]=t[r].trim().split(":");I[i]&&D(e,n,i,s.trim())}}return{strokeStyle:n.useStroke?i:null,fillStyle:n.useFill?s:null,useFill:n.useFill,useStroke:n.useStroke}}function D(t,e,r,i){switch(r){case"stroke":if("none"!==i){if(i.startsWith("url(")){let r=U(i);e.strokeStyle.fill=t.defs[r]}else e.strokeStyle.color=a.Q.shared.setValue(i).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(i);break;case"fill":if("none"!==i){if(i.startsWith("url(")){let r=U(i);e.fillStyle.fill=t.defs[r]}else e.fillStyle.color=a.Q.shared.setValue(i).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(i);break;case"stroke-opacity":e.strokeStyle.alpha=Number(i);break;case"opacity":e.fillStyle.alpha=Number(i),e.strokeStyle.alpha=Number(i)}}function G(t,e){for(let r of new R(t,!1).instructions)e.instructions.push(r)}var O=r(91359);let V=new l.b,W=new o.u,L=class t extends n.A{constructor(){super(...arguments),this.uid=(0,u.L)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new R,this._transform=new o.u,this._fillStyle={...t.defaultFillStyle},this._strokeStyle={...t.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new c.c,this._boundsDirty=!0}clone(){let e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=(0,O.w)(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=(0,O.T)(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=(0,O.w)(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=(0,O.w)(e,t.defaultStrokeStyle),this}texture(t,e,r,i,s,n){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:s||t.frame.width,dh:n||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?a.Q.shared.setValue(e).toNumber():0xffffff}}),this.onUpdate(),this}beginPath(){return this._activePath=new R,this}fill(e,r){let i,s=this.instructions[this.instructions.length-1];return(i=0===this._tick&&s&&"stroke"===s.action?s.data.path:this._activePath.clone())&&(null!=e&&(void 0!==r&&"number"==typeof e&&((0,d.t6)(d.lj,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=(0,O.w)(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0),this}_initNextPathLocation(){let{x:t,y:e}=this._activePath.getLastPoint(l.b.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let r,i=this.instructions[this.instructions.length-1];return(r=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone())&&(null!=e&&(this._strokeStyle=(0,O.T)(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0),this}cut(){for(let t=0;t<2;t++){let e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action))if(e.data.hole)e.data.hole.addPath(r);else{e.data.hole=r;break}}return this._initNextPathLocation(),this}arc(t,e,r,i,s,n){this._tick++;let a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,r,i,s,n),this}arcTo(t,e,r,i,s){this._tick++;let n=this._transform;return this._activePath.arcTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*r+n.c*i+n.tx,n.b*r+n.d*i+n.ty,s),this}arcToSvg(t,e,r,i,s,n,a){this._tick++;let o=this._transform;return this._activePath.arcToSvg(t,e,r,i,s,o.a*n+o.c*a+o.tx,o.b*n+o.d*a+o.ty),this}bezierCurveTo(t,e,r,i,s,n,a){this._tick++;let o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;let r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;let r=this._transform,i=this._activePath.instructions,s=r.a*t+r.c*e+r.tx,n=r.b*t+r.d*e+r.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=s,i[0].data[1]=n):this._activePath.moveTo(s,n),this}quadraticCurveTo(t,e,r,i,s){this._tick++;let n=this._transform;return this._activePath.quadraticCurveTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*r+n.c*i+n.tx,n.b*r+n.d*i+n.ty,s),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,s){return this._tick++,this._activePath.roundRect(t,e,r,i,s,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,s=0,n){return this._tick++,this._activePath.regularPoly(t,e,r,i,s,n),this}roundPoly(t,e,r,i,s,n){return this._tick++,this._activePath.roundPoly(t,e,r,i,s,n),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,s){return this._tick++,this._activePath.filletRect(t,e,r,i,s),this}chamferRect(t,e,r,i,s,n){return this._tick++,this._activePath.chamferRect(t,e,r,i,s,n),this}star(t,e,r,i,s=0,n=0){return this._tick++,this._activePath.star(t,e,r,i,s,n,this._transform.clone()),this}svg(t){return this._tick++,!function(t,e){if("string"==typeof t){let e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}let r={context:e,defs:{},path:new R};!function(t,e){let r=t.querySelectorAll("defs");for(let t=0;t<r.length;t++){let s=r[t];for(let t=0;t<s.children.length;t++){let r=s.children[t];switch(r.nodeName.toLowerCase()){case"lineargradient":e.defs[r.id]=function(t){let e=z(t,"x1",0),r=z(t,"y1",0),i=z(t,"x2",1),s=z(t,"y2",0),n=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new F._(e,r,i,s,"objectBoundingBox"===n?"local":"global");for(let e=0;e<t.children.length;e++){let r=t.children[e],i=z(r,"offset",0),s=a.Q.shared.setValue(r.getAttribute("stop-color")).toNumber();o.addColorStop(i,s)}return o}(r);break;case"radialgradient":var i;e.defs[r.id]=(i=0,(0,f.R)("[SVG Parser] Radial gradients are not yet supported"),new F._(0,0,1,0))}}}}(t,r);let i=t.children,{fillStyle:s,strokeStyle:n}=E(t,r);for(let t=0;t<i.length;t++){let e=i[t];"defs"!==e.nodeName.toLowerCase()&&function t(e,r,i,s){let n,a,o,l,h,u,d,c,p,x,g,m,_,y,b,v,S=e.children,{fillStyle:w,strokeStyle:T}=E(e,r);w&&i?i={...i,...w}:w&&(i=w),T&&s?s={...s,...T}:T&&(s=T);let C=!i&&!s;switch(C&&(i={color:0}),e.nodeName.toLowerCase()){case"path":{_=e.getAttribute("d");let t=e.getAttribute("fill-rule"),n=_.split(/(?=[Mm])/).filter(t=>t.trim().length>0),a=n.length>1;if("evenodd"===t&&a){let t=n.map(t=>({path:t,area:function(t){let e=t.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!e||e.length<4)return 0;let r=e.map(Number),i=[],s=[];for(let t=0;t<r.length;t+=2)t+1<r.length&&(i.push(r[t]),s.push(r[t+1]));if(0===i.length||0===s.length)return 0;let n=Math.min(...i),a=Math.min(...s);return(Math.max(...i)-n)*(Math.max(...s)-a)}(t)}));if(t.sort((t,e)=>e.area-t.area),n.length>3||!function(t){if(t.length<=2)return!0;let e=t.map(t=>t.area).sort((t,e)=>e-t),[r,i]=e,s=e[e.length-1];return!(r/i>3)||!(i/s<2)}(t))for(let e=0;e<t.length;e++){let n=t[e],a=0===e;r.context.beginPath();let o=new R(void 0,!0);G(n.path,o),r.context.path(o),a?(i&&r.context.fill(i),s&&r.context.stroke(s)):r.context.cut()}else for(let e=0;e<t.length;e++){let n=t[e],a=e%2==1;r.context.beginPath();let o=new R(void 0,!0);G(n.path,o),r.context.path(o),a?r.context.cut():(i&&r.context.fill(i),s&&r.context.stroke(s))}}else y=new R(_,!t||"evenodd"===t),r.context.path(y),i&&r.context.fill(i),s&&r.context.stroke(s);break}case"circle":d=z(e,"cx",0),c=z(e,"cy",0),p=z(e,"r",0),r.context.ellipse(d,c,p,p),i&&r.context.fill(i),s&&r.context.stroke(s);break;case"rect":n=z(e,"x",0),a=z(e,"y",0),b=z(e,"width",0),v=z(e,"height",0),x=z(e,"rx",0),g=z(e,"ry",0),x||g?r.context.roundRect(n,a,b,v,x||g):r.context.rect(n,a,b,v),i&&r.context.fill(i),s&&r.context.stroke(s);break;case"ellipse":d=z(e,"cx",0),c=z(e,"cy",0),x=z(e,"rx",0),g=z(e,"ry",0),r.context.beginPath(),r.context.ellipse(d,c,x,g),i&&r.context.fill(i),s&&r.context.stroke(s);break;case"line":o=z(e,"x1",0),l=z(e,"y1",0),h=z(e,"x2",0),u=z(e,"y2",0),r.context.beginPath(),r.context.moveTo(o,l),r.context.lineTo(h,u),s&&r.context.stroke(s);break;case"polygon":m=e.getAttribute("points").match(/\d+/g).map(t=>parseInt(t,10)),r.context.poly(m,!0),i&&r.context.fill(i),s&&r.context.stroke(s);break;case"polyline":m=e.getAttribute("points").match(/\d+/g).map(t=>parseInt(t,10)),r.context.poly(m,!1),s&&r.context.stroke(s);break;case"g":case"svg":break;default:(0,f.R)(`[SVG parser] <${e.nodeName}> elements unsupported`)}C&&(i=null);for(let e=0;e<S.length;e++)t(S[e],r,i,s)}(e,r,s,n)}}(t,this),this}restore(){let t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,s,n){return t instanceof o.u?this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty):this._transform.set(t,e,r,i,s,n),this}transform(t,e,r,i,s,n){return t instanceof o.u?this._transform.append(t):(W.set(t,e,r,i,s,n),this._transform.append(W)),this}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,this.dirty||(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;let t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){let r=this.instructions[e],i=r.action;if("fill"===i){let e=r.data;t.addBounds(e.path.bounds)}else if("texture"===i){let e=r.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===i){let e=r.data,i=e.style.alignment,s=e.style.width*(1-i),n=e.path.bounds;t.addFrame(n.minX-s,n.minY-s,n.maxX+s,n.maxY+s)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;let e=this.instructions,r=!1;for(let i=0;i<e.length;i++){let s=e[i],n=s.data,a=n.path;if(!s.action||!a)continue;let o=n.style,l=a.shapePath.shapePrimitives;for(let e=0;e<l.length;e++){let i=l[e].shape;if(!o||!i)continue;let a=l[e].transform,h=a?a.applyInverse(t,V):t;r="fill"===s.action?i.contains(h.x,h.y):i.strokeContains(h.x,h.y,o.width,o.alignment);let u=n.hole;if(u){let t=u.shapePath?.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(h.x,h.y)&&(r=!1)}if(r)return!0}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){let e="boolean"==typeof t?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(e)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(e))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};L.defaultFillStyle={color:0xffffff,alpha:1,texture:h.g.WHITE,matrix:null,fill:null,textureSpace:"local"},L.defaultStrokeStyle={width:1,color:0xffffff,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:h.g.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let $=L},32347:(t,e,r)=>{"use strict";var i=r(3230),s=r(2456),n=r(71854),a=r(87577),o=r(82069),l=r(39795);class h{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{a.Z.return(t)}),this.batches.length=0}}class u{constructor(t,e){this.state=n.U.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){let e=t.context,r=!!t._gpuData,i=this.renderer.graphicsContext.updateGpuContext(e);return!!i.isBatchable||r!==i.isBatchable}addRenderable(t,e){let r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){let e=this._getGpuDataForRenderable(t).batches;for(let t=0;t<e.length;t++){let r=e[t];r._batcher.updateElement(r)}}execute(t){if(!t.isRenderable)return;let e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;let i=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;let s=i.resources.localUniforms.uniforms;s.uTransformMatrix=t.groupTransform,s.uRound=e._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,s.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){let e=this._getGpuDataForRenderable(t),r=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),r.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){let r=this.renderer.renderPipes.batch,i=this._getGpuDataForRenderable(t).batches;for(let t=0;t<i.length;t++){let s=i[t];r.addToBatch(s,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){let e=new h;return t._gpuData[this.renderer.uid]=e,e}_updateBatchesForRenderable(t,e){let r=t.context,i=this.renderer.graphicsContext.getGpuContext(r),s=this.renderer._roundPixels|t._roundPixels;e.batches=i.batches.map(e=>{let r=a.Z.get(l.G);return e.copyTo(r),r.renderable=t,r.roundPixels=s,r})}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}u.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"graphics"},i.XO.add(u),i.XO.add(s.GH)},33749:(t,e,r)=>{"use strict";r.d(e,{N:()=>o});var i=r(45737),s=r(43958),n=r(44518);class a{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){let r=i.e.get().createCanvas();r.width=t,r.height=e;let s=r.getContext("2d");return{canvas:r,context:s}}getOptimalCanvasAndContext(t,e,r=1){t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),t=(0,s.U5)(t),e=(0,s.U5)(e);let i=(t<<17)+(e<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let n=this._canvasPool[i].pop();return n||(n=this._createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){let{width:e,height:r}=t.canvas,i=(e<<17)+(r<<1);t.context.resetTransform(),t.context.clearRect(0,0,e,r),this._canvasPool[i].push(t)}clear(){this._canvasPool={}}}let o=new a;n.L.register(o)},39795:(t,e,r)=>{"use strict";r.d(e,{G:()=>a});var i=r(62104),s=r(45193);let n=new i.u;class a{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){let t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,r=this.renderable;return r?(0,s.u)(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){return this.renderable?.groupTransform||n}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}},41849:(t,e,r)=>{"use strict";r.d(e,{u:()=>l});var i=r(13636),s=r(88497),n=r(25891),a=r(51631);let o=class t extends n.V{constructor(...e){let r=e[0]??{};r instanceof Float32Array&&((0,a.t6)(a.lj,"use new MeshGeometry({ positions, uvs, indices }) instead"),r={positions:r,uvs:e[1],indices:e[2]});let n=(r={...t.defaultOptions,...r}).positions||new Float32Array([0,0,1,0,1,1,0,1]),o=r.uvs;o||(o=new Float32Array(r.positions?n.length:[0,0,1,0,1,1,0,1]));let l=r.indices||new Uint32Array([0,1,2,0,2,3]),h=r.shrinkBuffersToFit,u=new i.h({data:n,label:"attribute-mesh-positions",shrinkToFit:h,usage:s.S.VERTEX|s.S.COPY_DST});super({attributes:{aPosition:{buffer:u,format:"float32x2",stride:8,offset:0},aUV:{buffer:new i.h({data:o,label:"attribute-mesh-uvs",shrinkToFit:h,usage:s.S.VERTEX|s.S.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new i.h({data:l,label:"index-mesh-buffer",shrinkToFit:h,usage:s.S.INDEX|s.S.COPY_DST}),topology:r.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};o.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let l=o},43977:(t,e,r)=>{"use strict";r.d(e,{u:()=>i});class i{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw Error(`${t} isn't a valid view type`)}}}},44894:(t,e,r)=>{"use strict";var i=r(3230),s=r(62104),n=r(90848),a=r(55103),o=r(93087),l=r(82069),h=r(61583);class u{destroy(){}}class d{constructor(t,e){this.localUniforms=new a.k({uTransformMatrix:{value:new s.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new n.T({0:this.localUniforms}),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){let e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){let r=t._geometry;if(r.indices.length!==e.indexSize||r.positions.length!==e.vertexSize)return e.indexSize=r.indices.length,e.vertexSize=r.positions.length,!0;let i=this._getBatchableMesh(t);return i.texture.uid!==t._texture.uid&&(i._textureMatrixUpdateId=-1),!i._batcher.checkAndUpdateTexture(i,t._texture)}return!1}addRenderable(t,e){let r=this.renderer.renderPipes.batch,i=this._getMeshData(t);if(t.didViewUpdate&&(i.indexSize=t._geometry.indices?.length,i.vertexSize=t._geometry.positions?.length),i.batched){let i=this._getBatchableMesh(t);i.setTexture(t._texture),i.geometry=t._geometry,r.addToBatch(i,e)}else r.break(e),e.add(t)}updateRenderable(t){if(t.batched){let e=this._getBatchableMesh(t);e.setTexture(t._texture),e.geometry=t._geometry,e._batcher.updateElement(e)}}execute(t){if(!t.isRenderable)return;t.state.blendMode=(0,o.i)(t.groupBlendMode,t.texture._source);let e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),(0,l.V)(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){var e,r;return(e=t._gpuData)[r=this.renderer.uid]||(e[r]=new u),t._gpuData[this.renderer.uid].meshData||this._initMeshData(t)}_initMeshData(t){return t._gpuData[this.renderer.uid].meshData={batched:t.batched,indexSize:0,vertexSize:0},t._gpuData[this.renderer.uid].meshData}_getBatchableMesh(t){var e,r;return(e=t._gpuData)[r=this.renderer.uid]||(e[r]=new u),t._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(t)}_initBatchableMesh(t){let e=new h.U;return e.renderable=t,e.setTexture(t._texture),e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,t._gpuData[this.renderer.uid].batchableMesh=e,e}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}d.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"mesh"},i.XO.add(d)},49521:(t,e,r)=>{"use strict";r.d(e,{_:()=>f});var i=r(20177),s=r(45737),n=r(62104),a=r(25460),o=r(52295),l=r(43428),h=r(51631),u=r(95011);let d=[{offset:0,color:"white"},{offset:1,color:"black"}],c=class t{constructor(...e){this.uid=(0,l.L)("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let r=function(t){let e=t[0]??{};return("number"==typeof e||t[1])&&((0,h.t6)("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??f.defaultLinearOptions.textureSize}),e}(e);r={..."radial"===r.type?t.defaultRadialOptions:t.defaultLinearOptions,...(0,u.S)(r)},this._textureSize=r.textureSize,this._wrapMode=r.wrapMode,"radial"===r.type?(this.center=r.center,this.outerCenter=r.outerCenter??this.center,this.innerRadius=r.innerRadius,this.outerRadius=r.outerRadius,this.scale=r.scale,this.rotation=r.rotation):(this.start=r.start,this.end=r.end),this.textureSpace=r.textureSpace,this.type=r.type,r.colorStops.forEach(t=>{this.addColorStop(t.offset,t.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:i.Q.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:i}=this.end,s=r-t,l=i-e,h=s<0||l<0;if("clamp-to-edge"===this._wrapMode){if(s<0){let e=t;t=r,r=e,s*=-1}if(l<0){let t=e;e=i,i=t,l*=-1}}let u=this.colorStops.length?this.colorStops:d,c=this._textureSize,{canvas:f,context:g}=x(c,1),m=h?g.createLinearGradient(this._textureSize,0,0,0):g.createLinearGradient(0,0,this._textureSize,0);p(m,u),g.fillStyle=m,g.fillRect(0,0,c,1),this.texture=new o.g({source:new a.b({resource:f,addressMode:this._wrapMode})});let _=Math.sqrt(s*s+l*l),y=Math.atan2(l,s),b=new n.u;b.scale(_/c,1),b.rotate(y),b.translate(t,e),"local"===this.textureSpace&&b.scale(c,c),this.transform=b}buildGradient(){!this.texture&&this._tick++,"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;let t=this.colorStops.length?this.colorStops:d,e=this._textureSize,{canvas:r,context:i}=x(e,e),{x:s,y:l}=this.center,{x:h,y:u}=this.outerCenter,c=this.innerRadius,f=this.outerRadius,g=h-f,m=u-f,_=e/(2*f),y=(s-g)*_,b=(l-m)*_,v=i.createRadialGradient(y,b,c*_,(h-g)*_,(u-m)*_,f*_);p(v,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=v,i.translate(y,b),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-y,-b),i.fillRect(0,0,e,e),this.texture=new o.g({source:new a.b({resource:r,addressMode:this._wrapMode})});let S=new n.u;S.scale(1/_,1/_),S.translate(g,m),"local"===this.textureSpace&&S.scale(e,e),this.transform=S}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};c.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},c.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let f=c;function p(t,e){for(let r=0;r<e.length;r++){let i=e[r];t.addColorStop(i.offset,i.color)}}function x(t,e){let r=s.e.get().createCanvas(t,e),i=r.getContext("2d");return{canvas:r,context:i}}},55103:(t,e,r)=>{"use strict";r.d(e,{k:()=>l});var i=r(43428),s=r(24077);let n=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],a=n.reduce((t,e)=>(t[e]=!0,t),{}),o=class t{constructor(e,r){this._touched=0,this.uid=(0,i.L)("uniform"),this._resourceType="uniformGroup",this._resourceId=(0,i.L)("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r={...t.defaultOptions,...r},this.uniformStructures=e;let o={};for(let t in e){let r=e[t];if(r.name=t,r.size=r.size??1,!a[r.type]){let t=r.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(t){let[,e,i]=t;throw Error(`Uniform type ${r.type} is not supported. Use type: '${e}', size: ${i} instead.`)}throw Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${n.join(", ")}`)}r.value??(r.value=function(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}(r.type,r.size)),o[t]=r.value}this.uniforms=o,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=(0,s.X)(Object.keys(o).map(t=>`${t}-${e[t].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};o.defaultOptions={ubo:!1,isStatic:!1};let l=o},61583:(t,e,r)=>{"use strict";r.d(e,{U:()=>i});class i{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){let t=this.geometry.getBuffer("aUV"),e=t.data,r=e,i=this.texture.textureMatrix;return i.isSimple||(r=this._transformedUvs,(this._textureMatrixUpdateId!==i._updateID||this._uvUpdateId!==t._updateID)&&((!r||r.length<e.length)&&(r=this._transformedUvs=new Float32Array(e.length)),this._textureMatrixUpdateId=i._updateID,this._uvUpdateId=t._updateID,i.multiplyUvs(e,r))),r}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}},68526:(t,e,r)=>{"use strict";let i;r.d(e,{M:()=>d});var s=r(24077),n=r(86833);let a={},o={},l={stripVersion:function(t,e){return e?t.replace("#version 300 es",""):t},ensurePrecision:function(t,e,r){let i=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let s=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===s&&"highp"!==i&&(s="mediump"),`precision ${s} float;
${t}`}return"highp"!==i&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t},addProgramDefines:function(t,e,r){return e?t:r?(t=t.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${t}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${t}
        `},setProgramName:function(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-")+(r?"-fragment":"-vertex");let i=r?a:o;if(i[e]?(i[e]++,e+=`-${i[e]}`):i[e]=1,-1!==t.indexOf("#define SHADER_NAME"))return t;let s=`#define SHADER_NAME ${e}`;return`${s}
${t}`},insertVersion:function(t,e){return e?`#version 300 es
${t}`:t}},h=Object.create(null),u=class t{constructor(e){let r=-1!==(e={...t.defaultOptions,...e}).fragment.indexOf("#version 300 es"),a={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:function(){if(!i){i="mediump";let t=(0,n.W)();t&&t.getShaderPrecisionFormat&&(i=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return i}()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r},o=e.fragment,h=e.vertex;Object.keys(l).forEach(t=>{let e=a[t];o=l[t](o,e,!0),h=l[t](h,e,!1)}),this.fragment=o,this.vertex=h,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=(0,s.X)(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,h[this._cacheKey]=null}static from(e){let r=`${e.vertex}:${e.fragment}`;return h[r]||(h[r]=new t(e),h[r]._cacheKey=r),h[r]}};u.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let d=u},69655:(t,e,r)=>{"use strict";r.d(e,{K:()=>i});class i{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){}}},69709:(t,e,r)=>{"use strict";var i=r(3230);class s{constructor(t){this._renderer=t}push(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}s.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"filter"};var n=r(62104),a=r(90848),o=r(25891),l=r(55103),h=r(52295),u=r(56823),d=r(10558),c=r(45033);let f=new n.u;var p=r(42577);let x=new o.V({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class g{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new c.c,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.globalFrame={x:0,y:0,width:0,height:0}}}class m{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new l.k({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new a.T({}),this.renderer=t}get activeBackTexture(){return this._activeFilterData?.backTexture}push(t){let e=this.renderer,r=t.filterEffect.filters,i=this._pushFilterData();i.skip=!1,i.filters=r,i.container=t.container,i.outputRenderSurface=e.renderTarget.renderSurface;let s=e.renderTarget.renderTarget.colorTexture.source,n=s.resolution,a=s.antialias;if(0===r.length){i.skip=!0;return}let o=i.bounds;if(this._calculateFilterArea(t,o),this._calculateFilterBounds(i,e.renderTarget.rootViewPort,a,n,1),i.skip)return;let l=this._getPreviousFilterData(),h=this._findFilterResolution(n),u=0,d=0;l&&(u=l.bounds.minX,d=l.bounds.minY),this._calculateGlobalFrame(i,u,d,h,s.width,s.height),this._setupFilterTextures(i,o,e,l)}generateFilteredTexture({texture:t,filters:e}){let r=this._pushFilterData();this._activeFilterData=r,r.skip=!1,r.filters=e;let i=t.source,s=i.resolution,n=i.antialias;if(0===e.length)return r.skip=!0,t;let a=r.bounds;if(a.addRect(t.frame),this._calculateFilterBounds(r,a.rectangle,n,s,0),r.skip)return t;this._calculateGlobalFrame(r,0,0,s,i.width,i.height),r.outputRenderSurface=u.W.getOptimalTexture(a.width,a.height,r.resolution,r.antialias),r.backTexture=h.g.EMPTY,r.inputTexture=t,this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(r,!0);let o=r.outputRenderSurface;return o.source.alphaMode="premultiplied-alpha",o}pop(){let t=this.renderer,e=this._popFilterData();e.skip||(t.globalUniforms.pop(),t.renderTarget.finishRenderPass(),this._activeFilterData=e,this._applyFiltersToTexture(e,!1),e.blendRequired&&u.W.returnTexture(e.backTexture),u.W.returnTexture(e.inputTexture))}getBackTexture(t,e,r){let i=t.colorTexture.source._resolution,s=u.W.getOptimalTexture(e.width,e.height,i,!1),n=e.minX,a=e.minY;r&&(n-=r.minX,a-=r.minY),n=Math.floor(n*i),a=Math.floor(a*i);let o=Math.ceil(e.width*i),l=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,s,{x:n,y:a},{width:o,height:l},{x:0,y:0}),s}applyFilter(t,e,r,i){let s=this.renderer,n=this._activeFilterData,a=n.outputRenderSurface===r,o=s.renderTarget.rootRenderTarget.colorTexture.source._resolution,l=this._findFilterResolution(o),h=0,u=0;if(a){let t=this._findPreviousFilterOffset();h=t.x,u=t.y}this._updateFilterUniforms(e,r,n,h,u,l,a,i),this._setupBindGroupsAndRender(t,e,s)}calculateSpriteMatrix(t,e){let r=this._activeFilterData,i=t.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),s=e.worldTransform.copyTo(n.u.shared),a=e.renderGroup||e.parentRenderGroup;return a&&a.cacheToLocalTransform&&s.prepend(a.cacheToLocalTransform),s.invert(),i.prepend(s),i.scale(1/e.texture.orig.width,1/e.texture.orig.height),i.translate(e.anchor.x,e.anchor.y),i}destroy(){}_setupBindGroupsAndRender(t,e,r){if(r.renderPipes.uniformBatch){let t=r.renderPipes.uniformBatch.getUboResource(this._filterGlobalUniforms);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(this._filterGlobalUniforms,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,r.encoder.draw({geometry:x,shader:t,state:t._state,topology:"triangle-list"}),r.type===d.W.WEBGL&&r.renderTarget.finishRenderPass()}_setupFilterTextures(t,e,r,i){if(t.backTexture=h.g.EMPTY,t.inputTexture=u.W.getOptimalTexture(e.width,e.height,t.resolution,t.antialias),t.blendRequired){r.renderTarget.finishRenderPass();let s=r.renderTarget.getRenderTarget(t.outputRenderSurface);t.backTexture=this.getBackTexture(s,e,i?.bounds)}r.renderTarget.bind(t.inputTexture,!0),r.globalUniforms.push({offset:e})}_calculateGlobalFrame(t,e,r,i,s,n){let a=t.globalFrame;a.x=e*i,a.y=r*i,a.width=s*i,a.height=n*i}_updateFilterUniforms(t,e,r,i,s,n,a,o){let l=this._filterGlobalUniforms.uniforms,u=l.uOutputFrame,d=l.uInputSize,c=l.uInputPixel,f=l.uInputClamp,p=l.uGlobalFrame,x=l.uOutputTexture;a?(u[0]=r.bounds.minX-i,u[1]=r.bounds.minY-s):(u[0]=0,u[1]=0),u[2]=t.frame.width,u[3]=t.frame.height,d[0]=t.source.width,d[1]=t.source.height,d[2]=1/d[0],d[3]=1/d[1],c[0]=t.source.pixelWidth,c[1]=t.source.pixelHeight,c[2]=1/c[0],c[3]=1/c[1],f[0]=.5*c[2],f[1]=.5*c[3],f[2]=t.frame.width*d[2]-.5*c[2],f[3]=t.frame.height*d[3]-.5*c[3];let g=this.renderer.renderTarget.rootRenderTarget.colorTexture;p[0]=i*n,p[1]=s*n,p[2]=g.source.width*n,p[3]=g.source.height*n,e instanceof h.g&&(e.source.resource=null);let m=this.renderer.renderTarget.getRenderTarget(e);this.renderer.renderTarget.bind(e,!!o),e instanceof h.g?(x[0]=e.frame.width,x[1]=e.frame.height):(x[0]=m.width,x[1]=m.height),x[2]=m.isRoot?-1:1,this._filterGlobalUniforms.update()}_findFilterResolution(t){let e=this._filterStackIndex-1;for(;e>0&&this._filterStack[e].skip;)--e;return e>0&&this._filterStack[e].inputTexture?this._filterStack[e].inputTexture.source._resolution:t}_findPreviousFilterOffset(){let t=0,e=0,r=this._filterStackIndex;for(;r>0;){r--;let i=this._filterStack[r];if(!i.skip){t=i.bounds.minX,e=i.bounds.minY;break}}return{x:t,y:e}}_calculateFilterArea(t,e){if(t.renderables?!function(t,e){e.clear();let r=e.matrix;for(let r=0;r<t.length;r++){let i=t[r];if(i.globalDisplayStatus<7)continue;let s=i.renderGroup??i.parentRenderGroup;s?.isCachedAsTexture?e.matrix=f.copyFrom(s.textureOffsetInverseTransform).append(i.worldTransform):s?._parentCacheAsTextureRenderGroup?e.matrix=f.copyFrom(s._parentCacheAsTextureRenderGroup.inverseWorldTransform).append(i.groupTransform):e.matrix=i.worldTransform,e.addBounds(i.bounds)}e.matrix=r}(t.renderables,e):t.filterEffect.filterArea?(e.clear(),e.addRect(t.filterEffect.filterArea),e.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,e),t.container){let r=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;r&&e.applyMatrix(r)}}_applyFiltersToTexture(t,e){let r=t.inputTexture,i=t.bounds,s=t.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(t.backTexture.source,3),1===s.length)s[0].apply(this,r,t.outputRenderSurface,e);else{let r=t.inputTexture,n=u.W.getOptimalTexture(i.width,i.height,r.source._resolution,!1),a=n,o=0;for(o=0;o<s.length-1;++o){s[o].apply(this,r,a,!0);let t=r;r=a,a=t}s[o].apply(this,r,t.outputRenderSurface,e),u.W.returnTexture(n)}}_calculateFilterBounds(t,e,r,i,s){let n=this.renderer,a=t.bounds,o=t.filters,l=1/0,h=0,u=!0,d=!1,c=!1,f=!0;for(let t=0;t<o.length;t++){let e=o[t];if(l=Math.min(l,"inherit"===e.resolution?i:e.resolution),h+=e.padding,"off"===e.antialias?u=!1:"inherit"===e.antialias&&u&&(u=r),e.clipToViewport||(f=!1),!(e.compatibleRenderers&n.type)){c=!1;break}if(e.blendRequired&&!(n.backBuffer?.useBackBuffer??!0)){(0,p.R)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),c=!1;break}c=e.enabled||c,d||(d=e.blendRequired)}if(!c||(f&&a.fitBounds(0,e.width/i,0,e.height/i),a.scale(l).ceil().scale(1/l).pad((0|h)*s),!a.isPositive)){t.skip=!0;return}t.antialias=u,t.resolution=l,t.blendRequired=d}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let t,e=this._filterStackIndex-1;for(;e>0&&(e--,(t=this._filterStack[e]).skip););return t}_pushFilterData(){let t=this._filterStack[this._filterStackIndex];return t||(t=this._filterStack[this._filterStackIndex]=new g),this._filterStackIndex++,t}}m.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem],name:"filter"},i.XO.add(m),i.XO.add(s)},71854:(t,e,r)=>{"use strict";r.d(e,{U:()=>n});let i={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},s=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){if("none"===t){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace="front"===t}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=i[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let e=new t;return e.depthTest=!1,e.blend=!0,e}};s.default2d=s.for2d();let n=s},73009:(t,e,r)=>{"use strict";r.d(e,{r:()=>h});var i=r(20177),s=r(62104),n=r(52295),a=r(42577),o=r(49521),l=r(25815);function h(t,e,r,u=0){if(t.texture===n.g.WHITE&&!t.fill)return i.Q.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(t.fill){if(t.fill instanceof l.m){let r=t.fill,i=e.createPattern(r.texture.source.resource,"repeat"),n=r.transform.copyTo(s.u.shared);return n.scale(r.texture.frame.width,r.texture.frame.height),i.setTransform(n),i}else if(t.fill instanceof o._){let s,n=t.fill,a="linear"===n.type,o="local"===n.textureSpace,l=1,h=1;o&&r&&(l=r.width+u,h=r.height+u);let d=!1;if(a){let{start:t,end:r}=n;s=e.createLinearGradient(t.x*l,t.y*h,r.x*l,r.y*h),d=Math.abs(r.x-t.x)<Math.abs((r.y-t.y)*.1)}else{let{center:t,innerRadius:r,outerCenter:i,outerRadius:a}=n;s=e.createRadialGradient(t.x*l,t.y*h,r*l,i.x*l,i.y*h,a*l)}if(d&&o&&r){let t=r.lineHeight/h;for(let e=0;e<r.lines.length;e++){let a=(e*r.lineHeight+u/2)/h;n.colorStops.forEach(e=>{let r=a+e.offset*t;s.addColorStop(Math.floor(1e5*r)/1e5,i.Q.shared.setValue(e.color).toHex())})}}else n.colorStops.forEach(t=>{s.addColorStop(t.offset,i.Q.shared.setValue(t.color).toHex())});return s}}else{let r=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(s.u.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(i),r}return(0,a.R)("FillStyle not recognised",t),"red"}},74991:(t,e,r)=>{"use strict";var i=r(3230),s=r(85167),n=r(69655);class a extends n.K{constructor(t){super(),this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){let t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){let{canvasText:t}=this._renderer;t.getReferenceCount(this.currentKey)>0?t.decreaseReferenceCount(this.currentKey):this.texture&&t.returnTexture(this.texture),this._renderer.runners.resolutionChange.remove(this),this._renderer=null}}class o{constructor(t){this._renderer=t}validateRenderable(t){let e=this._getGpuText(t),r=t.styleKey;return e.currentKey!==r||t._didTextUpdate}addRenderable(t,e){let r=this._getGpuText(t);if(t._didTextUpdate){let e=t._autoResolution?this._renderer.resolution:t.resolution;(r.currentKey!==t.styleKey||t.resolution!==e)&&this._updateGpuText(t),t._didTextUpdate=!1}this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){let e=this._getGpuText(t);e._batcher.updateElement(e)}_updateGpuText(t){let e=this._getGpuText(t);e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,e.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t.styleKey,(0,s.s)(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){let e=new a(this._renderer);return e.currentKey="--",e.renderable=t,e.transform=t.groupTransform,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}o.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"text"};var l=r(56823),h=r(9715),u=r(51631),d=r(80406),c=r(96671),f=r(20177),p=r(92809),x=r(33749),g=r(45737),m=r(43958);let _=null,y=null;function b(t,e,r){for(let i=0,s=4*r*e;i<e;++i,s+=4)if(0!==t[s+3])return!1;return!0}function v(t,e,r,i,s){let n=4*e;for(let e=i,a=i*n+4*r;e<=s;++e,a+=n)if(0!==t[a+3])return!1;return!0}var S=r(88589),w=r(10627),T=r(73009);let C=new p.M;class P{getCanvasAndContext(t){let{text:e,style:r,resolution:i=1}=t,s=r._getFinalPadding(),n=S.P.measureText(e||" ",r),a=Math.ceil(Math.ceil(Math.max(1,n.width)+2*s)*i),o=Math.ceil(Math.ceil(Math.max(1,n.height)+2*s)*i),l=x.N.getOptimalCanvasAndContext(a,o);this._renderTextToCanvas(e,r,s,i,l);let h=r.trim?function(...t){let e=t[0];e.canvas||(e={canvas:t[0],resolution:t[1]});let{canvas:r}=e,i=Math.min(e.resolution??1,1),s=e.width??r.width,n=e.height??r.height,a=e.output;if(_||((y=(_=g.e.get().createCanvas(256,128)).getContext("2d",{willReadFrequently:!0})).globalCompositeOperation="copy",y.globalAlpha=1),(_.width<s||_.height<n)&&(_.width=(0,m.U5)(s),_.height=(0,m.U5)(n)),!y)throw TypeError("Failed to get canvas 2D context");y.drawImage(r,0,0,s,n,0,0,s*i,n*i);let o=y.getImageData(0,0,s,n).data,l=0,h=0,u=s-1,d=n-1;for(;h<n&&b(o,s,h);)++h;if(h===n)return p.M.EMPTY;for(;b(o,s,d);)--d;for(;v(o,s,l,h,d);)++l;for(;v(o,s,u,h,d);)--u;return++u,++d,y.globalCompositeOperation="source-over",y.strokeRect(l,h,u-l,d-h),y.globalCompositeOperation="copy",a??(a=new p.M),a.set(l/i,h/i,(u-l)/i,(d-h)/i),a}({canvas:l.canvas,width:a,height:o,resolution:1,output:C}):C.set(0,0,a,o);return{canvasAndContext:l,frame:h}}returnCanvasAndContext(t){x.N.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,r,i,s){let n,a,{canvas:o,context:l}=s,h=(0,w.Z)(e),u=S.P.measureText(t||" ",e),d=u.lines,c=u.lineHeight,p=u.lineWidths,x=u.maxLineWidth,g=u.fontProperties,m=o.height;if(l.resetTransform(),l.scale(i,i),l.textBaseline=e.textBaseline,e._stroke?.width){let t=e._stroke;l.lineWidth=t.width,l.miterLimit=t.miterLimit,l.lineJoin=t.join,l.lineCap=t.cap}l.font=h;let _=e.dropShadow?2:1;for(let t=0;t<_;++t){let o=e.dropShadow&&0===t,h=o?Math.ceil(Math.max(1,m)+2*r):0,_=h*i;if(o){l.fillStyle="black",l.strokeStyle="black";let t=e.dropShadow,r=t.color,s=t.alpha;l.shadowColor=f.Q.shared.setValue(r).setAlpha(s).toRgbaString();let n=t.blur*i,a=t.distance*i;l.shadowBlur=n,l.shadowOffsetX=Math.cos(t.angle)*a,l.shadowOffsetY=Math.sin(t.angle)*a+_}else{if(l.fillStyle=e._fill?(0,T.r)(e._fill,l,u,2*r):null,e._stroke?.width){let t=.5*e._stroke.width+2*r;l.strokeStyle=(0,T.r)(e._stroke,l,u,t)}l.shadowColor="black"}let y=(c-g.fontSize)/2;c-g.fontSize<0&&(y=0);let b=e._stroke?.width??0;for(let t=0;t<d.length;t++)n=b/2,a=b/2+t*c+g.ascent+y,"right"===e.align?n+=x-p[t]:"center"===e.align&&(n+=(x-p[t])/2),e._stroke?.width&&this._drawLetterSpacing(d[t],e,s,n+r,a+r-h,!0),void 0!==e._fill&&this._drawLetterSpacing(d[t],e,s,n+r,a+r-h)}}_drawLetterSpacing(t,e,r,i,s,n=!1){let{context:a}=r,o=e.letterSpacing,l=!1;if(S.P.experimentalLetterSpacingSupported&&(S.P.experimentalLetterSpacing?(a.letterSpacing=`${o}px`,a.textLetterSpacing=`${o}px`,l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),0===o||l)return void(n?a.strokeText(t,i,s):a.fillText(t,i,s));let h=i,u=S.P.graphemeSegmenter(t),d=a.measureText(t).width,c=0;for(let t=0;t<u.length;++t){let e=u[t];n?a.strokeText(e,h,s):a.fillText(e,h,s);let r="";for(let e=t+1;e<u.length;++e)r+=u[e];h+=d-(c=a.measureText(r).width)+o,d=c}}}let M=new P;class k{constructor(t){this._activeTextures={},this._renderer=t}getTexture(t,e,r,i){"string"==typeof t&&((0,u.t6)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:e}),t.style instanceof d.x||(t.style=new d.x(t.style)),t.textureStyle instanceof h.n||(t.textureStyle=new h.n(t.textureStyle)),"string"!=typeof t.text&&(t.text=t.text.toString());let{text:s,style:n,textureStyle:a}=t,o=t.resolution??this._renderer.resolution,{frame:l,canvasAndContext:f}=M.getCanvasAndContext({text:s,style:n,resolution:o}),p=(0,c.M)(f.canvas,l.width,l.height,o);if(a&&(p.source.style=a),n.trim&&(l.pad(n.padding),p.frame.copyFrom(l),p.frame.scale(1/o),p.updateUvs()),n.filters){let t=this._applyFilters(p,n.filters);return this.returnTexture(p),M.returnCanvasAndContext(f),t}return this._renderer.texture.initSource(p._source),M.returnCanvasAndContext(f),p}returnTexture(t){let e=t.source;e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",l.W.returnTexture(t,!0)}renderTextToCanvas(){(0,u.t6)("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;let e=t.styleKey;if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;let r=this.getTexture({text:t.text,style:t.style,resolution:t._resolution,textureStyle:t.textureStyle});return this._activeTextures[e]={texture:r,usageCount:1},r}decreaseReferenceCount(t){let e=this._activeTextures[t];e.usageCount--,0===e.usageCount&&(this.returnTexture(e.texture),this._activeTextures[t]=null)}getReferenceCount(t){return this._activeTextures[t]?.usageCount??0}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}_applyFilters(t,e){let r=this._renderer.renderTarget.renderTarget,i=this._renderer.filter.generateFilteredTexture({texture:t,filters:e});return this._renderer.renderTarget.bind(r,!1),i}destroy(){for(let t in this._renderer=null,this._activeTextures)this._activeTextures[t]&&this.returnTexture(this._activeTextures[t].texture);this._activeTextures=null}}k.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"canvasText"},i.XO.add(k),i.XO.add(o)},80406:(t,e,r)=>{"use strict";r.d(e,{x:()=>f});var i=r(13799),s=r(20177),n=r(43428),a=r(51631),o=r(42577),l=r(49521),h=r(25815),u=r(32139),d=r(91359);let c=class t extends i.A{constructor(e={}){super(),this.uid=(0,n.L)("textStyle"),this._tick=0,function(t){if("boolean"==typeof t.dropShadow&&t.dropShadow){let e=f.defaultDropShadow;t.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(void 0!==t.strokeThickness){(0,a.t6)(a.lj,"strokeThickness is now a part of stroke");let e=t.stroke,r={};if(s.Q.isColorLike(e))r.color=e;else if(e instanceof l._||e instanceof h.m)r.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))r=e;else throw Error("Invalid stroke value.");t.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if((0,a.t6)(a.lj,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||0===t.fill.length)throw Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&(0,o.R)("The number of fill colors must match the number of fill gradient stops.");let e=new l._({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),r=t.fillGradientStops.slice(),i=t.fill.map(t=>s.Q.shared.setValue(t).toNumber());r.forEach((t,r)=>{e.addColorStop(t,i[r])}),t.fill={fill:e}}}(e);let r={...t.defaultTextStyle,...e};for(let t in r)this[t]=r[t];this.update(),this._tick=0}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){null!==e&&"object"==typeof e?this._dropShadow=this._createProxy({...t.defaultDropShadow,...e}):this._dropShadow=e?this._createProxy({...t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){"string"==typeof t?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=Object.freeze(t),this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...u.T.defaultFillStyle,...t},()=>{this._fill=(0,d.w)({...this._originalFill},u.T.defaultFillStyle)})),this._fill=(0,d.w)(0===t?"black":t,u.T.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...u.T.defaultStrokeStyle,...t},()=>{this._stroke=(0,d.T)({...this._originalStroke},u.T.defaultStrokeStyle)})),this._stroke=(0,d.T)(t,u.T.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){let e=t.defaultTextStyle;for(let t in e)this[t]=e[t]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){let e="boolean"==typeof t?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(e),this._originalFill?.texture&&this._originalFill.texture.destroy(e),this._stroke?.texture&&this._stroke.texture.destroy(e),this._originalStroke?.texture&&this._originalStroke.texture.destroy(e)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,r,i)=>(t[r]=i,e?.(r,i),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(s.Q.isColorLike(t)||t instanceof l._||t instanceof h.m)}};c.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},c.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let f=c},82069:(t,e,r)=>{"use strict";function i(t,e,r){let i=(t>>24&255)/255;e[r++]=(255&t)/255*i,e[r++]=(t>>8&255)/255*i,e[r++]=(t>>16&255)/255*i,e[r++]=i}r.d(e,{V:()=>i})},84597:(t,e,r)=>{"use strict";r.d(e,{B:()=>h});var i=r(24077),s=r(29755);let n={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function a(t){let e=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,i=/var(<[^>]+>)? (\w+)/,s=/:\s*(\w+)/,n=/(\w+)\s*:\s*([\w\<\>]+)/g,a=/struct\s+(\w+)/,o=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g)?.map(t=>({group:parseInt(t.match(e)[1],10),binding:parseInt(t.match(r)[1],10),name:t.match(i)[2],isUniform:"<uniform>"===t.match(i)[1],type:t.match(s)[1]}));if(!o)return{groups:[],structs:[]};let l=t.match(/struct\s+(\w+)\s*{([^}]+)}/g)?.map(t=>{let e=t.match(a)[1],r=t.match(n).reduce((t,e)=>{let[r,i]=e.split(":");return t[r.trim()]=i.trim(),t},{});return r?{name:e,members:r}:null}).filter(({name:t})=>o.some(e=>e.type===t))??[];return{groups:o,structs:l}}var o=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(o||{});let l=Object.create(null);class h{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;let{fragment:e,vertex:r,layout:i,gpuLayout:s,name:n}=t;if(this.name=n,this.fragment=e,this.vertex=r,e.source===r.source){let t=a(e.source);this.structsAndGroups=t}else{let t=a(r.source),i=a(e.source);this.structsAndGroups=function(t,e){let r=new Set,i=new Set;return{structs:[...t.structs,...e.structs].filter(t=>!r.has(t.name)&&(r.add(t.name),!0)),groups:[...t.groups,...e.groups].filter(t=>{let e=`${t.name}-${t.binding}`;return!i.has(e)&&(i.add(e),!0)})}}(t,i)}this.layout=i??function({groups:t}){let e=[];for(let r=0;r<t.length;r++){let i=t[r];e[i.group]||(e[i.group]={}),e[i.group][i.name]=i.binding}return e}(this.structsAndGroups),this.gpuLayout=s??function({groups:t}){let e=[];for(let r=0;r<t.length;r++){let i=t[r];e[i.group]||(e[i.group]=[]),i.isUniform?e[i.group].push({binding:i.binding,visibility:o.VERTEX|o.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===i.type?e[i.group].push({binding:i.binding,visibility:o.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===i.type&&e[i.group].push({binding:i.binding,visibility:o.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){let{vertex:t,fragment:e}=this,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=(0,i.X)(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=function({source:t,entryPoint:e}){let r={},i=t.indexOf(`fn ${e}`);if(-1!==i){let e=t.indexOf("->",i);if(-1!==e){let a,o=t.substring(i,e),l=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;for(;null!==(a=l.exec(o));){let t=n[a[3]]??"float32";r[a[2]]={location:parseInt(a[1],10),format:t,stride:(0,s.m)(t).stride,offset:0,instance:!1,start:0}}}}return r}(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,l[this._cacheKey]=null}static from(t){let e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return l[e]||(l[e]=new h(t),l[e]._cacheKey=e),l[e]}}},85167:(t,e,r)=>{"use strict";r.d(e,{s:()=>s});var i=r(15757);function s(t,e){let{texture:r,bounds:s}=t,n=e._style._getFinalPadding();(0,i.y)(s,e._anchor,r);let a=e._anchor._x*n*2,o=e._anchor._y*n*2;s.minX-=n-a,s.minY-=n-o,s.maxX-=n-a,s.maxY-=n-o}},85793:(t,e,r)=>{"use strict";var i=r(3230),s=r(61583),n=r(51631),a=r(41849);let o=class t extends a.u{constructor(...t){super({});let e=t[0]??{};"number"==typeof e&&((0,n.t6)(n.lj,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(e)}build(e){e={...t.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;let r=this.verticesX*this.verticesY,i=[],s=[],n=[],a=this.verticesX-1,o=this.verticesY-1,l=this.width/a,h=this.height/o;for(let t=0;t<r;t++){let e=t%this.verticesX,r=t/this.verticesX|0;i.push(e*l,r*h),s.push(e/a,r/o)}let u=a*o;for(let t=0;t<u;t++){let e=t%a,r=t/a|0,i=r*this.verticesX+e,s=r*this.verticesX+e+1,o=(r+1)*this.verticesX+e,l=(r+1)*this.verticesX+e+1;n.push(i,s,o,s,l,o)}this.buffers[0].data=new Float32Array(i),this.buffers[1].data=new Float32Array(s),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};o.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let l=o,h=class t extends l{constructor(e={}){e={...t.defaultOptions,...e},super({width:e.width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=t.anchor?.x,this._anchorY=t.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){let t=this.positions,{width:e,height:r,_leftWidth:i,_rightWidth:s,_topHeight:n,_bottomHeight:a,_anchorX:o,_anchorY:l}=this,h=i+s,u=n+a,d=Math.min(e>h?1:e/h,r>u?1:r/u),c=o*e,f=l*r;t[0]=t[8]=t[16]=t[24]=-c,t[2]=t[10]=t[18]=t[26]=i*d-c,t[4]=t[12]=t[20]=t[28]=e-s*d-c,t[6]=t[14]=t[22]=t[30]=e-c,t[1]=t[3]=t[5]=t[7]=-f,t[9]=t[11]=t[13]=t[15]=n*d-f,t[17]=t[19]=t[21]=t[23]=r-a*d-f,t[25]=t[27]=t[29]=t[31]=r-f,this.getBuffer("aPosition").update()}updateUvs(){let t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;let e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};h.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};class u extends s.U{constructor(){super(),this.geometry=new h}destroy(){this.geometry.destroy()}}class d{constructor(t){this._renderer=t}addRenderable(t,e){let r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){let e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){let e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}_updateBatchableSprite(t,e){e.geometry.update(t),e.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){let e=t._gpuData[this._renderer.uid]=new u;return e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,t.didViewUpdate||this._updateBatchableSprite(t,e),e}destroy(){this._renderer=null}}d.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"nineSliceSprite"},i.XO.add(d)},86833:(t,e,r)=>{"use strict";let i;r.d(e,{W:()=>n});var s=r(45737);function n(){return(!i||i?.isContextLost())&&(i=s.e.get().createCanvas().getContext("webgl",{})),i}},86942:(t,e,r)=>{"use strict";r.d(e,{F:()=>i,a:()=>s});let i={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},s={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}}},88497:(t,e,r)=>{"use strict";r.d(e,{S:()=>i});var i=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(i||{})},88589:(t,e,r)=>{"use strict";r.d(e,{P:()=>l});var i=r(4516),s=r(45737),n=r(10627);let a={willReadFrequently:!0},o=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0===e){let r=s.e.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,i,s,n,a,o,l){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=s,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=l}static measureText(e=" ",r,i=t._canvas,s=r.wordWrap){let a=`${e}-${r.styleKey}-wordWrap-${s}`;if(t._measurementCache.has(a))return t._measurementCache.get(a);let o=(0,n.Z)(r),l=t.measureFont(o);0===l.fontSize&&(l.fontSize=r.fontSize,l.ascent=r.fontSize);let h=t.__context;h.font=o;let u=(s?t._wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),d=Array(u.length),c=0;for(let e=0;e<u.length;e++){let i=t._measureText(u[e],r.letterSpacing,h);d[e]=i,c=Math.max(c,i)}let f=r._stroke?.width||0,p=c+f;r.dropShadow&&(p+=r.dropShadow.distance);let x=r.lineHeight||l.fontSize,g=Math.max(x,l.fontSize+f)+(u.length-1)*(x+r.leading);r.dropShadow&&(g+=r.dropShadow.distance);let m=new t(e,r,p,g,u,d,x+r.leading,c,l);return t._measurementCache.set(a,m),m}static _measureText(e,r,i){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(e),a=n.width,o=-n.actualBoundingBoxLeft,l=n.actualBoundingBoxRight-o;if(a>0)if(s)a-=r,l-=r;else{let i=(t.graphemeSegmenter(e).length-1)*r;a+=i,l+=i}return Math.max(a,l)}static _wordWrap(e,r,i=t._canvas){let s=i.getContext("2d",a),n=0,o="",l="",h=Object.create(null),{letterSpacing:u,whiteSpace:d}=r,c=t._collapseSpaces(d),f=t._collapseNewlines(d),p=!c,x=r.wordWrapWidth+u,g=t._tokenize(e);for(let e=0;e<g.length;e++){let i=g[e];if(t._isNewline(i)){if(!f){l+=t._addLine(o),p=!c,o="",n=0;continue}i=" "}if(c){let e=t.isBreakingSpace(i),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}let a=t._getFromCache(i,u,h,s);if(a>x)if(""!==o&&(l+=t._addLine(o),o="",n=0),t.canBreakWords(i,r.breakWords)){let e=t.wordWrapSplit(i);for(let a=0;a<e.length;a++){let d=e[a],c=d,f=1;for(;e[a+f];){let s=e[a+f];if(t.canBreakChars(c,s,i,a,r.breakWords))break;d+=s,c=s,f++}a+=f-1;let g=t._getFromCache(d,u,h,s);g+n>x&&(l+=t._addLine(o),p=!1,o="",n=0),o+=d,n+=g}}else{o.length>0&&(l+=t._addLine(o),o="",n=0);let r=e===g.length-1;l+=t._addLine(i,!r),p=!1,o="",n=0}else a+n>x&&(p=!1,l+=t._addLine(o),o="",n=0),(o.length>0||!t.isBreakingSpace(i)||p)&&(o+=i,n+=a)}return l+t._addLine(o,!1)}static _addLine(e,r=!0){return e=t._trimRight(e),e=r?`${e}
`:e}static _getFromCache(e,r,i,s){let n=i[e];return"number"!=typeof n&&(n=t._measureText(e,r,s)+r,i[e]=n),n}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){let i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){let r=[],i="";if("string"!=typeof e)return r;for(let s=0;s<e.length;s++){let n=e[s],a=e[s+1];if(t.isBreakingSpace(n,a)||t._isNewline(n)){""!==i&&(r.push(i),i=""),"\r"===n&&"\n"===a?(r.push("\r\n"),s++):r.push(n);continue}i+=n}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,s){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];let r=t._context;r.font=e;let i=r.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),s={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return t._fonts[e]=s,s}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{let r=new OffscreenCanvas(0,0),i=r.getContext("2d",a);if(i?.measureText)return t.__canvas=r,r;e=s.e.get().createCanvas()}catch(t){e=s.e.get().createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",a)),t.__context}};o.METRICS_STRING="|\xc9q\xc5",o.BASELINE_SYMBOL="M",o.BASELINE_MULTIPLIER=1.4,o.HEIGHT_MULTIPLIER=2,o.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){let t=new Intl.Segmenter;return e=>{let r=t.segment(e),i=[],s=0;for(let t of r)i[s++]=t.segment;return i}}return t=>[...t]})(),o.experimentalLetterSpacing=!1,o._fonts={},o._newlines=[10,13],o._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],o._measurementCache=(0,i.g)(1e3);let l=o},90848:(t,e,r)=>{"use strict";r.d(e,{T:()=>i});class i{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(let r in t){let i=t[r];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;let t=[],e=0;for(let r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,e){let r=this.resources[e];t!==r&&(r&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){let e=this.resources;for(let r in e)e[r]._touched=t}destroy(){let t=this.resources;for(let e in t){let r=t[e];r?.off?.("change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){let e=this.resources;for(let r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}},91359:(t,e,r)=>{"use strict";r.d(e,{T:()=>c,w:()=>d});var i=r(20177),s=r(52295),n=r(49521),a=r(25815);function o(t){return t instanceof a.m}function l(t){return t instanceof n._}function h(t,e,r){return t.fill=e,t.color=0xffffff,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function u(t,e,r){return e.buildGradient(),t.fill=e,t.color=0xffffff,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...r,...t}}function d(t,e){if(null==t)return null;let r={};if(i.Q.isColorLike(t)){let n=i.Q.shared.setValue(t??0);return r.color=n.toNumber(),r.alpha=1===n.alpha?e.alpha:n.alpha,r.texture=s.g.WHITE,{...e,...r}}if(t instanceof s.g)return r.texture=t,{...e,...r};if(o(t))return h(r,t,e);if(l(t))return u(r,t,e);else if(t.fill&&o(t.fill))return h(t,t.fill,e);else if(t.fill&&l(t.fill))return u(t,t.fill,e);let n={...e,...t},a=i.Q.shared.setValue(n.color);return n.alpha*=a.alpha,n.color=a.toNumber(),n}function c(t,e){let{width:r,alignment:i,miterLimit:s,cap:n,join:a,pixelLine:o,...l}=e,h=d(t,l);return h?{width:r,alignment:i,miterLimit:s,cap:n,join:a,pixelLine:o,...h}:null}},93087:(t,e,r)=>{"use strict";r.d(e,{i:()=>n});let i={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var s=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(s||{});function n(t,e){return"no-premultiply-alpha"===e.alphaMode&&i[t]||t}},96671:(t,e,r)=>{"use strict";r.d(e,{M:()=>n});var i=r(56823);let s=new(r(45033)).c;function n(t,e,r,n){s.minX=0,s.minY=0,s.maxX=t.width/n|0,s.maxY=t.height/n|0;let a=i.W.getOptimalTexture(s.width,s.height,n,!1);return a.source.uploadMethodId="image",a.source.resource=t,a.source.alphaMode="premultiply-alpha-on-upload",a.frame.width=e/n,a.frame.height=r/n,a.source.emit("update",a.source),a.updateUvs(),a}}}]);
//# sourceMappingURL=3624.d1644b4eab342402.js.map