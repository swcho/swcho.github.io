<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="initial-scale=1.0, width=device-width" data-next-head=""/><title data-next-head="">remark.js</title><link rel="preload" href="/_next/static/css/d20c50ed748cd26f.css" as="style"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/vs2015.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous"/><link rel="stylesheet" href="/_next/static/css/d20c50ed748cd26f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b9bde0f71dfd7f80.js" defer=""></script><script src="/_next/static/chunks/framework-e837885f9f00810f.js" defer=""></script><script src="/_next/static/chunks/main-beade485850481f6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-57b73c2138884752.js" defer=""></script><script src="/_next/static/chunks/5695-9c01eff236121af5.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/2024-05-19-remark-1-430428c980211077.js" defer=""></script><script src="/_next/static/4VfyYs9vc-5CtkULTTuNp/_buildManifest.js" defer=""></script><script src="/_next/static/4VfyYs9vc-5CtkULTTuNp/_ssgManifest.js" defer=""></script><style id="__jsx-4134105190">.markdown html{font:118.75%/1.58 'Roboto',serif;box-sizing:border-box;overflow-y:scroll;}.markdown *{box-sizing:inherit;}.markdown *:before{box-sizing:inherit;}.markdown *:after{box-sizing:inherit;}.markdown body{color:hsla(0,0%,0%,0.73);font-family:'Roboto',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}.markdown img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Roboto Slab',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}.markdown h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Roboto Slab',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}.markdown h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Roboto Slab',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}.markdown h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Roboto Slab',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}.markdown h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Roboto Slab',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}.markdown h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;color:hsla(0,0%,0%,0.9);font-family:'Roboto Slab',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}.markdown hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown ul{margin-left:1.58rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;list-style-position:outside;list-style-image:none;}.markdown ol{margin-left:1.58rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;list-style-position:outside;list-style-image:none;}.markdown dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;font-size:0.85rem;line-height:1.58rem;}.markdown table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;font-size:1rem;line-height:1.58rem;border-collapse:collapse;width:100%;}.markdown fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;font-size:0.94737rem;line-height:1.58rem;border-left:0.5925rem solid #017698;color:hsla(0,0%,0%,0.65);background-color:hsla(0,0%,0%,0.1);padding:0.29625rem 0.9875rem;font-style:italic;}.markdown form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.58rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}.markdown address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.58rem;}.markdown b{font-weight:700;}.markdown strong{font-weight:700;}.markdown dt{font-weight:700;}.markdown th{font-weight:700;}.markdown li{margin-bottom:calc(1.58rem / 2);}.markdown ol li{padding-left:0;}.markdown ul li{padding-left:0;}.markdown li > ol{margin-left:1.58rem;margin-bottom:calc(1.58rem / 2);margin-top:calc(1.58rem / 2);}.markdown li > ul{margin-left:1.58rem;margin-bottom:calc(1.58rem / 2);margin-top:calc(1.58rem / 2);}.markdown blockquote *:last-child{margin-bottom:0;}.markdown li *:last-child{margin-bottom:0;}.markdown p *:last-child{margin-bottom:0;}.markdown li > p{margin-bottom:calc(1.58rem / 2);}.markdown code{font-size:0.85rem;line-height:1.58rem;}.markdown kbd{font-size:0.85rem;line-height:1.58rem;}.markdown samp{font-size:0.85rem;line-height:1.58rem;}.markdown abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}.markdown acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}.markdown abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}.markdown thead{text-align:left;}.markdown td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.05333rem;padding-right:1.05333rem;padding-top:0.79rem;padding-bottom:calc(0.79rem - 1px);}.markdown th:first-child,td:first-child{padding-left:0;}.markdown th:last-child,td:last-child{padding-right:0;}.markdown a{color:#017698;text-decoration:none;background-image:linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0) 1px, #017698 1px, #017698 2px, rgba(0, 0, 0, 0) 2px);}.markdown a:hover,a:active{text-shadow:none;background-image:none;}.markdown h1,h2,h3,h4,h5,h6{margin-top:3.16rem;}.markdown li>ol,li>ul{margin-left:20px;margin-bottom:0;}.markdown blockquote > :last-child{margin-bottom:0;}.markdown blockquote cite{font-size:1rem;line-height:1.58rem;color:hsla(0,0%,0%,0.73);font-style:normal;font-weight:400;}.markdown blockquote cite:before{content:"— ";}.markdown @media only screen and (max-width:480px){html{font-size:106.25%;line-height:28px;}blockquote{border-left:0.29625rem solid #017698;color:hsla(0,0%,0%,0.59);padding-left:0.88875rem;font-style:italic;margin-left:-1.185rem;margin-right:0;}} .markdown{color:#3d3d3d}.markdown ul li{list-style-type:disc}.markdown ol{list-style-type:decimal}:not(pre) code{background-color:rgb(203 208 218);border-radius:3px;font-family:D2Coding,Consolas,"Roboto Mono","Liberation Mono",Menlo,Courier,monospace;padding:.2rem .3rem;margin:0 .2rem}.markdown * code{font-size:inherit}.markdown code[class*="language-"]{font-family:D2Coding,Consolas,"Roboto Mono","Liberation Mono",Menlo,Courier,monospace;padding:1rem;background-color:#2d2d2d}</style></head><body><div id="__next"><div class="leading-normal tracking-normal bg-gray-100 min-h-screen"><nav class="w-full"><div id="progress" class="top-0 z-20 h-1" style="background:linear-gradient(to right, #4dc0b5 var(--scroll), transparent 0)"></div><div class="flex flex-wrap items-center justify-between w-full py-3 mx-auto mt-0 md:max-w-4xl"><div class="pl-4"><a href="/">lifetime trails</a></div><div class="block pr-4 lg:hidden"><button id="nav-toggle" type="button" class="flex items-center px-3 py-2 text-gray-500 appearance-none hover:text-gray-900 hover:border-teal-500 focus:outline-none"><svg class="w-3 h-3 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button></div><div id="nav-content" class="bg-gray-100 border-b flex-grow lg:border-none lg:flex lg:items-center lg:mt-0 lg:shadow-none lg:w-auto md:bg-transparent mt-2 shadow w-full z-20 hidden"><ul class="items-center justify-end flex-1 list-reset lg:flex"><li class="mr-3"><a href="/">Home</a></li></ul></div></div></nav><div class="container w-full px-4 pb-10 mx-auto md:max-w-3xl"><h1 class="font-bold text-gray-800 mb-4 text-5xl mt-8 mb-8">remark.js</h1><div class="details"><p class="text-gray-500">MDX 생태계의 중심에 있는 remark.js를 소개하고 분석해 봅니다.</p><p class="text-gray-400 text-right -mt-1"><span class="mr-4">2024-05-19</span></p></div><article class="markdown"><h1>소개</h1>
<p><a href="https://remark.js.org/">remark</a>는 markdown을 처리하는 파서 및 생성기 입니다.
markdown을 처리할 수 있는 라이브러리는 많이 있습니다.
특별히 <code>markdown-it</code>과 <code>marked</code>는 매우 오랜 시간 주목을 받아왔고 사용처도 늘어나고 있습니다.</p>
<p><img alt="alt text" loading="lazy" width="2560" height="900" decoding="async" data-nimg="1" class="shadow" style="color:transparent;width:100%;height:auto" src="/_next/static/media/image.a0887b11.png"/>
https://npmtrends.com/markdown-it-vs-marked-vs-remark</p>
<p>그럼에도 불구하고 remark에 주목을 해야 하는 이유는 mdx 툴체인의 코어 라이브러리이기 때문입니다.
사양을 주도하고 에코시스템을 만들어가는 주요 개발자들이 다음과 같이 유사합니다.</p>
<ul>
<li>https://github.com/orgs/unifiedjs/people</li>
<li>https://github.com/orgs/remarkjs/people</li>
<li>https://github.com/orgs/mdx-js/people</li>
</ul>
<p><a href="https://unifiedjs.com/"><code>unified</code></a>라는 패키지는 general purpose parser/generator를 표방합니다.
그 위에 <a href="https://remark.js.org/"><code>remark</code></a>가 markdown 파일을 처리하는 핵심 라이브러리와 플러그인 구조를 제공합니다. 다시 그 위에 <a href="https://mdxjs.com/"><code>MDX</code></a>라는 markdown과 jsx를 결합한 형식을 제공하고 있습니다.</p>
<p>지금 이 글을 작성하는 방식도 mdx이고 <a href="https://nextjs.org/docs/pages/building-your-application/configuring/mdx">Markdown and MDX</a>와 같이 next.js에서 또는 <a href="https://storybook.js.org/docs/writing-docs/mdx/">MDX • Storybook docs</a>와 같이 storybook에서도 사용할 수 있는 보편적인 형식이 되었습니다.</p>
<p><code>MDX</code> 처리에 있어 핵심이 되는 플러그인 구조를 제공하는 remark를 이해하는 것은 에코시스템의 활용과 확장의 측면에서 의미가 있을 것이라 생각합니다.</p>
<h1>기술 스택</h1>
<p><code>tsconfig.json</code>을 사용하지만 ts 파일 대신 js 파일에서 주석을 기반으로 형검사를 수행합니다.</p>
<p>다음은 <code>remark</code>의 의존 관계 다이어그램 입니다.</p>
<p><img alt="" loading="lazy" width="661" height="554" decoding="async" data-nimg="1" class="shadow" style="color:transparent;width:100%;height:auto" src="/_next/static/media/dependencies.758273d1.svg"/></p>
<p><code>unified</code> 패키지를 기반으로 <code>micromark</code> 패키지군을 사용하여 <code>mdx</code> 파일을 파싱하고 <code>mdast-util-to-markdown</code> 패키지를 사용하여 파싱한 결과인 markdown ast 정보를 바탕으로 html을 생성합니다.</p>
<p><code>remark</code>는 다음과 같이 단 한줄의 코드로되어 있습니다.</p>
<pre><code class="language-js">// Note: types exposed from `index.d.ts`
import remarkParse from &#x27;remark-parse&#x27;;
import remarkStringify from &#x27;remark-stringify&#x27;;
import { unified } from &#x27;unified&#x27;;

/**
 * Create a new unified processor that already uses `remark-parse` and
 * `remark-stringify`.
 */
export const remark = unified().use(remarkParse).use(remarkStringify).freeze();
</code></pre>
<p>물론 <code>remark</code> 소스코드는 monorepo로되어 있어 <code>remark-parse</code>, <code>remark-stringify</code>와 같은 패키지를 사용하여 AST를 만들고 다시 텍스트로 출력하는 일련의 코드가 존재 합니다.</p>
<p>위의 코드를 이해하려면 <code>unified</code>의 동작 방식을 이해할 필요가 있습니다.</p>
<p><code>unified()</code>를 호출하는 리턴 값은 <code>Processor</code>라는 클래스의 인스턴스 입니다.</p>
<p>이 <code>Processor</code>는 <code>use</code>, <code>freeze</code>, <code>process</code> 등의 API를 제공합니다.</p>
<p><code>Processor</code>는 다음과 같은 일종의 가상함수를 가집니다.</p>
<ul>
<li><code>parser</code>: <code>string</code> 입력을 받아 tokenize한 <code>ParseTree</code>를 반환합니다. <code>remark-parse</code>에 해당 구현이 있습니다.</li>
<li><code>compiler</code>: <code>parser</code>에서 전달한 <code>ParseTree</code>를 바탕으로 새로운 형식으로 출력합니다.</li>
<li><code>transformer</code>: <code>ParseTree</code>를 전달 받아 이를 조작합니다.</li>
</ul>
<p>정리하면 <code>unified()</code>의 call chain을 통해 parser, compiler, transformer를 조합할 수 있습니다.
이 후 <code>process</code> 함수를 호출하면 parer로 부터 <code>ParseTree</code>를 생성하여 transformer를 거쳐 compiler에 전달합니다.</p>
<h1>처리과정</h1>
<p>다음은 <code>micromark</code> 테스트 코드를 수행했을 때의 과정을 보여줍니다.</p>
<p><img alt="" loading="lazy" width="763" height="322" decoding="async" data-nimg="1" class="shadow" style="color:transparent;width:100%;height:auto" src="/_next/static/media/toMarkdown.341025b9.svg"/></p>
<p>입력으로 전달받은 문자열을 tokenizing 합니다.
token 정보는 이벤트 형식으로 전달합니다.
token 이벤트를 기반으로 html을 생성합니다.</p>
<h1>마치며</h1>
<p><code>remark</code> 스스로는 <code>parse</code> API를 통해 markdown의 AST를 생성하고 <code>process</code> API를 통해 다시 markdown을 생성하는 역할을 하는 간단한 라이브러리 입니다.</p>
<p>따라서 실제로 많이 사용하는 패턴은 <code>remark-parse</code>를 사용하여 Markdown AST를 생성하고 다양한 plugin을 조합하여 원하는 출력을 얻어내는 것 입니다.</p>
<p>대표적으로 <a href="https://github.com/mdx-js/mdx">mdx-js/mdx</a>의 경우 <code>remark-parse</code>, <code>remark-mdx</code>, <code>remark-rehype</code> 등의 패키지를 조합하여 <code>mdx</code> 형식의 파일을 처리 합니다.</p>
<p><code>@mdx-js/react</code>라는 패키지를 활용하면 <code>@mdx-js/loader</code>를 사용해 생성한 코드를 custom 컴포넌트와 함께 렌더링할 수 있습니다.</p>
<p>Markdown의 사용은 개발자 커뮤니티에서 부터 시작해서 다양한 분야로 퍼지고 있습니다.</p>
<p>많은 문서 형식들이 존재해 왔지만 결국에는 그 자체로 읽기가능하고 포팅이 쉬운 방식을 사람들이 선택하고 있습니다.
마치 xml을 json이 대체하 듯이 evernote, notion 등의 proprietary 포멧이 아닌 defacto 문서 형식으로 markdown을 사용하고 있습니다.</p>
<p>이런 markdown을 손쉽게 확장함으로서 유연성을 제공하는 mdx 형식과 그 생태계를 주목하고 관련 기술을 습득해 둠으로서 각자의 분야에서 새로운 아이디어를 이끌어내는 재료가 되리라 생각합니다.</p>
<p>개인적으로 <code>unified</code>의 생태계를 이해하고 분석하는 것이 쉽지는 않았습니다.
워낙 많은 패키지에 걸쳐 기능이 구현되어 있고 js에 주석기반의 type checking을 하는 코드를 이해하는데 시간이 필요했습니다.
함수형 기반으로 작성하다보니 higher order function이 많았고 이를 트레이스하고 분석하는 것 역시 지루하고 고된 작업이였습니다.
덕분에 포스팅 작성이 오래 걸렸지만 한편으로는 후련하네요. ㅎ</p></article><div class="react-utterences"><div>Loading script...</div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blogs/2024-05-19-remark-1","query":{},"buildId":"4VfyYs9vc-5CtkULTTuNp","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>