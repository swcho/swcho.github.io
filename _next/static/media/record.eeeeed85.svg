<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="844px" preserveAspectRatio="none" style="width:1057px;height:844px;background:#FFFFFF;" version="1.1" viewBox="0 0 1057 844" width="1057px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="832.4" style="stroke:#181818;stroke-width:0.5;" width="563" x="194.5" y="6"/><text fill="#000000" font-family="D2Coding" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35" x="458.5" y="18.09">rrweb</text><rect fill="#DDDDDD" height="832.4" style="stroke:#181818;stroke-width:0.5;" width="104" x="777" y="6"/><text fill="#000000" font-family="D2Coding" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="780" y="18.09">rrweb-snapshot</text><rect fill="#FFFFFF" height="497.36" style="stroke:#181818;stroke-width:1.0;" width="10" x="253" y="87.4"/><rect fill="#FFFFFF" height="235.48" style="stroke:#181818;stroke-width:1.0;" width="10" x="258" y="124.48"/><rect fill="#FFFFFF" height="187.72" style="stroke:#181818;stroke-width:1.0;" width="10" x="258" y="397.04"/><rect fill="#FFFFFF" height="29.08" style="stroke:#181818;stroke-width:1.0;" width="10" x="253" y="757.08"/><rect fill="#FFFFFF" height="153.64" style="stroke:#181818;stroke-width:1.0;" width="10" x="392.5" y="431.12"/><rect fill="#FFFFFF" height="116.56" style="stroke:#181818;stroke-width:1.0;" width="10" x="397.5" y="468.2"/><rect fill="#FFFFFF" height="172.32" style="stroke:#181818;stroke-width:1.0;" width="10" x="692.5" y="613.84"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="697.5" y="650.92"/><rect fill="#FFFFFF" height="63.16" style="stroke:#181818;stroke-width:1.0;" width="10" x="697.5" y="723"/><rect fill="#FFFFFF" height="143.24" style="stroke:#181818;stroke-width:1.0;" width="10" x="824" y="187.64"/><rect fill="#FFFFFF" height="70.08" style="stroke:#181818;stroke-width:1.0;" width="10" x="829" y="224.72"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="834" y="266.8"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="26" x2="26" y1="56.32" y2="804.16"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="257.5" x2="257.5" y1="56.32" y2="804.16"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="397.5" x2="397.5" y1="56.32" y2="804.16"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="561.5" x2="561.5" y1="56.32" y2="804.16"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="697.5" x2="697.5" y1="511.82" y2="804.16"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="828.5" x2="828.5" y1="56.32" y2="804.16"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="988.5" x2="988.5" y1="553.06" y2="804.16"/><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="5" y="25.08"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="28" x="12" y="45.1">user</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="28" x="12" y="823.18">user</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="198.5" y="25.08"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="105" x="205.5" y="45.1">record/index.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="198.5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="105" x="205.5" y="823.18">record/index.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="327.5" y="25.08"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="126" x="334.5" y="45.1">record/observer.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="327.5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="126" x="334.5" y="823.18">record/observer.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="491.5" y="25.08"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="126" x="498.5" y="45.1">record/mutation.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="491.5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="126" x="498.5" y="823.18">record/mutation.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="641.5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="98" x="648.5" y="823.18">MutationBuffer</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="783.5" y="25.08"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="77" x="790.5" y="45.1">snapshot.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="91" x="783.5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="77" x="790.5" y="823.18">snapshot.ts</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="925.5" y="803.16"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="112" x="932.5" y="823.18">MutationObserver</text><rect fill="#FFFFFF" height="497.36" style="stroke:#181818;stroke-width:1.0;" width="10" x="253" y="87.4"/><rect fill="#FFFFFF" height="235.48" style="stroke:#181818;stroke-width:1.0;" width="10" x="258" y="124.48"/><rect fill="#FFFFFF" height="187.72" style="stroke:#181818;stroke-width:1.0;" width="10" x="258" y="397.04"/><rect fill="#FFFFFF" height="29.08" style="stroke:#181818;stroke-width:1.0;" width="10" x="253" y="757.08"/><rect fill="#FFFFFF" height="153.64" style="stroke:#181818;stroke-width:1.0;" width="10" x="392.5" y="431.12"/><rect fill="#FFFFFF" height="116.56" style="stroke:#181818;stroke-width:1.0;" width="10" x="397.5" y="468.2"/><rect fill="#FFFFFF" height="172.32" style="stroke:#181818;stroke-width:1.0;" width="10" x="692.5" y="613.84"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="697.5" y="650.92"/><rect fill="#FFFFFF" height="63.16" style="stroke:#181818;stroke-width:1.0;" width="10" x="697.5" y="723"/><rect fill="#FFFFFF" height="143.24" style="stroke:#181818;stroke-width:1.0;" width="10" x="824" y="187.64"/><rect fill="#FFFFFF" height="70.08" style="stroke:#181818;stroke-width:1.0;" width="10" x="829" y="224.72"/><rect fill="#FFFFFF" height="28" style="stroke:#181818;stroke-width:1.0;" width="10" x="834" y="266.8"/><polygon fill="#181818" points="241,83.4,251,87.4,241,91.4,245,87.4" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="26" x2="247" y1="87.4" y2="87.4"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="42" x="33" y="82.41">record</text><line style="stroke:#181818;stroke-width:1.0;" x1="263" x2="310" y1="111.48" y2="111.48"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="310" y1="111.48" y2="124.48"/><line style="stroke:#181818;stroke-width:1.0;" x1="269" x2="310" y1="124.48" y2="124.48"/><polygon fill="#181818" points="279,120.48,269,124.48,279,128.48,275,124.48" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="112" x="275" y="106.49">takeFullSnapshot</text><polygon fill="#181818" points="37,154.56,27,158.56,37,162.56,33,158.56" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="31" x2="257" y1="158.56" y2="158.56"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="70" x="43" y="153.57">Event.Meta</text><polygon fill="#181818" points="812,183.64,822,187.64,812,191.64,816,187.64" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="818" y1="187.64" y2="187.64"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="175" x="275" y="182.65">snapshot(window.document)</text><line style="stroke:#181818;stroke-width:1.0;" x1="834" x2="881" y1="211.72" y2="211.72"/><line style="stroke:#181818;stroke-width:1.0;" x1="881" x2="881" y1="211.72" y2="224.72"/><line style="stroke:#181818;stroke-width:1.0;" x1="840" x2="881" y1="224.72" y2="224.72"/><polygon fill="#181818" points="850,220.72,840,224.72,850,228.72,846,224.72" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="133" x="846" y="206.73">serializeNodeWithId</text><line style="stroke:#181818;stroke-width:1.0;" x1="844" x2="886" y1="258.8" y2="258.8"/><line style="stroke:#181818;stroke-width:1.0;" x1="886" x2="886" y1="258.8" y2="271.8"/><line style="stroke:#181818;stroke-width:1.0;" x1="845" x2="886" y1="271.8" y2="271.8"/><polygon fill="#181818" points="855,267.8,845,271.8,855,275.8,851,271.8" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="91" x="851" y="253.81">serializeNode</text><polygon fill="#181818" points="279,326.88,269,330.88,279,334.88,275,330.88" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="828" y1="330.88" y2="330.88"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="28" x="285" y="325.89">node</text><polygon fill="#181818" points="37,355.96,27,359.96,37,363.96,33,359.96" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="31" x2="252" y1="359.96" y2="359.96"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="154" x="43" y="354.97">EventType.FullSnapshot</text><line style="stroke:#181818;stroke-width:1.0;" x1="263" x2="310" y1="384.04" y2="384.04"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="310" y1="384.04" y2="397.04"/><line style="stroke:#181818;stroke-width:1.0;" x1="269" x2="310" y1="397.04" y2="397.04"/><polygon fill="#181818" points="279,393.04,269,397.04,279,401.04,275,397.04" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="49" x="275" y="379.05">observe</text><polygon fill="#181818" points="380.5,427.12,390.5,431.12,380.5,435.12,384.5,431.12" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="386.5" y1="431.12" y2="431.12"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="91" x="275" y="426.13">initObservers</text><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="449.5" y1="455.2" y2="455.2"/><line style="stroke:#181818;stroke-width:1.0;" x1="449.5" x2="449.5" y1="455.2" y2="468.2"/><line style="stroke:#181818;stroke-width:1.0;" x1="408.5" x2="449.5" y1="468.2" y2="468.2"/><polygon fill="#181818" points="418.5,464.2,408.5,468.2,418.5,472.2,414.5,468.2" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="140" x="414.5" y="450.21">initMutationObserver</text><polygon fill="#181818" points="629.5,483.2,639.5,487.2,629.5,491.2,633.5,487.2" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="407.5" x2="635.5" y1="487.2" y2="487.2"/><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="641.5" y="481.2"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="98" x="648.5" y="501.22">MutationBuffer</text><polygon fill="#181818" points="913.5,539.52,923.5,543.52,913.5,547.52,917.5,543.52" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="407.5" x2="919.5" y1="543.52" y2="543.52"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="98" x="414.5" y="538.53">MutationBuffer</text><rect fill="#E2E2F0" height="30.24" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="925.5" y="522.44"/><text fill="#000000" font-family="D2Coding" font-size="14" lengthAdjust="spacing" textLength="112" x="932.5" y="542.46">MutationObserver</text><polygon fill="#181818" points="976.5,580.76,986.5,584.76,976.5,588.76,980.5,584.76" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="397.5" x2="982.5" y1="584.76" y2="584.76"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="56" x="404.5" y="579.77">observer</text><polygon fill="#181818" points="713.5,609.84,703.5,613.84,713.5,617.84,709.5,613.84" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="707.5" x2="987.5" y1="613.84" y2="613.84"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="112" x="719.5" y="608.85">processMutations</text><line style="stroke:#181818;stroke-width:1.0;" x1="707.5" x2="749.5" y1="642.92" y2="642.92"/><line style="stroke:#181818;stroke-width:1.0;" x1="749.5" x2="749.5" y1="642.92" y2="655.92"/><line style="stroke:#181818;stroke-width:1.0;" x1="708.5" x2="749.5" y1="655.92" y2="655.92"/><polygon fill="#181818" points="718.5,651.92,708.5,655.92,718.5,659.92,714.5,655.92" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="105" x="714.5" y="637.93">processMutation</text><line style="stroke:#181818;stroke-width:1.0;" x1="702.5" x2="749.5" y1="710" y2="710"/><line style="stroke:#181818;stroke-width:1.0;" x1="749.5" x2="749.5" y1="710" y2="723"/><line style="stroke:#181818;stroke-width:1.0;" x1="708.5" x2="749.5" y1="723" y2="723"/><polygon fill="#181818" points="718.5,719,708.5,723,718.5,727,714.5,723" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="28" x="714.5" y="705.01">emit</text><polygon fill="#181818" points="274,753.08,264,757.08,274,761.08,270,757.08" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="268" x2="696.5" y1="757.08" y2="757.08"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="133" x="280" y="752.09">wrappedMutationEmit</text><polygon fill="#181818" points="37,782.16,27,786.16,37,790.16,33,786.16" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="31" x2="257" y1="786.16" y2="786.16"/><text fill="#000000" font-family="D2Coding" font-size="13" lengthAdjust="spacing" textLength="203" x="43" y="781.17">EventType.IncrementalSnapshot</text><!--MD5=[0903f22ad4d1af51c47c87bc26f1831b]
@startuml record

skinparam defaultFontName D2Coding

participant user

box "rrweb"
participant "record/index.ts" as record
participant "record/observer.ts" as observer
participant "record/mutation.ts" as mutation
participant MutationBuffer
end box

box "rrweb-snapshot"
participant "snapshot.ts" as snapshot
end box

participant MutationObserver

user -> record: record
activate record

record -> record: takeFullSnapshot
activate record
record - -> user: Event.Meta
  record -> snapshot: snapshot(window.document)
  activate snapshot
    snapshot -> snapshot: serializeNodeWithId
    activate snapshot
      snapshot -> snapshot: serializeNode
      activate snapshot
      deactivate snapshot
    deactivate snapshot
  snapshot - -> record: node
  deactivate snapshot
record - -> user: EventType.FullSnapshot
deactivate record

record -> record: observe
activate record
  record -> observer: initObservers
  activate observer
    observer -> observer: initMutationObserver
    activate observer
      observer -> MutationBuffer**
      observer -> MutationObserver**: MutationBuffer
      observer -> MutationObserver: observer
    deactivate observer
  deactivate observer
deactivate record

deactivate record

MutationObserver - -> MutationBuffer: processMutations
activate MutationBuffer
  MutationBuffer -> MutationBuffer: processMutation
  activate MutationBuffer
  deactivate MutationBuffer

  MutationBuffer -> MutationBuffer: emit
  activate MutationBuffer
    MutationBuffer - -> record: wrappedMutationEmit
    activate record
    record - -> user: EventType.IncrementalSnapshot
    deactivate record
  deactivate MutationBuffer
deactivate MutationBuffer

@enduml

PlantUML version 1.2022.7(Tue Aug 23 02:01:30 KST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ko
Country: KR
--></g></svg>