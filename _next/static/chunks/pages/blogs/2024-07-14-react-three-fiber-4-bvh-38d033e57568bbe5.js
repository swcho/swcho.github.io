(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6694],{25450:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/blogs/2024-07-14-react-three-fiber-4-bvh",function(){return t(54722)}])},49034:(e,r,t)=>{"use strict";t.d(r,{A:()=>m});var n=t(18153),i=t(77328),l=t.n(i),a=t(14232);let o=a.memo(()=>(0,n.Y)(n.FK,{}));var c=t(71745),s=t(48230),h=t.n(s);let d=[{link:"/",text:"Home"}],u=a.memo(()=>{let e=(0,c.useRouter)(),[r,t]=a.useState(!1);return(0,n.FD)("nav",{className:"w-full",children:[(0,n.Y)("div",{id:"progress",className:"top-0 z-20 h-1",style:{background:"linear-gradient(to right, #4dc0b5 var(--scroll), transparent 0)"}}),(0,n.FD)("div",{className:"flex flex-wrap items-center justify-between w-full py-3 mx-auto mt-0 md:max-w-4xl",children:[(0,n.Y)("div",{className:"pl-4",children:(0,n.Y)(h(),{legacyBehavior:!0,className:"text-xl font-extrabold text-gray-900 no-underline hover:no-underline",href:"/",children:"lifetime trails"})}),(0,n.Y)("div",{className:"block pr-4 lg:hidden",children:(0,n.Y)("button",{id:"nav-toggle",type:"button",className:"flex items-center px-3 py-2 text-gray-500 appearance-none hover:text-gray-900 hover:border-teal-500 focus:outline-none",onMouseDown:e=>e.preventDefault(),onClick:()=>t(!r),onBlur:()=>t(!1),children:(0,n.FD)("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.Y)("title",{children:"Menu"}),(0,n.Y)("path",{d:"M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"})]})})}),(0,n.Y)("div",{id:"nav-content",className:"bg-gray-100 border-b flex-grow lg:border-none lg:flex lg:items-center lg:mt-0 lg:shadow-none lg:w-auto md:bg-transparent mt-2 shadow w-full z-20 ".concat(r?"block":"hidden"),children:(0,n.Y)("ul",{className:"items-center justify-end flex-1 list-reset lg:flex",children:d.map(r=>{let{link:t,text:i}=r;return(0,n.Y)("li",{className:"mr-3",children:(0,n.Y)(h(),{legacyBehavior:!0,className:e.pathname===t?"inline-block py-2 px-4 text-gray-900 font-bold no-underline":"inline-block text-gray-600 no-underline hover:text-gray-900 hover:text-underline py-2 px-4",href:t,children:i})},t)})})})]})]})}),m=a.memo(e=>{let{children:r,title:t="This is the default title"}=e;return(0,n.FD)("div",{className:"leading-normal tracking-normal bg-gray-100 min-h-screen",children:[(0,n.FD)(l(),{children:[(0,n.Y)("title",{children:t}),(0,n.Y)("meta",{charSet:"utf-8"}),(0,n.Y)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,n.Y)(u,{}),(0,n.Y)("div",{className:"container w-full px-4 pb-10 mx-auto md:max-w-3xl",children:r}),(0,n.Y)(o,{})]})})},54722:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>et,meta:()=>$});var n=t(37876),i=t(91668);let l={src:"/_next/static/media/image.c56913a3.png",height:312,width:182,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAICAMAAAAGL8UJAAAAIVBMVEUfHyQXHihtEkuHGCBXGyJJHSRDHiFuGSAPFWEdHD9UFFHi7r3tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAKklEQVR4nC3KyQ2AMAwAMDdH07L/wEiInx9mnYWOZmfkNvNM6c8qiv+4vAypAH5sgRtKAAAAAElFTkSuQmCC",blurWidth:5,blurHeight:8};var a=t(91013),o=t(18153),c=t(14796),s=t(73531),h=t(49082),d=t(45302),u=t(71804),m=t(14232);let f=new c.Raycaster,g=new c.Vector3,y=new c.Vector3,x=new c.CylinderGeometry(.02,.02),p=new c.SphereGeometry(.25,20,20),w=new c.MeshBasicMaterial({color:"yellow",wireframe:!0}),Y=new c.MeshBasicMaterial({color:"red",wireframe:!0}),v=new c.MeshBasicMaterial({color:"blue",wireframe:!0});function A(e){let{}=e,r=m.useRef(null),t=m.useRef(null),n=m.useRef(null),i=m.useRef(null);return m.useEffect(()=>{t.current.position.set(5,0,0)},[]),(0,u.D)((e,t)=>{let n=r.current;n.rotation.y+=4*t,f.set(g,y),f.firstHitOnly=!0}),(0,o.FD)("group",{ref:r,children:[(0,o.Y)("mesh",{ref:t,geometry:p,material:w}),(0,o.Y)("mesh",{ref:n,geometry:p,material:Y}),(0,o.Y)("mesh",{ref:i,geometry:x,material:v})]})}function b(e){let r=m.useRef(null);return(0,o.Y)(o.FK,{children:(0,o.Y)("group",{ref:r,...e,children:Array.from({length:1},(e,t)=>(0,o.Y)(A,{target:r},t))})})}let M=m.memo(function(e){let{}=e;return(0,o.Y)(o.FK,{children:(0,o.FD)(d.Hl,{"camera-position-z":20,"camera-far":100,style:{height:"30vh",marginBottom:"2rem"},children:[(0,o.Y)("ambientLight",{intensity:Math.PI}),(0,o.Y)("pointLight",{decay:0,position:[10,10,5]}),(0,o.Y)("spotLight",{position:[10,10,10],angle:.15,penumbra:1,decay:0,intensity:Math.PI}),(0,o.Y)("color",{attach:"background",args:["#202025"]}),(0,o.Y)(s.Z,{children:(0,o.Y)(b,{})}),(0,o.Y)(h.N,{})]})})});var j=t(92015),F=t(33191);let B=new c.Raycaster,H=new c.Vector3,N=new c.Vector3,R=new c.CylinderGeometry(.02,.02),D=new c.SphereGeometry(.25,10,10),V=new c.MeshBasicMaterial({color:"yellow",wireframe:!0}),k=new c.MeshBasicMaterial({color:"red",wireframe:!0}),E=new c.MeshBasicMaterial({color:"blue",wireframe:!0});function C(e){let{target:r}=e,t=m.useRef(null),n=m.useRef(null),i=m.useRef(null),l=m.useRef(null),a=m.useRef(null);m.useEffect(()=>{n.current.position.set(5,0,0)},[]);let[c,s]=m.useState("");return(0,u.D)((e,i)=>{let o=t.current;o.rotation.y+=i,H.setFromMatrixPosition(n.current.matrixWorld),N.copy(H).multiplyScalar(-1).normalize(),B.set(H,N),B.firstHitOnly=!0;let c=B.intersectObject(r.current,!0)[0],h=c?c.distance:5;s("(".concat(H.x.toFixed(),", ").concat(H.y.toFixed(),", ").concat(H.z.toFixed(),") (").concat(N.x.toFixed(),", ").concat(N.y.toFixed(),", ").concat(N.z.toFixed(),") ").concat(h.toFixed(2))),l.current.position.setX(5-h),a.current.position.setX(5-h+h/2),a.current.rotation.set(0,0,Math.PI/2),a.current.scale.set(1,h,1)}),(0,o.FD)("group",{ref:t,children:[(0,o.Y)("mesh",{ref:n,geometry:D,material:V,children:(0,o.Y)(j.Q,{children:(0,o.Y)(F.E,{position:[0,-1,0],ref:i,fontSize:.5,children:c})})}),(0,o.Y)("mesh",{ref:l,geometry:D,material:k}),(0,o.Y)("mesh",{ref:a,geometry:R,material:E})]})}function G(e){let r=m.useRef(null);return(0,o.FD)(o.FK,{children:[(0,o.Y)("group",{ref:r,...e}),Array.from({length:1},(e,t)=>(0,o.Y)(C,{target:r},t))]})}let _=m.memo(function(e){let{}=e;return(0,o.Y)(o.FK,{children:(0,o.FD)(d.Hl,{"camera-far":100,camera:{position:[0,0,7]},style:{height:"30vh",marginBottom:"2rem"},children:[(0,o.Y)("color",{attach:"background",args:["#202025"]}),(0,o.Y)(s.Z,{children:(0,o.Y)(G,{children:(0,o.FD)("mesh",{children:[(0,o.Y)("sphereGeometry",{args:[1,10,10]}),(0,o.Y)("meshBasicMaterial",{color:65280,wireframe:!0})]})})})]})})});var z=t(31861),P=t(56699),S=t(28724);let K=new c.Raycaster,O=new c.Vector3,I=new c.Vector3,U=new c.CylinderGeometry(.02,.02),W=new c.SphereGeometry(.25,20,20),X=new c.MeshBasicMaterial({color:"yellow"}),L=new c.MeshBasicMaterial({color:"red"}),T=new c.MeshBasicMaterial({transparent:!0,opacity:.25});function J(e){let{target:r}=e,t=m.useRef(null),n=m.useRef(null),i=m.useRef(null),l=m.useRef(null);m.useEffect(()=>{i.current.scale.multiplyScalar(.5),n.current.position.set(25,0,0),t.current.rotation.x=10*Math.random(),t.current.rotation.y=10*Math.random()},[]);let a=Math.random()-.5,c=Math.random()-.5;return(0,u.D)((e,o)=>{let s=t.current;s.rotation.x+=a*o,s.rotation.y+=c*o,n.current.updateMatrixWorld(),O.setFromMatrixPosition(n.current.matrixWorld),I.copy(O).multiplyScalar(-1).normalize(),K.set(O,I),K.firstHitOnly=!0;let h=K.intersectObject(r.current,!0),d=h.length?h[0].distance:25;i.current.position.set(25-d,0,0),l.current.position.set(25-d/2,0,0),l.current.scale.set(1,d,1),l.current.rotation.z=Math.PI/2}),(0,o.FD)("group",{ref:t,children:[(0,o.Y)("mesh",{ref:n,geometry:W,material:X}),(0,o.Y)("mesh",{ref:i,geometry:W,material:L}),(0,o.Y)("mesh",{ref:l,geometry:U,material:T})]})}function Q(e){let r=m.useRef(null),{count:t}=(0,z._5)({count:{value:100,min:0,max:500}});return(0,o.FD)(o.FK,{children:[(0,o.Y)("group",{ref:r,...e}),Array.from({length:t},(e,t)=>(0,o.Y)(J,{target:r},t))]})}function Z(e){let r=m.useRef(null),t=m.useRef(null);return(0,S._)(r,P.e),(0,u.D)((e,t)=>r.current.rotation.x=r.current.rotation.y+=t),(0,o.FD)("mesh",{ref:r,...e,onPointerMove:e=>t.current.position.copy(r.current.worldToLocal(e.point)),onPointerOver:()=>t.current.visible=!0,onPointerOut:()=>t.current.visible=!1,children:[(0,o.Y)("torusKnotGeometry",{args:[1,.4,200,50]}),(0,o.Y)("meshNormalMaterial",{}),(0,o.FD)("mesh",{raycast:()=>null,ref:t,visible:!1,children:[(0,o.Y)("sphereGeometry",{args:[.2]}),(0,o.Y)("meshBasicMaterial",{color:"orange",toneMapped:!1})]})]})}let q=m.memo(function(e){let{}=e,{enabled:r}=(0,z._5)({enabled:!0});return(0,o.Y)(o.FK,{children:(0,o.FD)(d.Hl,{"camera-position-z":40,"camera-far":100,style:{height:"30vh",marginBottom:"1rem"},children:[(0,o.Y)("color",{attach:"background",args:["#202025"]}),(0,o.Y)(s.Z,{firstHitOnly:!0,enabled:r,children:(0,o.Y)(Q,{children:(0,o.Y)(Z,{})})}),(0,o.Y)(h.N,{})]})})}),$={title:"react-three-fiber: Bounding Volume Hierarchy",description:"BVH(Bounding Volume Hierarchy) 예제를 살펴 봅니다.",date:"2024-07-14",readTime:5},ee=e=>{let{children:r}=e;return(0,n.jsx)(a.A,{meta:$,children:r})};function er(e){let r={a:"a",code:"code",h1:"h1",img:"img",p:"p",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{children:"BVH(Bounding Volume Hierarchy)"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"<Ray />"})," 컴포넌트는 실린더(",(0,n.jsx)(r.code,{children:"CylinderGeometry"}),") 하나와 구체(SphereGeometry) 2개를 가집니다."]}),"\n",(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,n.jsx)("div",{style:{width:"50px"},children:(0,n.jsx)(r.img,{alt:"alt text",src:l})})}),"\n",(0,n.jsx)(r.p,{children:"그림과 같이 실린더는 파란색, 구체는 파란색으로 표시 했습니다."}),"\n",(0,n.jsx)(M,{}),"\n",(0,n.jsxs)(r.p,{children:["조금더 알아보기 쉽게 ",(0,n.jsx)(r.code,{children:"origMesh"})," 객체는 노란색, ",(0,n.jsx)(r.code,{children:"hitMesh"})," 객체는 빨간색, ",(0,n.jsx)(r.code,{children:"cylinderMesh"}),"는 파란색으로 표시했습니다."]}),"\n",(0,n.jsx)(_,{}),"\n",(0,n.jsx)(r.p,{children:"이제 가운데에 반지름을 1로하는 초록색의 구체를 놓아 봅니다."}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"Raycaster"}),"는 기준 점과 방향을 가리키는 단위 벡터를 지정해 주면 기준점으로 부터 시작하여 특정 방향으로 가상의 선을 그엇을 때 충돌하는 객체를 찾을 수 있습니다."]}),"\n",(0,n.jsxs)(r.p,{children:["노란색의 ",(0,n.jsx)(r.code,{children:"origMesh"}),"로 부터 중심이 되는 방향으로 raycast를 합니다. 이 때 ",(0,n.jsx)(r.code,{children:"intersectObject"})," 함수를 사용하여 특정 mesh와의 교차 지점을 알아 낼 수 있습니다."]}),"\n",(0,n.jsxs)(r.p,{children:["이를 통해 ",(0,n.jsx)(r.code,{children:"origMesh"}),"로 부터 중심의 구체와 충돌하는 지점을 빨간색의 ",(0,n.jsx)(r.code,{children:"hitMesh"})," 구체와 파란색의 ",(0,n.jsx)(r.code,{children:"cylinderMesh"})," 선으로 표시를 할 수 있습니다."]}),"\n",(0,n.jsx)(q,{}),"\n",(0,n.jsx)(r.p,{children:"이제 초록색 구체 대신 복잡한 모양의 torus를 배치하고 노란색 구체를 렌덤하게 회전해 주면 원본 프로젝트와 같은 동작을 하게 됩니다."}),"\n",(0,n.jsx)(r.p,{children:"사실 이 예제는 raycast 보다는 BVH(Bounding Volume Hierarchy)를 사용한 raycast의 성능향상을 보여주기 위한 것 입니다."}),"\n",(0,n.jsx)(r.p,{children:"자세한 내용은 아래에서 찾아 볼 수 있습니다."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://wjdgh283.tistory.com/entry/BVHBounding-Volume-Hierarchy",children:"BVH(Bounding Volume Hierarchy)"})}),"\n",(0,n.jsx)(r.h1,{children:"원본 코드"}),"\n",(0,n.jsx)("iframe",{style:{width:"100%",height:900,outline:"1px solid #252525",border:0,borderRadius:8,marginBottom:16,zIndex:100},src:"https://codesandbox.io/s/txzeq8"})]})}function et(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.jsx)(ee,{...e,children:(0,n.jsx)(er,{...e})})}},60158:(e,r,t)=>{"use strict";t.d(r,{J:()=>o,j:()=>a});var n=t(18153),i=t(14232);let l=i.createContext({});function a(e){let{staticProps:r,children:t}=e;return(0,n.Y)(l.Provider,{value:r,children:t})}function o(){return i.useContext(l)}},85419:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var n=t(18153);t(14232);let i=e=>{let{meta:r,isBlogPost:t}=e;return(0,n.FD)(n.FK,{children:[(0,n.Y)("h1",{className:"font-bold text-gray-800 mb-4 ".concat(t?"text-5xl mt-8 mb-8":"text-lg"),children:r.title}),(0,n.FD)("div",{className:"details",children:[(0,n.Y)("p",{className:"text-gray-500",children:r.description}),(0,n.Y)("p",{className:"text-gray-400 text-right -mt-1",children:(0,n.Y)("span",{className:"mr-4",children:r.date})})]})]})}},91013:(e,r,t)=>{"use strict";t.d(r,{A:()=>d});var n=t(18153),i=t(73146),l=t.n(i),a=t(14232),o=t(86089),c=t(60158),s=t(85419),h=t(49034);function d(e){let{children:r,meta:t,staticProps:i}=e;return a.useEffect(()=>{l().highlightAll()},[]),(0,n.Y)(n.FK,{children:(0,n.FD)(h.A,{title:t.title,children:[(0,n.Y)(s.A,{meta:t,isBlogPost:!0}),(0,n.Y)(c.j,{staticProps:i,children:(0,n.Y)("article",{className:"markdown",children:r})}),(0,n.Y)(o.Ay,{repo:"swcho/blog-comments",type:"pathname",label:"utterances",theme:"github-light"})]})})}}},e=>{e.O(0,[7391,683,5037,5695,5302,2077,41,5003,1861,6985,636,6593,8792],()=>e(e.s=25450)),_N_E=e.O()}]);
//# sourceMappingURL=2024-07-14-react-three-fiber-4-bvh-38d033e57568bbe5.js.map