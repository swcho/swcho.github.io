(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8068],{3717:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},10186:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/blogs/2024-05-19-remark-1",function(){return t(83314)}])},49034:(e,r,t)=>{"use strict";t.d(r,{A:()=>p});var n=t(18153),i=t(77328),s=t.n(i),o=t(14232);let c=o.memo(()=>(0,n.Y)(n.FK,{}));var l=t(71745),a=t(48230),d=t.n(a);let u=[{link:"/",text:"Home"}],h=o.memo(()=>{let e=(0,l.useRouter)(),[r,t]=o.useState(!1);return(0,n.FD)("nav",{className:"w-full",children:[(0,n.Y)("div",{id:"progress",className:"top-0 z-20 h-1",style:{background:"linear-gradient(to right, #4dc0b5 var(--scroll), transparent 0)"}}),(0,n.FD)("div",{className:"flex flex-wrap items-center justify-between w-full py-3 mx-auto mt-0 md:max-w-4xl",children:[(0,n.Y)("div",{className:"pl-4",children:(0,n.Y)(d(),{legacyBehavior:!0,className:"text-xl font-extrabold text-gray-900 no-underline hover:no-underline",href:"/",children:"lifetime trails"})}),(0,n.Y)("div",{className:"block pr-4 lg:hidden",children:(0,n.Y)("button",{id:"nav-toggle",type:"button",className:"flex items-center px-3 py-2 text-gray-500 appearance-none hover:text-gray-900 hover:border-teal-500 focus:outline-none",onMouseDown:e=>e.preventDefault(),onClick:()=>t(!r),onBlur:()=>t(!1),children:(0,n.FD)("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.Y)("title",{children:"Menu"}),(0,n.Y)("path",{d:"M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"})]})})}),(0,n.Y)("div",{id:"nav-content",className:"bg-gray-100 border-b flex-grow lg:border-none lg:flex lg:items-center lg:mt-0 lg:shadow-none lg:w-auto md:bg-transparent mt-2 shadow w-full z-20 ".concat(r?"block":"hidden"),children:(0,n.Y)("ul",{className:"items-center justify-end flex-1 list-reset lg:flex",children:u.map(r=>{let{link:t,text:i}=r;return(0,n.Y)("li",{className:"mr-3",children:(0,n.Y)(d(),{legacyBehavior:!0,className:e.pathname===t?"inline-block py-2 px-4 text-gray-900 font-bold no-underline":"inline-block text-gray-600 no-underline hover:text-gray-900 hover:text-underline py-2 px-4",href:t,children:i})},t)})})})]})]})}),p=o.memo(e=>{let{children:r,title:t="This is the default title"}=e;return(0,n.FD)("div",{className:"leading-normal tracking-normal bg-gray-100 min-h-screen",children:[(0,n.FD)(s(),{children:[(0,n.Y)("title",{children:t}),(0,n.Y)("meta",{charSet:"utf-8"}),(0,n.Y)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,n.Y)(h,{}),(0,n.Y)("div",{className:"container w-full px-4 pb-10 mx-auto md:max-w-3xl",children:r}),(0,n.Y)(c,{})]})})},56486:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.identifierTypes=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}}return r.default=e,r}(t(14232)),i=function(e){return e&&e.__esModule?e:{default:e}}(t(95062));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,r){return(c=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}var l=["pathname","url","title","og:title","issue-number","issue-term"],a=function(e,r,t){if(0>l.indexOf(e))return void console.warn("Wrong type: "+e);if("pathname"===e)return"pathname";if("url"===e)return"url";if("title"===e)return"title";if("og:title"===e)return"og:title";if("issue-term"===e)return r;else if("issue-number"===e)return t},d=function(e){var r;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e){var r,i;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");return(r=(i=o(t).call(this,e))&&("object"===s(i)||"function"==typeof i)?i:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this)).myRef=n.default.createRef(),r.state={pending:!0},r}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e),r=[{key:"componentDidMount",value:function(){var e=this,r=this.props,t=r.repo,n=r.type,i=r.specificTerm,s=r.issueNumber,o=0>l.indexOf(n)?void console.warn("Wrong type: "+n):"issue-number"===n?"issue-number":"issue-term",c=a(n,i,s);if("issue-term"===n&&!c)return void console.warn("When type is '".concat(n,"', 'specificTerm' prop must be provided"));if("issue-number"===n&&(isNaN(c)||c<1))return void console.warn("When type is '".concat(n,"', valid 'issueNumber' prop must be provided"));var d=document.createElement("script");d.src="https://utteranc.es/client.js",d.async=!0,d.setAttribute("repo",t),d.setAttribute("crossorigin","anonymous"),d.setAttribute(o,c),d.onload=function(){return e.setState({pending:!1})},this.myRef.current.appendChild(d)}},{key:"render",value:function(){return n.default.createElement("div",{className:"react-utterences",ref:this.myRef},this.props.debug&&n.default.createElement("pre",{style:{background:"#cccccc",padding:10}},"\nthis.props: ".concat(JSON.stringify(this.props,null,2),'\nlocation.pathname: "').concat(window.location.pathname,'"\nlocation.href: "').concat(window.location.href,'"\n          ').trim()),this.props.debug&&n.default.createElement("div",null,"\uD83D\uDC47\uD83D\uDC47If the settings are valid, the comment widget appear below\uD83D\uDC47\uD83D\uDC47"),this.state.pending&&n.default.createElement("div",null,"Loading script..."))}}],function(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),t}(n.Component);r.identifierTypes={pathname:{attrValue:"",summary:"Issue title contains page pathname"},url:{attrValue:"url",summary:"Issue title contains page URL"},title:{attrValue:"title",summary:"Issue title contains page title"},"og:title":{attrValue:"og:title",summary:"Issue title contains page og:title"},"issue-number":{attrValue:-1,summary:"Specific issue number"},"issue-term":{attrValue:"",summary:"Issue title contains specific term"}},d.propTypes={type:i.default.string.isRequired,repo:i.default.string.isRequired,specificTerm:i.default.string,issueNumber:i.default.number,hashKey:i.default.string,debug:i.default.bool},r.default=d},60158:(e,r,t)=>{"use strict";t.d(r,{J:()=>c,j:()=>o});var n=t(18153),i=t(14232);let s=i.createContext({});function o(e){let{staticProps:r,children:t}=e;return(0,n.Y)(s.Provider,{value:r,children:t})}function c(){return i.useContext(s)}},79706:(e,r,t)=>{"use strict";var n=t(3717);function i(){}function s(){}s.resetWarningCache=i,e.exports=function(){function e(e,r,t,i,s,o){if(o!==n){var c=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}function r(){return e}e.isRequired=e;var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,elementType:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:s,resetWarningCache:i};return t.PropTypes=t,t}},83314:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>h,meta:()=>a});var n=t(37876),i=t(91668);let s={src:"/_next/static/media/image.a0887b11.png",height:900,width:2560,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAABlBMVEVdil99fWj4ngDzAAAAAnRSTlMGDsdxR7kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAWSURBVHicY2BgYGRkZIAABIuBkYEBAACKAAhy7AQCAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:3},o={src:"/_next/static/media/dependencies.758273d1.svg",height:554,width:661,blurWidth:0,blurHeight:0},c={src:"/_next/static/media/toMarkdown.341025b9.svg",height:322,width:763,blurWidth:0,blurHeight:0};var l=t(91013);let a={title:"remark.js",description:"MDX 생태계의 중심에 있는 remark.js를 소개하고 분석해 봅니다.",date:"2024-05-19",readTime:5},d=e=>{let{children:r}=e;return(0,n.jsx)(l.A,{meta:a,children:r})};function u(e){let r={a:"a",code:"code",h1:"h1",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{children:"소개"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.a,{href:"https://remark.js.org/",children:"remark"}),"는 markdown을 처리하는 파서 및 생성기 입니다.\nmarkdown을 처리할 수 있는 라이브러리는 많이 있습니다.\n특별히 ",(0,n.jsx)(r.code,{children:"markdown-it"}),"과 ",(0,n.jsx)(r.code,{children:"marked"}),"는 매우 오랜 시간 주목을 받아왔고 사용처도 늘어나고 있습니다."]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.img,{alt:"alt text",src:s}),"\nhttps://npmtrends.com/markdown-it-vs-marked-vs-remark"]}),"\n",(0,n.jsx)(r.p,{children:"그럼에도 불구하고 remark에 주목을 해야 하는 이유는 mdx 툴체인의 코어 라이브러리이기 때문입니다.\n사양을 주도하고 에코시스템을 만들어가는 주요 개발자들이 다음과 같이 유사합니다."}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"https://github.com/orgs/unifiedjs/people"}),"\n",(0,n.jsx)(r.li,{children:"https://github.com/orgs/remarkjs/people"}),"\n",(0,n.jsx)(r.li,{children:"https://github.com/orgs/mdx-js/people"}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.a,{href:"https://unifiedjs.com/",children:(0,n.jsx)(r.code,{children:"unified"})}),"라는 패키지는 general purpose parser/generator를 표방합니다.\n그 위에 ",(0,n.jsx)(r.a,{href:"https://remark.js.org/",children:(0,n.jsx)(r.code,{children:"remark"})}),"가 markdown 파일을 처리하는 핵심 라이브러리와 플러그인 구조를 제공합니다. 다시 그 위에 ",(0,n.jsx)(r.a,{href:"https://mdxjs.com/",children:(0,n.jsx)(r.code,{children:"MDX"})}),"라는 markdown과 jsx를 결합한 형식을 제공하고 있습니다."]}),"\n",(0,n.jsxs)(r.p,{children:["지금 이 글을 작성하는 방식도 mdx이고 ",(0,n.jsx)(r.a,{href:"https://nextjs.org/docs/pages/building-your-application/configuring/mdx",children:"Markdown and MDX"}),"와 같이 next.js에서 또는 ",(0,n.jsx)(r.a,{href:"https://storybook.js.org/docs/writing-docs/mdx/",children:"MDX • Storybook docs"}),"와 같이 storybook에서도 사용할 수 있는 보편적인 형식이 되었습니다."]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"MDX"})," 처리에 있어 핵심이 되는 플러그인 구조를 제공하는 remark를 이해하는 것은 에코시스템의 활용과 확장의 측면에서 의미가 있을 것이라 생각합니다."]}),"\n",(0,n.jsx)(r.h1,{children:"기술 스택"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"tsconfig.json"}),"을 사용하지만 ts 파일 대신 js 파일에서 주석을 기반으로 형검사를 수행합니다."]}),"\n",(0,n.jsxs)(r.p,{children:["다음은 ",(0,n.jsx)(r.code,{children:"remark"}),"의 의존 관계 다이어그램 입니다."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"",src:o})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"unified"})," 패키지를 기반으로 ",(0,n.jsx)(r.code,{children:"micromark"})," 패키지군을 사용하여 ",(0,n.jsx)(r.code,{children:"mdx"})," 파일을 파싱하고 ",(0,n.jsx)(r.code,{children:"mdast-util-to-markdown"})," 패키지를 사용하여 파싱한 결과인 markdown ast 정보를 바탕으로 html을 생성합니다."]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"remark"}),"는 다음과 같이 단 한줄의 코드로되어 있습니다."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"// Note: types exposed from `index.d.ts`\nimport remarkParse from 'remark-parse';\nimport remarkStringify from 'remark-stringify';\nimport { unified } from 'unified';\n\n/**\n * Create a new unified processor that already uses `remark-parse` and\n * `remark-stringify`.\n */\nexport const remark = unified().use(remarkParse).use(remarkStringify).freeze();\n"})}),"\n",(0,n.jsxs)(r.p,{children:["물론 ",(0,n.jsx)(r.code,{children:"remark"})," 소스코드는 monorepo로되어 있어 ",(0,n.jsx)(r.code,{children:"remark-parse"}),", ",(0,n.jsx)(r.code,{children:"remark-stringify"}),"와 같은 패키지를 사용하여 AST를 만들고 다시 텍스트로 출력하는 일련의 코드가 존재 합니다."]}),"\n",(0,n.jsxs)(r.p,{children:["위의 코드를 이해하려면 ",(0,n.jsx)(r.code,{children:"unified"}),"의 동작 방식을 이해할 필요가 있습니다."]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"unified()"}),"를 호출하는 리턴 값은 ",(0,n.jsx)(r.code,{children:"Processor"}),"라는 클래스의 인스턴스 입니다."]}),"\n",(0,n.jsxs)(r.p,{children:["이 ",(0,n.jsx)(r.code,{children:"Processor"}),"는 ",(0,n.jsx)(r.code,{children:"use"}),", ",(0,n.jsx)(r.code,{children:"freeze"}),", ",(0,n.jsx)(r.code,{children:"process"})," 등의 API를 제공합니다."]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"Processor"}),"는 다음과 같은 일종의 가상함수를 가집니다."]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"parser"}),": ",(0,n.jsx)(r.code,{children:"string"})," 입력을 받아 tokenize한 ",(0,n.jsx)(r.code,{children:"ParseTree"}),"를 반환합니다. ",(0,n.jsx)(r.code,{children:"remark-parse"}),"에 해당 구현이 있습니다."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"compiler"}),": ",(0,n.jsx)(r.code,{children:"parser"}),"에서 전달한 ",(0,n.jsx)(r.code,{children:"ParseTree"}),"를 바탕으로 새로운 형식으로 출력합니다."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"transformer"}),": ",(0,n.jsx)(r.code,{children:"ParseTree"}),"를 전달 받아 이를 조작합니다."]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["정리하면 ",(0,n.jsx)(r.code,{children:"unified()"}),"의 call chain을 통해 parser, compiler, transformer를 조합할 수 있습니다.\n이 후 ",(0,n.jsx)(r.code,{children:"process"})," 함수를 호출하면 parer로 부터 ",(0,n.jsx)(r.code,{children:"ParseTree"}),"를 생성하여 transformer를 거쳐 compiler에 전달합니다."]}),"\n",(0,n.jsx)(r.h1,{children:"처리과정"}),"\n",(0,n.jsxs)(r.p,{children:["다음은 ",(0,n.jsx)(r.code,{children:"micromark"})," 테스트 코드를 수행했을 때의 과정을 보여줍니다."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"",src:c})}),"\n",(0,n.jsx)(r.p,{children:"입력으로 전달받은 문자열을 tokenizing 합니다.\ntoken 정보는 이벤트 형식으로 전달합니다.\ntoken 이벤트를 기반으로 html을 생성합니다."}),"\n",(0,n.jsx)(r.h1,{children:"마치며"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"remark"})," 스스로는 ",(0,n.jsx)(r.code,{children:"parse"})," API를 통해 markdown의 AST를 생성하고 ",(0,n.jsx)(r.code,{children:"process"})," API를 통해 다시 markdown을 생성하는 역할을 하는 간단한 라이브러리 입니다."]}),"\n",(0,n.jsxs)(r.p,{children:["따라서 실제로 많이 사용하는 패턴은 ",(0,n.jsx)(r.code,{children:"remark-parse"}),"를 사용하여 Markdown AST를 생성하고 다양한 plugin을 조합하여 원하는 출력을 얻어내는 것 입니다."]}),"\n",(0,n.jsxs)(r.p,{children:["대표적으로 ",(0,n.jsx)(r.a,{href:"https://github.com/mdx-js/mdx",children:"mdx-js/mdx"}),"의 경우 ",(0,n.jsx)(r.code,{children:"remark-parse"}),", ",(0,n.jsx)(r.code,{children:"remark-mdx"}),", ",(0,n.jsx)(r.code,{children:"remark-rehype"})," 등의 패키지를 조합하여 ",(0,n.jsx)(r.code,{children:"mdx"})," 형식의 파일을 처리 합니다."]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"@mdx-js/react"}),"라는 패키지를 활용하면 ",(0,n.jsx)(r.code,{children:"@mdx-js/loader"}),"를 사용해 생성한 코드를 custom 컴포넌트와 함께 렌더링할 수 있습니다."]}),"\n",(0,n.jsx)(r.p,{children:"Markdown의 사용은 개발자 커뮤니티에서 부터 시작해서 다양한 분야로 퍼지고 있습니다."}),"\n",(0,n.jsx)(r.p,{children:"많은 문서 형식들이 존재해 왔지만 결국에는 그 자체로 읽기가능하고 포팅이 쉬운 방식을 사람들이 선택하고 있습니다.\n마치 xml을 json이 대체하 듯이 evernote, notion 등의 proprietary 포멧이 아닌 defacto 문서 형식으로 markdown을 사용하고 있습니다."}),"\n",(0,n.jsx)(r.p,{children:"이런 markdown을 손쉽게 확장함으로서 유연성을 제공하는 mdx 형식과 그 생태계를 주목하고 관련 기술을 습득해 둠으로서 각자의 분야에서 새로운 아이디어를 이끌어내는 재료가 되리라 생각합니다."}),"\n",(0,n.jsxs)(r.p,{children:["개인적으로 ",(0,n.jsx)(r.code,{children:"unified"}),"의 생태계를 이해하고 분석하는 것이 쉽지는 않았습니다.\n워낙 많은 패키지에 걸쳐 기능이 구현되어 있고 js에 주석기반의 type checking을 하는 코드를 이해하는데 시간이 필요했습니다.\n함수형 기반으로 작성하다보니 higher order function이 많았고 이를 트레이스하고 분석하는 것 역시 지루하고 고된 작업이였습니다.\n덕분에 포스팅 작성이 오래 걸렸지만 한편으로는 후련하네요. ㅎ"]})]})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.jsx)(d,{...e,children:(0,n.jsx)(u,{...e})})}},85419:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var n=t(18153);t(14232);let i=e=>{let{meta:r,isBlogPost:t}=e;return(0,n.FD)(n.FK,{children:[(0,n.Y)("h1",{className:"font-bold text-gray-800 mb-4 ".concat(t?"text-5xl mt-8 mb-8":"text-lg"),children:r.title}),(0,n.FD)("div",{className:"details",children:[(0,n.Y)("p",{className:"text-gray-500",children:r.description}),(0,n.Y)("p",{className:"text-gray-400 text-right -mt-1",children:(0,n.Y)("span",{className:"mr-4",children:r.date})})]})]})}},86089:(e,r,t)=>{"use strict";Object.defineProperty(r,"Ay",{enumerable:!0,get:function(){return n.default}});var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}}return r.default=e,r}(t(56486))},91013:(e,r,t)=>{"use strict";t.d(r,{A:()=>u});var n=t(18153),i=t(73146),s=t.n(i),o=t(14232),c=t(86089),l=t(60158),a=t(85419),d=t(49034);function u(e){let{children:r,meta:t,staticProps:i}=e;return o.useEffect(()=>{s().highlightAll()},[]),(0,n.Y)(n.FK,{children:(0,n.FD)(d.A,{title:t.title,children:[(0,n.Y)(a.A,{meta:t,isBlogPost:!0}),(0,n.Y)(l.j,{staticProps:i,children:(0,n.Y)("article",{className:"markdown",children:r})}),(0,n.Y)(c.Ay,{repo:"swcho/blog-comments",type:"pathname",label:"utterances",theme:"github-light"})]})})}},95062:(e,r,t)=>{e.exports=t(79706)()}},e=>{e.O(0,[5695,636,6593,8792],()=>e(e.s=10186)),_N_E=e.O()}]);
//# sourceMappingURL=2024-05-19-remark-1-430428c980211077.js.map