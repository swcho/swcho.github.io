(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9617],{3717:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},18489:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l,meta:()=>o});var r=t(37876),s=t(91668),i=t(91013);let o={title:"Web studio part 3",description:"Web studio의 작성 기능을 구조적으로 살펴 봅니다.",date:"2023-09-24",readTime:5},c=e=>{let{children:n}=e;return(0,r.jsx)(i.A,{meta:o,children:n})};function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{children:"Tech stack"}),"\n",(0,r.jsx)(n.h2,{children:(0,r.jsx)(n.a,{href:"https://lexical.dev/",children:"Lexical"})}),"\n",(0,r.jsx)(n.p,{children:"Meta(Facebook)에서 만든 오픈소스 텍스트 에디터 입니다.\nReact 기반으로 확장이 용이한 구조로 되어 있습니다.\nPlugin 방식의 확장을 위해 별도의 구조를 잡지 않고 React의 context를 사용하여 child node에서 plugin 컴포넌트를 추가하는 방식을 사용하고 있습니다."}),"\n",(0,r.jsx)(n.h1,{children:"builder & canvas"}),"\n",(0,r.jsx)(n.p,{children:"Builder는 canvas 영역을 포함하는 전체 작성 화면을 말합니다."}),"\n",(0,r.jsx)(n.p,{children:"canvas는 Iframe으로 되어 있기 때문에 root window와 iframe window 사이에 데이터 동기화가 필요합니다."}),"\n",(0,r.jsx)(n.p,{children:"가령 Builder의 Navigator 영역에서 컴포넌트를 재배치하면 canvas 영역에서도 컴포넌트 재배치가 이루어져야 합니다.\n그리고 그 반대의 동작도 가능해야 합니다."}),"\n",(0,r.jsxs)(n.p,{children:["이러한 기능을 구현한 것이 ",(0,r.jsx)(n.code,{children:"pubsub"})," 입니다."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pubsub"}),"의 설정은 각각 ",(0,r.jsx)(n.code,{children:"useBuildStore"}),", ",(0,r.jsx)(n.code,{children:"useCanvasStore"}),"에서 합니다."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"immerhin"}),"은 이 builder와 canvas의 동기화 과정에서도 store의 변경에따라 publish 하고 이를 subscribe하는 측에서 다시 store 업데이트를 하는데 사용합니다."]}),"\n",(0,r.jsx)(n.h1,{children:"Component tree 생성"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@webstudio-is/react-sdk"})," 패키지는 ",(0,r.jsx)(n.code,{children:"ReactSdkContext"}),"를 통해 렌더링 정보를 공유 합니다."]}),"\n",(0,r.jsxs)(n.p,{children:["컴포넌트 트리의 엘리먼트는 ",(0,r.jsx)(n.code,{children:"Instance"}),"라고 합니다."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export const Instance = z.object({\n  type: z.literal('instance'),\n  id: InstanceId,\n  component: z.string(),\n  label: z.string().optional(),\n  children: z.array(z.union([Id, Text])),\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"component"}),"는 해당 ",(0,r.jsx)(n.code,{children:"Instance"}),"가 어떠한 컴포넌트인지 ",(0,r.jsx)(n.code,{children:"children"}),"은 인스턴스는 그 자식들을 가리킵니다."]}),"\n",(0,r.jsxs)(n.p,{children:["다음은 ",(0,r.jsx)(n.code,{children:"Instance"})," map을 구성하는 예시 입니다."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const instances = new Map([\n  createInstancePair('root', 'Body', [{ type: 'id', value: 'box1' }]),\n  createInstancePair('box1', 'Box', [\n    { type: 'id', value: 'box11' },\n    { type: 'id', value: 'box12' },\n    { type: 'id', value: 'box13' },\n  ]),\n  createInstancePair('box11', 'Box', []),\n  createInstancePair('box12', 'Box', []),\n  createInstancePair('box13', 'Box', []),\n]);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"createElementsTree"}),"는 ",(0,r.jsx)(n.code,{children:"Instance"})," map 정보를 받아 ",(0,r.jsx)(n.code,{children:"ReactSdkContext"}),"를 구성하고 ",(0,r.jsx)(n.code,{children:"Provider"}),"를 제공합니다."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Instance"}),"는 ",(0,r.jsx)(n.code,{children:"WebstudioComponent"}),"에 의해 최종 렌더링 합니다."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"WebstudioComponent"}),"는 high order component로서 ",(0,r.jsx)(n.code,{children:"Instance"}),"가 가리키는 React 컴포넌트를 생성하고, 필요한 props 정보를 반환합니다."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export const WebstudioComponent = forwardRef<HTMLElement, WebstudioComponentProps>(\n  ({ instance, instanceSelector, children, components, ...rest }, ref) => {\n    const { [showAttribute]: show = true, ...instanceProps } = useInstanceProps(instance.id);\n    const props = {\n      ...instanceProps,\n      ...rest,\n      [idAttribute]: instance.id,\n      [componentAttribute]: instance.component,\n    };\n    if (show === false) {\n      return <></>;\n    }\n    const Component = components.get(instance.component);\n    if (Component === undefined) {\n      return <></>;\n    }\n    return (\n      <Component {...props} ref={ref}>\n        {renderWebstudioComponentChildren(children)}\n      </Component>\n    );\n  }\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"createElementsTree"}),"에서 ",(0,r.jsx)(n.code,{children:"Component"})," prop을 통해 ",(0,r.jsx)(n.code,{children:"WebstudioComponent"}),"를 전달하면 최종 결과물을 렌더링 합니다."]}),"\n",(0,r.jsxs)(n.p,{children:["Builder의 canvas에서는 ",(0,r.jsx)(n.code,{children:"createElementsTree"}),"의 ",(0,r.jsx)(n.code,{children:"Component"})," prop에 ",(0,r.jsx)(n.code,{children:"WebstudioComponentPreview"})," 또는 ",(0,r.jsx)(n.code,{children:"WebstudioComponentCanvas"}),"를 대입합니다."]}),"\n",(0,r.jsxs)(n.p,{children:["먼저 ",(0,r.jsx)(n.code,{children:"WebstudioComponentPreview"}),"를 살펴 보면 ",(0,r.jsx)(n.code,{children:"Instance"})," 별 style과 관련된 내용을 추가로 적용하는 코드가 전부 입니다."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export const WebstudioComponentPreview = forwardRef<HTMLElement, WebstudioComponentProps>(\n  ({ instance, instanceSelector, children, components, ...restProps }, ref) => {\n    const instanceStyles = useInstanceStyles(instance.id);\n    useCssRules({ instanceId: instance.id, instanceStyles });\n    const { [showAttribute]: show = true, ...instanceProps } = useInstanceProps(instance.id);\n    const props = {\n      ...mergeProps(restProps, instanceProps, 'merge'),\n      [idAttribute]: instance.id,\n      [componentAttribute]: instance.component,\n    };\n    if (show === false) {\n      return <></>;\n    }\n    const Component = components.get(instance.component);\n    if (Component === undefined) {\n      return <></>;\n    }\n    return (\n      <Component {...props} ref={ref}>\n        {renderWebstudioComponentChildren(children)}\n      </Component>\n    );\n  }\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["반면 ",(0,r.jsx)(n.code,{children:"WebstudioComponentCanvas"}),"의 구현은 ",(0,r.jsx)(n.code,{children:"WebstudioComponentPreview"}),"의 기능과 더불어 ",(0,r.jsx)(n.code,{children:"<TextEditor/>"})," 컴포넌트의 ",(0,r.jsx)(n.a,{href:"https://lexical.dev/",children:"Lexical"})," 에디터를 확장한 wysiwyg editing 기능이 있습니다."]}),"\n",(0,r.jsx)(n.h1,{children:"마치며"}),"\n",(0,r.jsx)(n.p,{children:"Web studio의 구조를 중심으로 살펴 보았습니다."}),"\n",(0,r.jsxs)(n.p,{children:["먼저 iframe으로 나누어진 canvas 영역으로 인해 ",(0,r.jsx)(n.code,{children:"pubsub"}),"즉 ",(0,r.jsx)(n.code,{children:"postMessage"}),"를 사용한 프로토콜 사용이 불가피 했습니다.\n물론 ",(0,r.jsx)(n.code,{children:"imerhin"}),"을 사용하여 store 동기화를 서버와 하듯이 iframe간에 동기화에도 사용하고 있지만 궁극적으로 ",(0,r.jsx)(n.code,{children:"postMessage"}),"를 사용한 별도의 프로토콜 레이어의 구현과 운용은 불필요한 복잡도를 가져다 준 것은 아닌가 생각합니다."]}),"\n",(0,r.jsx)(n.p,{children:"이러한 복잡도에 비해 얻어지는 뚜련한 장점은 찾을 수 없었습니다."}),"\n",(0,r.jsx)(n.p,{children:"Remix의 사용도 과한 측면이 보입니다.\nSSR이 구지 필요한가 싶은 애플리케이션이기 때문입니다.\n사용자 생셩형 컨텐츠의 경우 빠른 렌더링과 SEO등을 위해 SSR이 필요하지만 Web studio는 CSR로 충분하다고 생각합니다.\ntRPC를 사용하면서 Remix와 연동하는 부분도 인상 깊었지만 뚜렷한 장점을 찾을 수 없었습니다."}),"\n",(0,r.jsx)(n.p,{children:"하지만 웹저작툴의 기본적인 구조와 설계시 고려사항을 고민해볼 수 있어 좋았습니다.\n앞으로도 꾸준히 발전하기를 응원해 봅니다."})]})}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.jsx)(c,{...e,children:(0,r.jsx)(a,{...e})})}},49034:(e,n,t)=>{"use strict";t.d(n,{A:()=>h});var r=t(18153),s=t(77328),i=t.n(s),o=t(14232);let c=o.memo(()=>(0,r.Y)(r.FK,{}));var a=t(71745),l=t(48230),d=t.n(l);let u=[{link:"/",text:"Home"}],p=o.memo(()=>{let e=(0,a.useRouter)(),[n,t]=o.useState(!1);return(0,r.FD)("nav",{className:"w-full",children:[(0,r.Y)("div",{id:"progress",className:"top-0 z-20 h-1",style:{background:"linear-gradient(to right, #4dc0b5 var(--scroll), transparent 0)"}}),(0,r.FD)("div",{className:"flex flex-wrap items-center justify-between w-full py-3 mx-auto mt-0 md:max-w-4xl",children:[(0,r.Y)("div",{className:"pl-4",children:(0,r.Y)(d(),{className:"text-xl font-extrabold text-gray-900 no-underline hover:no-underline",href:"/",children:"lifetime trails"})}),(0,r.Y)("div",{className:"block pr-4 lg:hidden",children:(0,r.Y)("button",{id:"nav-toggle",type:"button",className:"flex items-center px-3 py-2 text-gray-500 appearance-none hover:text-gray-900 hover:border-teal-500 focus:outline-none",onMouseDown:e=>e.preventDefault(),onClick:()=>t(!n),onBlur:()=>t(!1),children:(0,r.FD)("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.Y)("title",{children:"Menu"}),(0,r.Y)("path",{d:"M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"})]})})}),(0,r.Y)("div",{id:"nav-content",className:"bg-gray-100 border-b flex-grow lg:border-none lg:flex lg:items-center lg:mt-0 lg:shadow-none lg:w-auto md:bg-transparent mt-2 shadow w-full z-20 ".concat(n?"block":"hidden"),children:(0,r.Y)("ul",{className:"items-center justify-end flex-1 list-reset lg:flex",children:u.map(n=>{let{link:t,text:s}=n;return(0,r.Y)("li",{className:"mr-3",children:(0,r.Y)(d(),{className:e.pathname===t?"inline-block py-2 px-4 text-gray-900 font-bold no-underline":"inline-block text-gray-600 no-underline hover:text-gray-900 hover:text-underline py-2 px-4",href:t,children:s})},t)})})})]})]})}),h=o.memo(e=>{let{children:n,title:t="This is the default title"}=e;return(0,r.FD)("div",{className:"leading-normal tracking-normal bg-gray-100 min-h-screen",children:[(0,r.FD)(i(),{children:[(0,r.Y)("title",{children:t}),(0,r.Y)("meta",{charSet:"utf-8"}),(0,r.Y)("meta",{name:"viewport",content:"initial-scale=1.0, width=device-width"})]}),(0,r.Y)(p,{}),(0,r.Y)("div",{className:"container w-full px-4 pb-10 mx-auto md:max-w-3xl",children:n}),(0,r.Y)(c,{})]})})},56486:(e,n,t)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.identifierTypes=void 0;var r=function(e){if(e&&e.__esModule)return e;var n={};if(null!=e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};r.get||r.set?Object.defineProperty(n,t,r):n[t]=e[t]}}return n.default=e,n}(t(14232)),s=function(e){return e&&e.__esModule?e:{default:e}}(t(95062));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,n){return(c=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var a=["pathname","url","title","og:title","issue-number","issue-term"],l=function(e,n,t){if(0>a.indexOf(e))return void console.warn("Wrong type: "+e);if("pathname"===e)return"pathname";if("url"===e)return"url";if("title"===e)return"title";if("og:title"===e)return"og:title";if("issue-term"===e)return n;else if("issue-number"===e)return t},d=function(e){var n;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e){var n,s;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");return(n=(s=o(t).call(this,e))&&("object"===i(s)||"function"==typeof s)?s:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this)).myRef=r.default.createRef(),n.state={pending:!0},n}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e),n=[{key:"componentDidMount",value:function(){var e=this,n=this.props,t=n.repo,r=n.type,s=n.specificTerm,i=n.issueNumber,o=0>a.indexOf(r)?void console.warn("Wrong type: "+r):"issue-number"===r?"issue-number":"issue-term",c=l(r,s,i);if("issue-term"===r&&!c)return void console.warn("When type is '".concat(r,"', 'specificTerm' prop must be provided"));if("issue-number"===r&&(isNaN(c)||c<1))return void console.warn("When type is '".concat(r,"', valid 'issueNumber' prop must be provided"));var d=document.createElement("script");d.src="https://utteranc.es/client.js",d.async=!0,d.setAttribute("repo",t),d.setAttribute("crossorigin","anonymous"),d.setAttribute(o,c),d.onload=function(){return e.setState({pending:!1})},this.myRef.current.appendChild(d)}},{key:"render",value:function(){return r.default.createElement("div",{className:"react-utterences",ref:this.myRef},this.props.debug&&r.default.createElement("pre",{style:{background:"#cccccc",padding:10}},"\nthis.props: ".concat(JSON.stringify(this.props,null,2),'\nlocation.pathname: "').concat(window.location.pathname,'"\nlocation.href: "').concat(window.location.href,'"\n          ').trim()),this.props.debug&&r.default.createElement("div",null,"\uD83D\uDC47\uD83D\uDC47If the settings are valid, the comment widget appear below\uD83D\uDC47\uD83D\uDC47"),this.state.pending&&r.default.createElement("div",null,"Loading script..."))}}],function(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),t}(r.Component);n.identifierTypes={pathname:{attrValue:"",summary:"Issue title contains page pathname"},url:{attrValue:"url",summary:"Issue title contains page URL"},title:{attrValue:"title",summary:"Issue title contains page title"},"og:title":{attrValue:"og:title",summary:"Issue title contains page og:title"},"issue-number":{attrValue:-1,summary:"Specific issue number"},"issue-term":{attrValue:"",summary:"Issue title contains specific term"}},d.propTypes={type:s.default.string.isRequired,repo:s.default.string.isRequired,specificTerm:s.default.string,issueNumber:s.default.number,hashKey:s.default.string,debug:s.default.bool},n.default=d},60158:(e,n,t)=>{"use strict";t.d(n,{J:()=>c,j:()=>o});var r=t(18153),s=t(14232);let i=s.createContext({});function o(e){let{staticProps:n,children:t}=e;return(0,r.Y)(i.Provider,{value:n,children:t})}function c(){return s.useContext(i)}},67252:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/blogs/2023-09-24-webstudio-part-3",function(){return t(18489)}])},79706:(e,n,t)=>{"use strict";var r=t(3717);function s(){}function i(){}i.resetWarningCache=s,e.exports=function(){function e(e,n,t,s,i,o){if(o!==r){var c=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}function n(){return e}e.isRequired=e;var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:i,resetWarningCache:s};return t.PropTypes=t,t}},85419:(e,n,t)=>{"use strict";t.d(n,{A:()=>s});var r=t(18153);t(14232);let s=e=>{let{meta:n,isBlogPost:t}=e;return(0,r.FD)(r.FK,{children:[(0,r.Y)("h1",{className:"font-bold text-gray-800 mb-4 ".concat(t?"text-5xl mt-8 mb-8":"text-lg"),children:n.title}),(0,r.FD)("div",{className:"details",children:[(0,r.Y)("p",{className:"text-gray-500",children:n.description}),(0,r.Y)("p",{className:"text-gray-400 text-right -mt-1",children:(0,r.Y)("span",{className:"mr-4",children:n.date})})]})]})}},86089:(e,n,t)=>{"use strict";Object.defineProperty(n,"Ay",{enumerable:!0,get:function(){return r.default}});var r=function(e){if(e&&e.__esModule)return e;var n={};if(null!=e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};r.get||r.set?Object.defineProperty(n,t,r):n[t]=e[t]}}return n.default=e,n}(t(56486))},91013:(e,n,t)=>{"use strict";t.d(n,{A:()=>u});var r=t(18153),s=t(73146),i=t.n(s),o=t(14232),c=t(86089),a=t(60158),l=t(85419),d=t(49034);function u(e){let{children:n,meta:t,staticProps:s}=e;return o.useEffect(()=>{i().highlightAll()},[]),(0,r.Y)(r.FK,{children:(0,r.FD)(d.A,{title:t.title,children:[(0,r.Y)(l.A,{meta:t,isBlogPost:!0}),(0,r.Y)(a.j,{staticProps:s,children:(0,r.Y)("article",{className:"markdown",children:n})}),(0,r.Y)(c.Ay,{repo:"swcho/blog-comments",type:"pathname",label:"utterances",theme:"github-light"})]})})}},95062:(e,n,t)=>{e.exports=t(79706)()}},e=>{e.O(0,[5695,636,6593,8792],()=>e(e.s=67252)),_N_E=e.O()}]);
//# sourceMappingURL=2023-09-24-webstudio-part-3-352ba68b23c22b2d.js.map